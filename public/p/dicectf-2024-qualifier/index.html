<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="I participated in DiceCTF's 2024 qualifier match. Not very close to making the cut of top 8 teams to Finals, but I did manage to solve a couple cool challenges despite a late start. Our team placed 160th out of 1040 teams.">
<title>DiceCTF 2024 Qualifier</title>

<link rel='canonical' href='http://localhost:1313/p/dicectf-2024-qualifier/'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="DiceCTF 2024 Qualifier">
<meta property='og:description' content="I participated in DiceCTF's 2024 qualifier match. Not very close to making the cut of top 8 teams to Finals, but I did manage to solve a couple cool challenges despite a late start. Our team placed 160th out of 1040 teams.">
<meta property='og:url' content='http://localhost:1313/p/dicectf-2024-qualifier/'>
<meta property='og:site_name' content='Spencer&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Rev' /><meta property='article:tag' content='Game' /><meta property='article:tag' content='misc' /><meta property='article:tag' content='jail' /><meta property='article:tag' content='zsh' /><meta property='article:published_time' content='2024-02-04T15:20:32-06:00'/><meta property='article:modified_time' content='2024-02-04T15:20:32-06:00'/>
<meta name="twitter:title" content="DiceCTF 2024 Qualifier">
<meta name="twitter:description" content="I participated in DiceCTF's 2024 qualifier match. Not very close to making the cut of top 8 teams to Finals, but I did manage to solve a couple cool challenges despite a late start. Our team placed 160th out of 1040 teams.">
    <link rel="shortcut icon" href="/favicon.png" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu897059592634026878.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Spencer&#39;s Blog</a></h1>
            <h2 class="site-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/CaiJimmy/hugo-theme-stack'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/post' >
                
                
                
                <span>Posts</span>
            </a>
        </li>
        
        
        <li >
            <a href='/awards' >
                
                
                
                <span>Trophy Room</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#rev">Rev</a>
      <ol>
        <li><a href="#dicequest">dicequest</a></li>
      </ol>
    </li>
    <li><a href="#misc">Misc</a>
      <ol>
        <li><a href="#zshfuck">zshfuck</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ctf/" >
                CTF
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/dicectf-2024-qualifier/">DiceCTF 2024 Qualifier</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            I participated in DiceCTF&#39;s 2024 qualifier match. Not very close to making the cut of top 8 teams to Finals, but I did manage to solve a couple cool challenges despite a late start. Our team placed 160th out of 1040 teams.
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 04, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    6 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="rev">Rev
</h2><h3 id="dicequest">dicequest
</h3><blockquote>
<p>Try 2024&rsquo;s hottest game so far - DiceQuest! Can you survive the onslaught? Custom sprites made by <a class="link" href="https://www.fiverr.com/goldpixela"  target="_blank" rel="noopener"
    >Gold</a></p>
<p>note: the flag matches the regex <code>dice{[a-z_]+}</code></p>
</blockquote>
<hr>
<p>With this challenge, we are given an ELF executable game:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ file dicequest 
</span></span><span class="line"><span class="cl">dicequest: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=5a21a66948b7d5fd5c206fbaf90b9c1fbe2e52a4, for GNU/Linux 3.2.0, stripped
</span></span></code></pre></td></tr></table>
</div>
</div><p>Checking the contents with strings can show us that the game was made with rust, but not much other details are given. Running the executable puts us in a game with simple graphics:</p>
<p><img src="/p/dicectf-2024-qualifier/images/dicequest1.png"
	width="1268"
	height="711"
	srcset="/p/dicectf-2024-qualifier/images/dicequest1_hu14198879186759746938.png 480w, /p/dicectf-2024-qualifier/images/dicequest1_hu7682485584623350037.png 1024w"
	loading="lazy"
	
		alt="Entering Dicequest"
	
	
		class="gallery-image" 
		data-flex-grow="178"
		data-flex-basis="428px"
	
></p>
<p>The big dice is our playable object, to the right is a shop for us. To the left is an &ldquo;enemy&rdquo; dice and the top left has our money count. After about a minute or so, it looks as though dragons appear and we die. Checking the contents of the shop:</p>
<p><img src="/p/dicectf-2024-qualifier/images/dicequest2.png"
	width="1105"
	height="684"
	srcset="/p/dicectf-2024-qualifier/images/dicequest2_hu13256447038510434491.png 480w, /p/dicectf-2024-qualifier/images/dicequest2_hu1921150709935441560.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="161"
		data-flex-basis="387px"
	
></p>
<p>The shop info is slightly cut off, but we can tame the dragon army if we collect $10,000! Each &ldquo;enemy&rdquo; kill grants us $5, so this is completely unfeasible. However, if we can edit our money amount in-game, we can give ourselves as much money as we want. Normally with windows-based executables, I would opt to use <a class="link" href="https://www.cheatengine.org/"  target="_blank" rel="noopener"
    >Cheat Engine</a>, but this is a linux ELF. There seems to be a very competent alternative in <a class="link" href="https://github.com/scanmem/scanmem"  target="_blank" rel="noopener"
    >gameconquerer</a>.</p>
<p>In order to find the memory address responsible for money, we can search for addresses containing the number while we know it. For example, at the start of every game we have 0 dollars. We can search for values containing 0:</p>
<p><img src="/p/dicectf-2024-qualifier/images/dicequest3.png"
	width="552"
	height="588"
	srcset="/p/dicectf-2024-qualifier/images/dicequest3_hu162686889593777992.png 480w, /p/dicectf-2024-qualifier/images/dicequest3_hu12530299603335561720.png 1024w"
	loading="lazy"
	
		alt="After searching 0, we have 94731357 possibilities."
	
	
		class="gallery-image" 
		data-flex-grow="93"
		data-flex-basis="225px"
	
></p>
<p>Then as we defeat 1 enemy we are brought to $5. Searching again, we can trace values that started at 0 and are 5 after defeating 1 enemy:</p>
<p><img src="/p/dicectf-2024-qualifier/images/dicequest4.png"
	width="540"
	height="577"
	srcset="/p/dicectf-2024-qualifier/images/dicequest4_hu10330753842303385634.png 480w, /p/dicectf-2024-qualifier/images/dicequest4_hu17053139730411105946.png 1024w"
	loading="lazy"
	
		alt="After getting $5 and searching again, we reduced the possibilities to 217"
	
	
		class="gallery-image" 
		data-flex-grow="93"
		data-flex-basis="224px"
	
></p>
<p>We can repeat this process until there is only 1 address left:</p>
<p><img src="/p/dicectf-2024-qualifier/images/dicequest5.png"
	width="552"
	height="580"
	srcset="/p/dicectf-2024-qualifier/images/dicequest5_hu14501796329579812288.png 480w, /p/dicectf-2024-qualifier/images/dicequest5_hu11547529345595445819.png 1024w"
	loading="lazy"
	
		alt="After searching again with $10, we see exactly 1 address"
	
	
		class="gallery-image" 
		data-flex-grow="95"
		data-flex-basis="228px"
	
></p>
<p>Now that we know we have the address, we can add it with the + symbol and edit the value section below. Giving myself 10000:</p>
<p><img src="/p/dicectf-2024-qualifier/images/dicequest6.png"
	width="550"
	height="554"
	srcset="/p/dicectf-2024-qualifier/images/dicequest6_hu3595631824612088780.png 480w, /p/dicectf-2024-qualifier/images/dicequest6_hu3194052266543487658.png 1024w"
	loading="lazy"
	
		alt="Adding the value to edit with the &#43;, then double click to change value number."
	
	
		class="gallery-image" 
		data-flex-grow="99"
		data-flex-basis="238px"
	
></p>
<p>The score in top left will not change until your score is changed by defeating an enemy, but the money is still there and now we can purchase the dragon tame upgrade:</p>
<p><img src="/p/dicectf-2024-qualifier/images/dicequest7.png"
	width="1089"
	height="650"
	srcset="/p/dicectf-2024-qualifier/images/dicequest7_hu15125778864519282270.png 480w, /p/dicectf-2024-qualifier/images/dicequest7_hu8257011101280133264.png 1024w"
	loading="lazy"
	
		alt="After the tame dragon is purchased, the option is gray."
	
	
		class="gallery-image" 
		data-flex-grow="167"
		data-flex-basis="402px"
	
></p>
<p>Now when the dragons come, I survive!</p>
<p><img src="/p/dicectf-2024-qualifier/images/dicequest8.png"
	width="826"
	height="522"
	srcset="/p/dicectf-2024-qualifier/images/dicequest8_hu893738531824255720.png 480w, /p/dicectf-2024-qualifier/images/dicequest8_hu8315306367283163499.png 1024w"
	loading="lazy"
	
		alt="Surviving the dragon barrage"
	
	
		class="gallery-image" 
		data-flex-grow="158"
		data-flex-basis="379px"
	
></p>
<p>The flag isn&rsquo;t immediately apparent, but we can eventually see that the dragons are creating letters:</p>
<p><img src="/p/dicectf-2024-qualifier/images/dicequest9.png"
	width="1249"
	height="390"
	srcset="/p/dicectf-2024-qualifier/images/dicequest9_hu659476090253826783.png 480w, /p/dicectf-2024-qualifier/images/dicequest9_hu11101250524019926628.png 1024w"
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="320"
		data-flex-basis="768px"
	
></p>
<p>We can zoom out pretty far to see the whole flag, but the text is certainly not easy on the eyes:</p>
<p><img src="/p/dicectf-2024-qualifier/images/dicequest10.png"
	width="1887"
	height="94"
	srcset="/p/dicectf-2024-qualifier/images/dicequest10_hu4534742587261300897.png 480w, /p/dicectf-2024-qualifier/images/dicequest10_hu9166528036806446381.png 1024w"
	loading="lazy"
	
		alt="dice{your_flag_is_not_in_another_castle}"
	
	
		class="gallery-image" 
		data-flex-grow="2007"
		data-flex-basis="4817px"
	
></p>
<h2 id="misc">Misc
</h2><h3 id="zshfuck">zshfuck
</h3><blockquote>
<p>may your code be under par. execute the <code>getflag</code> binary somewhere in the filesystem to win</p>
</blockquote>
<hr>
<p>We are given the source code for our jail:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl"><span class="cp">#!/bin/zsh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>print -n -P <span class="s2">&#34;%F{green}Specify your charset: %f&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">read</span> -r charset
</span></span><span class="line"><span class="cl"><span class="c1"># get uniq characters in charset</span>
</span></span><span class="line"><span class="cl"><span class="nv">charset</span><span class="o">=(</span><span class="s2">&#34;</span><span class="si">${</span><span class="p">(us..)charset</span><span class="si">}</span><span class="s2">&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nv">banned</span><span class="o">=(</span><span class="s1">&#39;*&#39;</span> <span class="s1">&#39;?&#39;</span> <span class="s1">&#39;`&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[[</span> <span class="si">${#</span><span class="nv">charset</span><span class="si">}</span> -gt <span class="m">6</span> <span class="o">||</span> <span class="si">${#</span><span class="nv">charset</span><span class="p">:|banned</span><span class="si">}</span> -ne <span class="si">${#</span><span class="nv">charset</span><span class="si">}</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    print -P <span class="s2">&#34;\n%F{red}That&#39;s too easy. Sorry.%f\n&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">print -P <span class="s2">&#34;\n%F{green}OK! Got </span><span class="nv">$charset</span><span class="s2">.%f&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">charset</span><span class="o">+=(</span><span class="s1">$&#39;\n&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># start jail via coproc</span>
</span></span><span class="line"><span class="cl">coproc zsh -s
</span></span><span class="line"><span class="cl"><span class="nb">exec</span> 3&gt;<span class="p">&amp;</span>p 4&lt;<span class="p">&amp;</span>p
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># read chars from fd 4 (jail stdout), print to stdout</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -u4 -r -k1 char<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    print -u1 -n -- <span class="s2">&#34;</span><span class="nv">$char</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># read chars from stdin, send to jail stdin if valid</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -u0 -r -k1 char<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[[</span> ! <span class="si">${#</span><span class="nv">char</span><span class="p">:|charset</span><span class="si">}</span> -eq <span class="m">0</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        print -P <span class="s2">&#34;\n%F{red}Nope.%f\n&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># send to fd 3 (jail stdin)</span>
</span></span><span class="line"><span class="cl">    print -u3 -n -- <span class="s2">&#34;</span><span class="nv">$char</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">done</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The setup is a little complex, but the general behavior is this: You are in a terminal that only accepts up to 6 characters of your choosing. After selection, any string that only contains those characters will be passed to and executed inside <code>zsh</code>. There are some characters that are banned, as they would make it too easy. As a start, I tried to learn more about the filesystem by passing an <code>ls -lR</code> command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ nc mc.ax 31774
</span></span><span class="line"><span class="cl">Specify your charset: ls -R
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">OK! Got l s   - R.
</span></span><span class="line"><span class="cl">ls -lR
</span></span><span class="line"><span class="cl">.:
</span></span><span class="line"><span class="cl">total 8
</span></span><span class="line"><span class="cl">-rwxr-xr-x 1 nobody nogroup  795 Feb  2 21:55 run
</span></span><span class="line"><span class="cl">drwxr-xr-x 1 nobody nogroup 4096 Feb  2 13:31 y0u
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">./y0u:
</span></span><span class="line"><span class="cl">total 4
</span></span><span class="line"><span class="cl">drwxr-xr-x 1 nobody nogroup 4096 Feb  2 13:31 w1ll
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">./y0u/w1ll:
</span></span><span class="line"><span class="cl">total 4
</span></span><span class="line"><span class="cl">drwxr-xr-x 1 nobody nogroup 4096 Feb  2 13:31 n3v3r_g3t
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">./y0u/w1ll/n3v3r_g3t:
</span></span><span class="line"><span class="cl">total 4
</span></span><span class="line"><span class="cl">drwxr-xr-x 1 nobody nogroup 4096 Feb  2 13:31 th1s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">./y0u/w1ll/n3v3r_g3t/th1s:
</span></span><span class="line"><span class="cl">total 16
</span></span><span class="line"><span class="cl">---x--x--x 1 nobody nogroup 15960 Feb  2 13:30 getflag
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can see that our objective executable is buried several folders deep. Naturally, we will have to reach it before being able to execute. We can also learn the current path with pwd or cwd:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Specify your charset: pwd
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">OK! Got p w d.
</span></span><span class="line"><span class="cl">pwd
</span></span><span class="line"><span class="cl">/app
</span></span></code></pre></td></tr></table>
</div>
</div><p>Thanks to the interesting behavior of passing our characters into another shell, we cannot escape via a simple -i flag:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Specify your charset: sh -i
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">OK! Got s h   - i.
</span></span><span class="line"><span class="cl">sh -i
</span></span><span class="line"><span class="cl">sh: 0: can&#39;t access tty; job control turned off
</span></span><span class="line"><span class="cl">$ id
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Nope.
</span></span></code></pre></td></tr></table>
</div>
</div><p>We see the output <code>$</code> indicative of an sh session, but are still incapable of passing banned letters. By this point, it is rather clear why there are certain banned characters. If wildcards were allowed, we could hit it very easily just with <code>/*/*/*/*/*/*</code>. Alas, it is not that simple.</p>
<p>After researching some <a class="link" href="https://docstore.mik.ua/orelly/unix3/upt/ch27_17.htm"  target="_blank" rel="noopener"
    >special characters</a> for zsh, i find an interesting opportunity:</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>[ ]</th>
          <th>csh, sh</th>
          <th>Match range of characters.</th>
          <th>Section 1.13, Section 33.2</th>
      </tr>
  </thead>
  <tbody>
  </tbody>
</table></div>
<p>Following the example sections, we can see it used to encompass all characters:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[a-z]
</span></span></code></pre></td></tr></table>
</div>
</div><p>Perhaps something like this can work for our situation? to begin, I try executing /app/run since it is shorter:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Specify your charset: /[a-z]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">OK! Got / [ a - z ].
</span></span><span class="line"><span class="cl">/[a-z][a-z][a-z]/[a-z][a-z][a-z]
</span></span><span class="line"><span class="cl">Specify your charset: asdf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Nope.
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can see that after i input my execution string of <code>/[a-z][a-z][a-z]/[a-z][a-z][a-z]</code>, the jail is run a 2nd time and asks once again for a charset. I still can&rsquo;t circumvent the original charset, but it is clear that we are executing /app/run! Now the challenge lies in reaching our getflag goal. Remember the path: <code>/app/y0u/w1ll/n3v3r_g3t/th1s/getflag</code>. Unlike my simple check, this contains more than just letters. We need to expand our range even further to match all the characters. Using the range starting at 0 and ending at z will include all letters and numbers, but will it include the underscore inside <code>n3v3r_g3t</code>? Turns out it will:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Specify your charset: /[0-z]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">OK! Got / [ 0 - z ].
</span></span><span class="line"><span class="cl">/[0-z][0-z][0-z]/[0-z][0-z][0-z]/[0-z][0-z][0-z][0-z]/[0-z][0-z][0-z][0-z][0-z][0-z][0-z][0-z][0-z]/[0-z][0-z][0-z][0-z]/[0-z][0-z][0-z][0-z][0-z][0-z][0-z]
</span></span><span class="line"><span class="cl">dice{d0nt_u_jU5T_l00oo0ve_c0d3_g0lf?}
</span></span></code></pre></td></tr></table>
</div>
</div><p>The command is simply replacing every character in <code>/app/y0u/w1ll/n3v3r_g3t/th1s/getflag</code> with <code>[0-z]</code>, with the exception of forward slashes.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/rev/">Rev</a>
        
            <a href="/tags/game/">Game</a>
        
            <a href="/tags/misc/">Misc</a>
        
            <a href="/tags/jail/">Jail</a>
        
            <a href="/tags/zsh/">Zsh</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/huntress-ctf-2024/">
        
        
            <div class="article-image">
                <img src="/p/huntress-ctf-2024/HuntressCTF_Banner.6181f047aa18073aac2b72b3a0aa3ba2_hu2497031440356620825.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Huntress CTF 2024"
                        
                        data-hash="md5-YYHwR6oYBzqsK3KzoKo7og==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Huntress CTF 2024</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/hackthebox-cyber-apocalypse-2024/">
        
        
            <div class="article-image">
                <img src="/p/hackthebox-cyber-apocalypse-2024/ca-2024-ctf-background.d1ff26ab7326bd1a79b6d1e0a52f6aa6_hu13886050347455417942.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post HackTheBox - Cyber Apocalypse: 2024"
                        
                        data-hash="md5-0f8mq3MmvRp5ttHgpS9qpg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">HackTheBox - Cyber Apocalypse: 2024</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/1337up-ctf/">
        
        

        <div class="article-details">
            <h2 class="article-title">1337UP CTF</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/hack-the-boo-2023/">
        
        

        <div class="article-details">
            <h2 class="article-title">Hack The Boo 2023</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/p/uiuctf_2023/">
        
        

        <div class="article-details">
            <h2 class="article-title">UIUCTF_2023</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 Spencer&#39;s Blog
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.799eb5847effe83ae252baf7b2236f0c3752b0188dd0985faa7efc75ea805b29.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
